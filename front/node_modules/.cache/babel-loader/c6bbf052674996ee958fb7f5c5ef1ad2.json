{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Diagnose/Sweep/SweepContainer.js\";\nimport React from 'react';\nimport SweepPresenter from './SweepPresenter';\nimport { D1_Api, soundURL } from 'api';\nimport { D1, TTobak } from 'images';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport LoadingComp from 'Components/LoadingComp';\nconst UP = 'up';\nconst DOWN = 'down';\n\nclass Sweep extends React.PureComponent {\n  constructor(props) {\n    super();\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n\n      try {\n        const {\n          data\n        } = await D1_Api.ask(4);\n        console.log(data);\n\n        if (data.code === 1) {\n          const {\n            answers,\n            swp: {\n              ques_id,\n              ques_path1,\n              ques_path2\n            }\n          } = data;\n          this.currentIndex = 0;\n          this.ques_id = ques_id;\n          this.ques_path = [ques_path2, ques_path1];\n          this.oriAnswer = answers;\n          this.buttonSound = [new Audio(soundURL + this.ques_path[0]), new Audio(soundURL + this.ques_path[1])];\n          this.setState({\n            totalNum: this.oriAnswer.length\n          });\n          this.setListener();\n          setTimeout(() => this.playSound(), 3000);\n        } else console.log('data message: ' + data.message);\n      } catch (e) {\n        console.log('error: ' + e);\n      }\n    };\n\n    this.setListener = () => {\n      try {\n        this.setState({\n          swpSound: [UP === this.oriAnswer[this.currentIndex][0] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1]), UP === this.oriAnswer[this.currentIndex][1] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1])],\n          currentIndex: this.currentIndex + 1\n        });\n        this.state.swpSound[0].addEventListener('ended', () => {\n          setTimeout(() => {\n            if (!!this.state.swpSound[1]) this.state.swpSound[1].play();\n          }, 900);\n        });\n        this.state.swpSound[1].addEventListener('ended', () => {\n          this.setState({\n            gameState: true,\n            TTobaki: TTobak.ttobak1_1\n          });\n        });\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.onTouchStart = id => {\n      const {\n        Answer,\n        stdAnswer,\n        gameState\n      } = this.state;\n      if (!gameState) return;\n\n      switch (id) {\n        case DOWN:\n          // console.log('down-down');\n          this.setState({\n            DownButton: D1.d1_DownButton_DOWN,\n            Answer: Answer.concat(gameState ? D1.d1_AnswerDown : []),\n            stdAnswer: stdAnswer.concat(gameState ? DOWN : [])\n          });\n          break;\n\n        case UP:\n          // console.log('up-down');\n          this.setState({\n            UpButton: D1.d1_UpButton_DOWN,\n            Answer: Answer.concat(gameState ? D1.d1_AnswerUp : []),\n            stdAnswer: stdAnswer.concat(gameState ? UP : [])\n          });\n          break;\n\n        default:\n      }\n    };\n\n    this.onTouchEnd = id => {\n      const {\n        gameState\n      } = this.state;\n      if (!gameState) return;\n\n      switch (id) {\n        case DOWN:\n          // console.log('down-up');\n          this.setState({\n            DownButton: D1.d1_DownButton_UP\n          });\n          if (gameState && !!this.buttonSound[1]) this.buttonSound[1].play();\n          break;\n\n        case UP:\n          // console.log('up-up');\n          this.setState({\n            UpButton: D1.d1_UpButton_UP\n          });\n          if (gameState && !!this.buttonSound[0]) this.buttonSound[0].play();\n          break;\n\n        default:\n      }\n\n      if (this.state.Answer.length === 2) this.finished();\n    };\n\n    this.TTobakiTouch = async () => {\n      if (this.state.gameState) {\n        this.playSound();\n      }\n    };\n\n    this.playSound = () => {\n      this.setState({\n        gameState: false\n      });\n      if (!!this.state.swpSound[0]) this.state.swpSound[0].play();\n    };\n\n    this.finished = async () => {\n      this.setState({\n        gameState: false,\n        TTobaki: TTobak.ttobak2_1\n      });\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n      const {\n        stdAnswer\n      } = this.state;\n      const answer = [this.oriAnswer[this.currentIndex][0], this.oriAnswer[this.currentIndex][1]];\n\n      try {\n        console.log(s_id, this.ques_id, answer, stdAnswer);\n        const {\n          data\n        } = await D1_Api.answer(s_id, this.ques_id, answer, stdAnswer);\n        console.log(data);\n        setTimeout(() => {\n          this.setState({\n            gameState: false,\n            Answer: [],\n            sweep: [],\n            path: [],\n            stdAnswer: [],\n            TTobaki: TTobak.ttobak1_1\n          });\n        }, 1500);\n\n        if (data.code === 1) {\n          if (data.to_next || data.to_next_freq) {\n            this.newRequest();\n            console.log('next');\n          } else if (data.is_stop || data.to_next === '모든 단계를 풀었습니다.') {\n            this.setState({\n              showNextPopup: true\n            });\n          } else if (!data.to_next && !data.to_next_freq) {\n            this.setState({\n              showNextPopup: true\n            });\n            return;\n          } else {\n            if (this.currentIndex < this.oriAnswer.length - 1) this.currentIndex++;else {\n              this.setState({\n                showNextPopup: true\n              });\n              return;\n            }\n            this.setListener();\n            setTimeout(() => {\n              this.playSound();\n            }, 2000);\n          }\n        }\n      } catch (e) {\n        console.log(e); // TODO 에러 처리\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n            }\n          };\n        }\n      }\n    };\n\n    this.onPopupButtonHandle = () => {\n      this.props.history.replace('/diagnose/recognition');\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.buttonSound = null; // up_sweep, down_sweep 소리 경로\n\n    this.currentIndex = 0;\n    this.oriAnswer = null;\n    this.ques_id = null;\n    this.ques_path = null;\n    this.currentIndex = 0;\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      D1,\n      TTobak\n    };\n    this.totalImages = Object.keys(D1).length + Object.keys(TTobak).length;\n    this.state = {\n      gameState: false,\n      // 게임 상태\n      UpButton: D1.d1_UpButton_UP,\n      // 버튼 이미지 상태\n      DownButton: D1.d1_DownButton_UP,\n      // 버튼 이미지 상태\n      stdAnswer: [],\n      // 학습자 정답\n      Answer: [],\n      // 정답 상자\n      TTobaki: TTobak.ttobak1_1,\n      // 또박이 이미지 상태\n      swpSound: null,\n      isImageLoaded: false,\n      percent: 0,\n      showPopup: false,\n      showNextPopup: false,\n      currentIndex: 0,\n      totalNum: 0\n    };\n  }\n\n  async componentDidMount() {\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    if (!user.student.s_id) {\n      this.props.history.push('/root/selectstd');\n      return;\n    }\n\n    this.newRequest();\n    this.imagesPreloading(this.picture);\n    this.newRequest();\n  }\n\n  componentWillUnmount() {\n    if (!!this.state.swpSound) {\n      this.state.swpSound[0].pause();\n      this.state.swpSound[1].pause();\n    }\n\n    this.setState({\n      swpSound: null\n    });\n  }\n\n  render() {\n    const {\n      UpButton,\n      DownButton,\n      Answer,\n      TTobaki,\n      isImageLoaded,\n      showPopup,\n      showNextPopup,\n      percent\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(SweepPresenter, {\n        Background: D1.d1_background,\n        UP: UP,\n        DOWN: DOWN,\n        onTouchStart: this.onTouchStart,\n        onTouchEnd: this.onTouchEnd,\n        UpButton: UpButton,\n        DownButton: DownButton,\n        Answer: Answer,\n        TTobak: TTobaki,\n        TTobakiTouch: this.TTobakiTouch,\n        AnswerBox: D1.d1_box,\n        showPopup: showPopup,\n        showNextPopup: showNextPopup,\n        onPopupButtonHandle: this.onPopupButtonHandle,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        currentIndex: this.state.currentIndex,\n        totalNum: this.state.totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 17\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nSweep.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Sweep));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Diagnose/Sweep/SweepContainer.js"],"names":["React","SweepPresenter","D1_Api","soundURL","D1","TTobak","withRouter","PropTypes","connect","LoadingComp","UP","DOWN","Sweep","PureComponent","constructor","props","newRequest","console","log","user","s_id","student","data","ask","code","answers","swp","ques_id","ques_path1","ques_path2","currentIndex","ques_path","oriAnswer","buttonSound","Audio","setState","totalNum","length","setListener","setTimeout","playSound","message","e","swpSound","state","addEventListener","play","gameState","TTobaki","ttobak1_1","onTouchStart","id","Answer","stdAnswer","DownButton","d1_DownButton_DOWN","concat","d1_AnswerDown","UpButton","d1_UpButton_DOWN","d1_AnswerUp","onTouchEnd","d1_DownButton_UP","d1_UpButton_UP","finished","TTobakiTouch","ttobak2_1","answer","sweep","path","to_next","to_next_freq","is_stop","showNextPopup","imagesPreloading","picture","i","prop","img","Image","src","onload","percent","numOfLoadedImage","totalImages","isImageLoaded","onPopupButtonHandle","history","replace","onContinueButtonHandle","showPopup","onPauseButtonHandle","Object","keys","componentDidMount","u_id","push","componentWillUnmount","pause","render","d1_background","d1_box","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,SAASC,MAAT,EAAiBC,QAAjB,QAAiC,KAAjC;AACA,SAASC,EAAT,EAAaC,MAAb,QAA2B,QAA3B;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,OAAOC,WAAP,MAAwB,wBAAxB;AAEA,MAAMC,EAAE,GAAG,IAAX;AACA,MAAMC,IAAI,GAAG,MAAb;;AAEA,MAAMC,KAAN,SAAoBZ,KAAK,CAACa,aAA1B,CAAwC;AAMpCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf;;AADe,SAyDnBC,UAzDmB,GAyDN,YAAY;AACrBC,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,YAAM;AAAEC,QAAAA;AAAF,UAAW,KAAKJ,KAAtB;AACA,YAAMK,IAAI,GAAGD,IAAI,CAACE,OAAL,CAAaD,IAA1B;;AAEA,UAAI;AACA,cAAM;AAAEE,UAAAA;AAAF,YAAW,MAAMpB,MAAM,CAACqB,GAAP,CAAW,CAAX,CAAvB;AACAN,QAAAA,OAAO,CAACC,GAAR,CAAYI,IAAZ;;AAEA,YAAIA,IAAI,CAACE,IAAL,KAAc,CAAlB,EAAqB;AACjB,gBAAM;AAAEC,YAAAA,OAAF;AAAWC,YAAAA,GAAG,EAAE;AAAEC,cAAAA,OAAF;AAAWC,cAAAA,UAAX;AAAuBC,cAAAA;AAAvB;AAAhB,cAAwDP,IAA9D;AACA,eAAKQ,YAAL,GAAoB,CAApB;AACA,eAAKH,OAAL,GAAeA,OAAf;AACA,eAAKI,SAAL,GAAiB,CAACF,UAAD,EAAaD,UAAb,CAAjB;AACA,eAAKI,SAAL,GAAiBP,OAAjB;AACA,eAAKQ,WAAL,GAAmB,CAAC,IAAIC,KAAJ,CAAU/B,QAAQ,GAAG,KAAK4B,SAAL,CAAe,CAAf,CAArB,CAAD,EAA0C,IAAIG,KAAJ,CAAU/B,QAAQ,GAAG,KAAK4B,SAAL,CAAe,CAAf,CAArB,CAA1C,CAAnB;AACA,eAAKI,QAAL,CAAc;AACVC,YAAAA,QAAQ,EAAE,KAAKJ,SAAL,CAAeK;AADf,WAAd;AAGA,eAAKC,WAAL;AACAC,UAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACH,SAZD,MAaKvB,OAAO,CAACC,GAAR,CAAY,mBAAmBI,IAAI,CAACmB,OAApC;AACR,OAlBD,CAkBE,OAAOC,CAAP,EAAU;AACRzB,QAAAA,OAAO,CAACC,GAAR,CAAY,YAAYwB,CAAxB;AACH;AACJ,KAnFkB;;AAAA,SAqFnBJ,WArFmB,GAqFL,MAAM;AAChB,UAAI;AACA,aAAKH,QAAL,CAAc;AACVQ,UAAAA,QAAQ,EAAE,CACLjC,EAAE,KAAK,KAAKsB,SAAL,CAAe,KAAKF,YAApB,EAAkC,CAAlC,CAAP,GAA8C,IAAII,KAAJ,CAAU/B,QAAQ,GAAG,KAAK4B,SAAL,CAAe,CAAf,CAArB,CAA9C,GAAwF,IAAIG,KAAJ,CAAU/B,QAAQ,GAAG,KAAK4B,SAAL,CAAe,CAAf,CAArB,CADnF,EAELrB,EAAE,KAAK,KAAKsB,SAAL,CAAe,KAAKF,YAApB,EAAkC,CAAlC,CAAP,GAA8C,IAAII,KAAJ,CAAU/B,QAAQ,GAAG,KAAK4B,SAAL,CAAe,CAAf,CAArB,CAA9C,GAAwF,IAAIG,KAAJ,CAAU/B,QAAQ,GAAG,KAAK4B,SAAL,CAAe,CAAf,CAArB,CAFnF,CADA;AAKVD,UAAAA,YAAY,EAAE,KAAKA,YAAL,GAAoB;AALxB,SAAd;AAQA,aAAKc,KAAL,CAAWD,QAAX,CAAoB,CAApB,EAAuBE,gBAAvB,CAAwC,OAAxC,EAAiD,MAAM;AACnDN,UAAAA,UAAU,CAAC,MAAM;AACb,gBAAI,CAAC,CAAC,KAAKK,KAAL,CAAWD,QAAX,CAAoB,CAApB,CAAN,EAA8B,KAAKC,KAAL,CAAWD,QAAX,CAAoB,CAApB,EAAuBG,IAAvB;AACjC,WAFS,EAEP,GAFO,CAAV;AAGH,SAJD;AAMA,aAAKF,KAAL,CAAWD,QAAX,CAAoB,CAApB,EAAuBE,gBAAvB,CAAwC,OAAxC,EAAiD,MAAM;AACnD,eAAKV,QAAL,CAAc;AACVY,YAAAA,SAAS,EAAE,IADD;AAEVC,YAAAA,OAAO,EAAE3C,MAAM,CAAC4C;AAFN,WAAd;AAIH,SALD;AAMH,OArBD,CAqBE,OAAOP,CAAP,EAAU;AACRzB,QAAAA,OAAO,CAACC,GAAR,CAAYwB,CAAZ;AACH;AACJ,KA9GkB;;AAAA,SAgHnBQ,YAhHmB,GAgHHC,EAAD,IAAQ;AACnB,YAAM;AAAEC,QAAAA,MAAF;AAAUC,QAAAA,SAAV;AAAqBN,QAAAA;AAArB,UAAmC,KAAKH,KAA9C;AACA,UAAI,CAACG,SAAL,EAAgB;;AAEhB,cAAQI,EAAR;AACI,aAAKxC,IAAL;AACI;AACA,eAAKwB,QAAL,CAAc;AACVmB,YAAAA,UAAU,EAAElD,EAAE,CAACmD,kBADL;AAEVH,YAAAA,MAAM,EAAEA,MAAM,CAACI,MAAP,CAAcT,SAAS,GAAG3C,EAAE,CAACqD,aAAN,GAAsB,EAA7C,CAFE;AAGVJ,YAAAA,SAAS,EAAEA,SAAS,CAACG,MAAV,CAAiBT,SAAS,GAAGpC,IAAH,GAAU,EAApC;AAHD,WAAd;AAKA;;AACJ,aAAKD,EAAL;AACI;AACA,eAAKyB,QAAL,CAAc;AACVuB,YAAAA,QAAQ,EAAEtD,EAAE,CAACuD,gBADH;AAEVP,YAAAA,MAAM,EAAEA,MAAM,CAACI,MAAP,CAAcT,SAAS,GAAG3C,EAAE,CAACwD,WAAN,GAAoB,EAA3C,CAFE;AAGVP,YAAAA,SAAS,EAAEA,SAAS,CAACG,MAAV,CAAiBT,SAAS,GAAGrC,EAAH,GAAQ,EAAlC;AAHD,WAAd;AAKA;;AACJ;AAjBJ;AAmBH,KAvIkB;;AAAA,SAyInBmD,UAzImB,GAyILV,EAAD,IAAQ;AACjB,YAAM;AAAEJ,QAAAA;AAAF,UAAgB,KAAKH,KAA3B;AACA,UAAI,CAACG,SAAL,EAAgB;;AAEhB,cAAQI,EAAR;AACI,aAAKxC,IAAL;AACI;AACA,eAAKwB,QAAL,CAAc;AACVmB,YAAAA,UAAU,EAAElD,EAAE,CAAC0D;AADL,WAAd;AAGA,cAAIf,SAAS,IAAI,CAAC,CAAC,KAAKd,WAAL,CAAiB,CAAjB,CAAnB,EAAwC,KAAKA,WAAL,CAAiB,CAAjB,EAAoBa,IAApB;AACxC;;AACJ,aAAKpC,EAAL;AACI;AACA,eAAKyB,QAAL,CAAc;AACVuB,YAAAA,QAAQ,EAAEtD,EAAE,CAAC2D;AADH,WAAd;AAGA,cAAIhB,SAAS,IAAI,CAAC,CAAC,KAAKd,WAAL,CAAiB,CAAjB,CAAnB,EAAwC,KAAKA,WAAL,CAAiB,CAAjB,EAAoBa,IAApB;AACxC;;AACJ;AAfJ;;AAiBA,UAAI,KAAKF,KAAL,CAAWQ,MAAX,CAAkBf,MAAlB,KAA6B,CAAjC,EAAoC,KAAK2B,QAAL;AACvC,KA/JkB;;AAAA,SAiKnBC,YAjKmB,GAiKJ,YAAY;AACvB,UAAI,KAAKrB,KAAL,CAAWG,SAAf,EAA0B;AACtB,aAAKP,SAAL;AACH;AACJ,KArKkB;;AAAA,SAuKnBA,SAvKmB,GAuKP,MAAM;AACd,WAAKL,QAAL,CAAc;AACVY,QAAAA,SAAS,EAAE;AADD,OAAd;AAIA,UAAI,CAAC,CAAC,KAAKH,KAAL,CAAWD,QAAX,CAAoB,CAApB,CAAN,EAA8B,KAAKC,KAAL,CAAWD,QAAX,CAAoB,CAApB,EAAuBG,IAAvB;AACjC,KA7KkB;;AAAA,SA+KnBkB,QA/KmB,GA+KR,YAAY;AACnB,WAAK7B,QAAL,CAAc;AACVY,QAAAA,SAAS,EAAE,KADD;AAEVC,QAAAA,OAAO,EAAE3C,MAAM,CAAC6D;AAFN,OAAd;AAKA,YAAM;AAAE/C,QAAAA;AAAF,UAAW,KAAKJ,KAAtB;AACA,YAAMK,IAAI,GAAGD,IAAI,CAACE,OAAL,CAAaD,IAA1B;AAEA,YAAM;AAAEiC,QAAAA;AAAF,UAAgB,KAAKT,KAA3B;AACA,YAAMuB,MAAM,GAAG,CAAC,KAAKnC,SAAL,CAAe,KAAKF,YAApB,EAAkC,CAAlC,CAAD,EAAuC,KAAKE,SAAL,CAAe,KAAKF,YAApB,EAAkC,CAAlC,CAAvC,CAAf;;AAEA,UAAI;AACAb,QAAAA,OAAO,CAACC,GAAR,CAAYE,IAAZ,EAAkB,KAAKO,OAAvB,EAAgCwC,MAAhC,EAAwCd,SAAxC;AACA,cAAM;AAAE/B,UAAAA;AAAF,YAAW,MAAMpB,MAAM,CAACiE,MAAP,CAAc/C,IAAd,EAAoB,KAAKO,OAAzB,EAAkCwC,MAAlC,EAA0Cd,SAA1C,CAAvB;AACApC,QAAAA,OAAO,CAACC,GAAR,CAAYI,IAAZ;AAEAiB,QAAAA,UAAU,CAAC,MAAM;AACb,eAAKJ,QAAL,CAAc;AACVY,YAAAA,SAAS,EAAE,KADD;AAEVK,YAAAA,MAAM,EAAE,EAFE;AAGVgB,YAAAA,KAAK,EAAE,EAHG;AAIVC,YAAAA,IAAI,EAAE,EAJI;AAKVhB,YAAAA,SAAS,EAAE,EALD;AAMVL,YAAAA,OAAO,EAAE3C,MAAM,CAAC4C;AANN,WAAd;AAQH,SATS,EASP,IATO,CAAV;;AAWA,YAAI3B,IAAI,CAACE,IAAL,KAAc,CAAlB,EAAqB;AACjB,cAAIF,IAAI,CAACgD,OAAL,IAAgBhD,IAAI,CAACiD,YAAzB,EAAuC;AACnC,iBAAKvD,UAAL;AACAC,YAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACH,WAHD,MAIK,IAAII,IAAI,CAACkD,OAAL,IAAgBlD,IAAI,CAACgD,OAAL,KAAiB,eAArC,EAAsD;AACvD,iBAAKnC,QAAL,CAAc;AACVsC,cAAAA,aAAa,EAAE;AADL,aAAd;AAGH,WAJI,MAIE,IAAI,CAACnD,IAAI,CAACgD,OAAN,IAAiB,CAAChD,IAAI,CAACiD,YAA3B,EAAyC;AAC5C,iBAAKpC,QAAL,CAAc;AACVsC,cAAAA,aAAa,EAAE;AADL,aAAd;AAGA;AACH,WALM,MAKA;AACH,gBAAI,KAAK3C,YAAL,GAAoB,KAAKE,SAAL,CAAeK,MAAf,GAAwB,CAAhD,EAAmD,KAAKP,YAAL,GAAnD,KACK;AACD,mBAAKK,QAAL,CAAc;AACVsC,gBAAAA,aAAa,EAAE;AADL,eAAd;AAGA;AACH;AAED,iBAAKnC,WAAL;AAEAC,YAAAA,UAAU,CAAC,MAAM;AACb,mBAAKC,SAAL;AACH,aAFS,EAEP,IAFO,CAAV;AAGH;AACJ;AACJ,OA9CD,CA8CE,OAAOE,CAAP,EAAU;AACRzB,QAAAA,OAAO,CAACC,GAAR,CAAYwB,CAAZ,EADQ,CAER;AACH;AACJ,KA7OkB;;AAAA,SA+OnBgC,gBA/OmB,GA+OCC,OAAD,IAAa;AAC5B,WAAK,IAAIC,CAAT,IAAcD,OAAd,EAAuB;AACnB,aAAK,IAAIE,IAAT,IAAiBF,OAAO,CAACC,CAAD,CAAxB,EAA6B;AACzB,cAAIE,GAAG,GAAG,IAAIC,KAAJ,EAAV;AACAD,UAAAA,GAAG,CAACE,GAAJ,GAAUL,OAAO,CAACC,CAAD,CAAP,CAAWC,IAAX,CAAV;;AACAC,UAAAA,GAAG,CAACG,MAAJ,GAAa,MAAM;AACf,iBAAK9C,QAAL,CAAc;AACV+C,cAAAA,OAAO,EAAG,EAAE,KAAKC,gBAAP,GAA0B,KAAKC,WAAhC,GAA+C;AAD9C,aAAd;;AAIA,gBAAI,KAAKD,gBAAL,KAA0B,KAAKC,WAAnC,EAAgD;AAC5C,mBAAKjD,QAAL,CAAc;AACVkD,gBAAAA,aAAa,EAAE;AADL,eAAd;AAGH;AACJ,WAVD;AAWH;AACJ;AACJ,KAjQkB;;AAAA,SAmQnBC,mBAnQmB,GAmQG,MAAM;AACxB,WAAKvE,KAAL,CAAWwE,OAAX,CAAmBC,OAAnB,CAA2B,uBAA3B;AACH,KArQkB;;AAAA,SAuQnBC,sBAvQmB,GAuQM,MAAM;AAC3B,WAAKtD,QAAL,CAAc;AACVuD,QAAAA,SAAS,EAAE;AADD,OAAd;AAGH,KA3QkB;;AAAA,SA6QnBC,mBA7QmB,GA6QG,MAAM;AACxB,WAAKxD,QAAL,CAAc;AACVuD,QAAAA,SAAS,EAAE;AADD,OAAd;AAGH,KAjRkB;;AAEf,SAAKzD,WAAL,GAAmB,IAAnB,CAFe,CAEoC;;AACnD,SAAKH,YAAL,GAAoB,CAApB;AACA,SAAKE,SAAL,GAAiB,IAAjB;AACA,SAAKL,OAAL,GAAe,IAAf;AACA,SAAKI,SAAL,GAAiB,IAAjB;AACA,SAAKD,YAAL,GAAoB,CAApB;AACA,SAAKqD,gBAAL,GAAwB,CAAxB;AACA,SAAKR,OAAL,GAAe;AAAEvE,MAAAA,EAAF;AAAMC,MAAAA;AAAN,KAAf;AACA,SAAK+E,WAAL,GAAmBQ,MAAM,CAACC,IAAP,CAAYzF,EAAZ,EAAgBiC,MAAhB,GAAyBuD,MAAM,CAACC,IAAP,CAAYxF,MAAZ,EAAoBgC,MAAhE;AAEA,SAAKO,KAAL,GAAa;AACTG,MAAAA,SAAS,EAAE,KADF;AACmC;AAC5CW,MAAAA,QAAQ,EAAEtD,EAAE,CAAC2D,cAFJ;AAEmC;AAC5CT,MAAAA,UAAU,EAAElD,EAAE,CAAC0D,gBAHN;AAGmC;AAC5CT,MAAAA,SAAS,EAAE,EAJF;AAImC;AAC5CD,MAAAA,MAAM,EAAE,EALC;AAKmC;AAC5CJ,MAAAA,OAAO,EAAE3C,MAAM,CAAC4C,SANP;AAMmC;AAC5CN,MAAAA,QAAQ,EAAE,IAPD;AAQT0C,MAAAA,aAAa,EAAE,KARN;AASTH,MAAAA,OAAO,EAAE,CATA;AAUTQ,MAAAA,SAAS,EAAE,KAVF;AAWTjB,MAAAA,aAAa,EAAE,KAXN;AAYT3C,MAAAA,YAAY,EAAE,CAZL;AAaTM,MAAAA,QAAQ,EAAE;AAbD,KAAb;AAeH;;AAED,QAAM0D,iBAAN,GAA0B;AACtB,UAAM;AAAE3E,MAAAA;AAAF,QAAW,KAAKJ,KAAtB;;AAEA,QAAI,CAACI,IAAI,CAACA,IAAL,CAAU4E,IAAf,EAAqB;AACjB,WAAKhF,KAAL,CAAWwE,OAAX,CAAmBS,IAAnB,CAAwB,cAAxB;AACA;AACH;;AAED,QAAI,CAAC7E,IAAI,CAACE,OAAL,CAAaD,IAAlB,EAAwB;AACpB,WAAKL,KAAL,CAAWwE,OAAX,CAAmBS,IAAnB,CAAwB,iBAAxB;AACA;AACH;;AAED,SAAKhF,UAAL;AACA,SAAK0D,gBAAL,CAAsB,KAAKC,OAA3B;AACA,SAAK3D,UAAL;AACH;;AAEDiF,EAAAA,oBAAoB,GAAG;AACnB,QAAI,CAAC,CAAC,KAAKrD,KAAL,CAAWD,QAAjB,EAA2B;AACvB,WAAKC,KAAL,CAAWD,QAAX,CAAoB,CAApB,EAAuBuD,KAAvB;AACA,WAAKtD,KAAL,CAAWD,QAAX,CAAoB,CAApB,EAAuBuD,KAAvB;AACH;;AACD,SAAK/D,QAAL,CAAc;AACVQ,MAAAA,QAAQ,EAAE;AADA,KAAd;AAGH;;AA4NDwD,EAAAA,MAAM,GAAG;AACL,UAAM;AAAEzC,MAAAA,QAAF;AAAYJ,MAAAA,UAAZ;AAAwBF,MAAAA,MAAxB;AAAgCJ,MAAAA,OAAhC;AAAyCqC,MAAAA,aAAzC;AAAwDK,MAAAA,SAAxD;AAAmEjB,MAAAA,aAAnE;AAAkFS,MAAAA;AAAlF,QAA8F,KAAKtC,KAAzG;;AAEA,QAAIyC,aAAJ,EAAmB;AACf,0BACI,oBAAC,cAAD;AACI,QAAA,UAAU,EAAEjF,EAAE,CAACgG,aADnB;AAEI,QAAA,EAAE,EAAE1F,EAFR;AAEY,QAAA,IAAI,EAAEC,IAFlB;AAGI,QAAA,YAAY,EAAE,KAAKuC,YAHvB;AAII,QAAA,UAAU,EAAE,KAAKW,UAJrB;AAKI,QAAA,QAAQ,EAAEH,QALd;AAMI,QAAA,UAAU,EAAEJ,UANhB;AAOI,QAAA,MAAM,EAAEF,MAPZ;AAQI,QAAA,MAAM,EAAEJ,OARZ;AASI,QAAA,YAAY,EAAE,KAAKiB,YATvB;AAUI,QAAA,SAAS,EAAE7D,EAAE,CAACiG,MAVlB;AAWI,QAAA,SAAS,EAAEX,SAXf;AAYI,QAAA,aAAa,EAAEjB,aAZnB;AAaI,QAAA,mBAAmB,EAAE,KAAKa,mBAb9B;AAcI,QAAA,sBAAsB,EAAE,KAAKG,sBAdjC;AAeI,QAAA,mBAAmB,EAAE,KAAKE,mBAf9B;AAgBI,QAAA,YAAY,EAAE,KAAK/C,KAAL,CAAWd,YAhB7B;AAiBI,QAAA,QAAQ,EAAE,KAAKc,KAAL,CAAWR,QAjBzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ;AAoBH,KArBD,MAsBK;AACD,0BAAO,oBAAC,WAAD;AAAa,QAAA,OAAO,EAAE8C,OAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACH;AACJ;;AArTmC;;AAAlCtE,K,CACK0F,S,GAAY;AACfnF,EAAAA,IAAI,EAAEZ,SAAS,CAACgG,QAAV,CAAmBhG,SAAS,CAACiG,GAA7B,EAAkCC,UADzB;AAEfC,EAAAA,QAAQ,EAAEnG,SAAS,CAACoG,IAAV,CAAeF;AAFV,C;;AAuTvB,SAASG,eAAT,CAAyBhE,KAAzB,EAAgC;AAC5B,SAAO;AAAEzB,IAAAA,IAAI,EAAEyB,KAAK,CAACzB;AAAd,GAAP;AACH;;AAED,eAAeX,OAAO,CAACoG,eAAD,CAAP,CAAyBtG,UAAU,CAACM,KAAD,CAAnC,CAAf","sourcesContent":["import React from 'react';\nimport SweepPresenter from './SweepPresenter';\nimport { D1_Api, soundURL } from 'api';\nimport { D1, TTobak } from 'images';\nimport { withRouter } from 'react-router-dom';\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport LoadingComp from 'Components/LoadingComp';\n\nconst UP = 'up';\nconst DOWN = 'down';\n\nclass Sweep extends React.PureComponent {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor(props) {\n        super();\n        this.buttonSound = null;                           // up_sweep, down_sweep 소리 경로\n        this.currentIndex = 0;\n        this.oriAnswer = null;\n        this.ques_id = null;\n        this.ques_path = null;\n        this.currentIndex = 0;\n        this.numOfLoadedImage = 0;\n        this.picture = { D1, TTobak };\n        this.totalImages = Object.keys(D1).length + Object.keys(TTobak).length;\n\n        this.state = {\n            gameState: false,                           // 게임 상태\n            UpButton: D1.d1_UpButton_UP,                // 버튼 이미지 상태\n            DownButton: D1.d1_DownButton_UP,            // 버튼 이미지 상태\n            stdAnswer: [],                              // 학습자 정답\n            Answer: [],                                 // 정답 상자\n            TTobaki: TTobak.ttobak1_1,                  // 또박이 이미지 상태\n            swpSound: null,\n            isImageLoaded: false,\n            percent: 0,\n            showPopup: false,\n            showNextPopup: false,\n            currentIndex: 0,\n            totalNum: 0,\n        };\n    }\n\n    async componentDidMount() {\n        const { user } = this.props;\n\n        if (!user.user.u_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        if (!user.student.s_id) {\n            this.props.history.push('/root/selectstd');\n            return;\n        }\n\n        this.newRequest();\n        this.imagesPreloading(this.picture);\n        this.newRequest();\n    }\n\n    componentWillUnmount() {\n        if (!!this.state.swpSound) {\n            this.state.swpSound[0].pause();\n            this.state.swpSound[1].pause();\n        }\n        this.setState({\n            swpSound: null,\n        })\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        try {\n            const { data } = await D1_Api.ask(4);\n            console.log(data);\n\n            if (data.code === 1) {\n                const { answers, swp: { ques_id, ques_path1, ques_path2 } } = data;\n                this.currentIndex = 0;\n                this.ques_id = ques_id;\n                this.ques_path = [ques_path2, ques_path1];\n                this.oriAnswer = answers;\n                this.buttonSound = [new Audio(soundURL + this.ques_path[0]), new Audio(soundURL + this.ques_path[1])];\n                this.setState({\n                    totalNum: this.oriAnswer.length,\n                })\n                this.setListener();\n                setTimeout(() => this.playSound(), 3000);\n            }\n            else console.log('data message: ' + data.message);\n        } catch (e) {\n            console.log('error: ' + e);\n        }\n    }\n\n    setListener = () => {\n        try {\n            this.setState({\n                swpSound: [\n                    (UP === this.oriAnswer[this.currentIndex][0] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1])),\n                    (UP === this.oriAnswer[this.currentIndex][1] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1]))\n                ],\n                currentIndex: this.currentIndex + 1,\n            })\n\n            this.state.swpSound[0].addEventListener('ended', () => {\n                setTimeout(() => {\n                    if (!!this.state.swpSound[1]) this.state.swpSound[1].play();\n                }, 900)\n            });\n\n            this.state.swpSound[1].addEventListener('ended', () => {\n                this.setState({\n                    gameState: true,\n                    TTobaki: TTobak.ttobak1_1\n                });\n            });\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    onTouchStart = (id) => {\n        const { Answer, stdAnswer, gameState } = this.state;\n        if (!gameState) return;\n\n        switch (id) {\n            case DOWN:\n                // console.log('down-down');\n                this.setState({\n                    DownButton: D1.d1_DownButton_DOWN,\n                    Answer: Answer.concat(gameState ? D1.d1_AnswerDown : []),\n                    stdAnswer: stdAnswer.concat(gameState ? DOWN : [])\n                });\n                break;\n            case UP:\n                // console.log('up-down');\n                this.setState({\n                    UpButton: D1.d1_UpButton_DOWN,\n                    Answer: Answer.concat(gameState ? D1.d1_AnswerUp : []),\n                    stdAnswer: stdAnswer.concat(gameState ? UP : [])\n                });\n                break;\n            default:\n        }\n    }\n\n    onTouchEnd = (id) => {\n        const { gameState } = this.state;\n        if (!gameState) return;\n\n        switch (id) {\n            case DOWN:\n                // console.log('down-up');\n                this.setState({\n                    DownButton: D1.d1_DownButton_UP\n                });\n                if (gameState && !!this.buttonSound[1]) this.buttonSound[1].play();\n                break;\n            case UP:\n                // console.log('up-up');\n                this.setState({\n                    UpButton: D1.d1_UpButton_UP\n                });\n                if (gameState && !!this.buttonSound[0]) this.buttonSound[0].play();\n                break;\n            default:\n        }\n        if (this.state.Answer.length === 2) this.finished();\n    }\n\n    TTobakiTouch = async () => {\n        if (this.state.gameState) {\n            this.playSound();\n        }\n    }\n\n    playSound = () => {\n        this.setState({\n            gameState: false,\n        });\n\n        if (!!this.state.swpSound[0]) this.state.swpSound[0].play();\n    }\n\n    finished = async () => {\n        this.setState({\n            gameState: false,\n            TTobaki: TTobak.ttobak2_1,\n        });\n\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        const { stdAnswer } = this.state;\n        const answer = [this.oriAnswer[this.currentIndex][0], this.oriAnswer[this.currentIndex][1]];\n\n        try {\n            console.log(s_id, this.ques_id, answer, stdAnswer)\n            const { data } = await D1_Api.answer(s_id, this.ques_id, answer, stdAnswer);\n            console.log(data);\n\n            setTimeout(() => {\n                this.setState({\n                    gameState: false,\n                    Answer: [],\n                    sweep: [],\n                    path: [],\n                    stdAnswer: [],\n                    TTobaki: TTobak.ttobak1_1,\n                });\n            }, 1500);\n\n            if (data.code === 1) {\n                if (data.to_next || data.to_next_freq) {\n                    this.newRequest();\n                    console.log('next');\n                }\n                else if (data.is_stop || data.to_next === '모든 단계를 풀었습니다.') {\n                    this.setState({\n                        showNextPopup: true,\n                    });\n                } else if (!data.to_next && !data.to_next_freq) {\n                    this.setState({\n                        showNextPopup: true,\n                    });\n                    return;\n                } else {\n                    if (this.currentIndex < this.oriAnswer.length - 1) this.currentIndex++;\n                    else {\n                        this.setState({\n                            showNextPopup: true,\n                        });\n                        return;\n                    }\n\n                    this.setListener();\n\n                    setTimeout(() => {\n                        this.playSound();\n                    }, 2000);\n                }\n            }\n        } catch (e) {\n            console.log(e);\n            // TODO 에러 처리\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                    }\n                };\n            }\n        }\n    }\n\n    onPopupButtonHandle = () => {\n        this.props.history.replace('/diagnose/recognition');\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { UpButton, DownButton, Answer, TTobaki, isImageLoaded, showPopup, showNextPopup, percent } = this.state;\n\n        if (isImageLoaded) {\n            return (\n                <SweepPresenter\n                    Background={D1.d1_background}\n                    UP={UP} DOWN={DOWN}\n                    onTouchStart={this.onTouchStart}\n                    onTouchEnd={this.onTouchEnd}\n                    UpButton={UpButton}\n                    DownButton={DownButton}\n                    Answer={Answer}\n                    TTobak={TTobaki}\n                    TTobakiTouch={this.TTobakiTouch}\n                    AnswerBox={D1.d1_box}\n                    showPopup={showPopup}\n                    showNextPopup={showNextPopup}\n                    onPopupButtonHandle={this.onPopupButtonHandle}\n                    onContinueButtonHandle={this.onContinueButtonHandle}\n                    onPauseButtonHandle={this.onPauseButtonHandle}\n                    currentIndex={this.state.currentIndex}\n                    totalNum={this.state.totalNum}\n                />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(Sweep));"]},"metadata":{},"sourceType":"module"}