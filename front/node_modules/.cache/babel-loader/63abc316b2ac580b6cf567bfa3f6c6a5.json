{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T2_Count/CountContainer.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { DndProvider } from 'react-dnd';\nimport { TouchBackend } from 'react-dnd-touch-backend';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport LoadingComp from 'Components/LoadingComp';\nimport { T2, TTobak } from 'images';\nimport { T_Api2, soundURL } from 'api';\nimport twinkle from 'twinkle.mp3';\nimport CountPresenter from './CountPresenter';\nconst idx_txt = 'count';\n\nclass Count extends React.Component {\n  constructor({\n    match,\n    location\n  }) {\n    super();\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n\n      try {\n        const {\n          data\n        } = await T_Api2.ask(s_id, idx_txt);\n        console.log(data);\n\n        if (data.code === 'specified' || data.code === 1) {\n          this.currentIndex = 0;\n          this.cure = data.cure;\n          this.currentCure = data.cure[this.currentIndex];\n          this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n          this.setState({\n            totalNum: this.cure.length\n          });\n        } else console.log('data message: ' + data.message);\n      } catch (e) {\n        console.log('error: ' + e);\n      }\n    };\n\n    this.playSound = () => {\n      if (!!this.currentAudio) {\n        this.currentAudio.play();\n        this.changeTTobaki(TTobak.ttobak3_2);\n        this.setState({\n          gameState: false\n        });\n        this.currentAudio.addEventListener('ended', () => {\n          this.setState({\n            gameState: true,\n            TTobaki: TTobak.ttobak1_1\n          });\n        });\n      }\n    };\n\n    this.TTobakiTouch = () => {\n      const {\n        gameState\n      } = this.state;\n\n      if (gameState) {\n        this.playSound();\n      }\n    };\n\n    this.changeTTobaki = ttobaki => {\n      this.setState({\n        TTobaki: ttobaki\n      });\n    };\n\n    this.answer = async () => {\n      this.effect_sound.play();\n      this.setState({\n        TTobaki: TTobak.ttobak2_1\n      });\n      const {\n        Apple: {\n          numOfApples\n        }\n      } = this.state;\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n      const {\n        data\n      } = await T_Api2.answer(s_id, this.cure[this.currentIndex].cure_word.length.toString(), numOfApples.toString(), this.cure[this.currentIndex].cure_id, this.learning_type === 'review' ? 'T' : 'F', idx_txt);\n      console.log(data);\n      if (this.currentIndex < this.cure.length - 1) this.currentIndex++;else {\n        this.gameDone();\n        return;\n      }\n      this.currentCure = this.cure[this.currentIndex];\n      this.currentAudio = new Audio(soundURL + this.cure[this.currentIndex].cure_path);\n      setTimeout(() => {\n        this.setState({\n          gameState: false,\n          timeOut: null,\n          isDragging: false,\n          touchPosition: [],\n          TTobaki: TTobak.ttobak1_1,\n          Apple: {\n            randomApple: T2.t2_Apples[Math.floor(Math.random() * 4)],\n            applesInBasket: [],\n            numOfApples: 0\n          },\n          currentIndex: this.currentIndex + 1\n        });\n      }, 1000);\n      setTimeout(() => {\n        this.playSound();\n      }, 2000);\n    };\n\n    this.createRandomApple = () => {\n      const newApple = T2.t2_Apples[Math.floor(Math.random() * 4)];\n      this.setState({\n        Apple: { ...this.state.Apple,\n          randomApple: newApple\n        }\n      });\n      return newApple;\n    };\n\n    this.dropApple = () => {\n      const {\n        Apple: {\n          applesInBasket,\n          numOfApples,\n          randomApple\n        }\n      } = this.state;\n      if (this.timeOut) clearTimeout(this.timeOut);\n      this.timeOut = setTimeout(() => {\n        this.answer();\n      }, 3000);\n      this.setState({\n        Apple: { ...this.state.Apple,\n          numOfApples: numOfApples <= 5 ? numOfApples + 1 : 5,\n          applesInBasket: applesInBasket.concat(randomApple)\n        }\n      });\n    };\n\n    this.gameDone = () => {\n      console.log('game doen!');\n\n      if (this.learning_type !== 'daily') {\n        this.setState({\n          showDonePopup: true\n        });\n      } else {\n        this.setState({\n          showDailyPopup: true\n        });\n      }\n    };\n\n    this.onTreeTouchStartHandle = e => {\n      this.setState({\n        isDragging: true,\n        touchPosition: [e.changedTouches[0].pageX, e.changedTouches[0].pageY]\n      });\n    };\n\n    this.onTreeTouchEndHandle = () => {\n      this.setState({\n        isDragging: false\n      });\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          if (typeof picture[i][prop] === 'object') {\n            let arr = picture[i][prop];\n\n            for (let i in arr) {\n              let img = new Image();\n              img.src = arr[i];\n\n              img.onload = () => {\n                this.setState({\n                  percent: ++this.numOfLoadedImage / this.totalImages * 100\n                });\n\n                if (this.numOfLoadedImage === this.totalImages) {\n                  this.setState({\n                    isImageLoaded: true\n                  });\n                  setTimeout(() => this.playSound(), 1000);\n                }\n              };\n            }\n          } else {\n            let img = new Image();\n            img.src = picture[i][prop];\n\n            img.onload = () => {\n              this.setState({\n                percent: ++this.numOfLoadedImage / this.totalImages * 100\n              });\n\n              if (this.numOfLoadedImage === this.totalImages) {\n                this.setState({\n                  isImageLoaded: true\n                });\n                setTimeout(() => this.playSound(), 1000);\n              }\n            };\n          }\n        }\n      }\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onRestartButtonHandle = () => {\n      this.setState({\n        showDonePopup: false\n      });\n      this.newRequest();\n      setTimeout(() => {\n        this.setState({\n          gameState: false,\n          timeOut: null,\n          isDragging: false,\n          touchPosition: [],\n          TTobaki: TTobak.ttobak1_1,\n          Apple: {\n            randomApple: T2.t2_Apples[Math.floor(Math.random() * 4)],\n            applesInBasket: [],\n            numOfApples: 0\n          }\n        });\n      }, 2000);\n      setTimeout(() => this.playSound(), 4000);\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.learning_type = match.params.learning_type;\n    this.effect_sound = new Audio(twinkle);\n    this.cure = null;\n    this.cureLength = 0;\n    this.currentIndex = 0;\n    this.currentAudio = null;\n    this.currentCure = 0;\n    this.timeOut = null;\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      T2,\n      TTobak\n    };\n    this.totalImages = Object.keys(T2).length + Object.keys(TTobak).length + 3;\n    this.state = {\n      gameState: false,\n      isDragging: false,\n      touchPosition: [],\n      Apple: {\n        randomApple: T2.t2_Apples[Math.floor(Math.random() * 4)],\n        applesInBasket: [],\n        numOfApples: 0\n      },\n      TTobaki: TTobak.ttobak1_1,\n      isImageLoaded: false,\n      showPopup: false,\n      showDonePopup: false,\n      showDailyPopup: false,\n      percent: 0,\n      currentIndex: 1,\n      totalNum: 0\n    };\n\n    if (this.learning_type === 'daily') {\n      console.log(location.state.data.cure);\n      this.cure = location.state.data.cure;\n      this.currentCure = this.cure[this.currentIndex];\n      this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n      this.state = { ...this.state,\n        totalNum: this.cure.length\n      };\n    }\n  }\n\n  async componentDidMount() {\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    if (!user.student.s_id) {\n      this.props.history.push('/root/selectstd');\n      return;\n    }\n\n    if (this.learning_type !== 'daily') this.newRequest();\n    this.imagesPreloading(this.picture);\n  }\n\n  componentWillUnmount() {\n    if (!!this.currentAudio) {\n      this.currentAudio.pause();\n      this.currentAudio = null;\n    }\n  }\n\n  render() {\n    const {\n      isDragging,\n      touchPosition,\n      Apple,\n      answer,\n      TTobaki,\n      isImageLoaded,\n      showPopup,\n      showDonePopup,\n      showDailyPopup,\n      percent,\n      currentIndex,\n      totalNum\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(DndProvider, {\n        backend: TouchBackend,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(CountPresenter, {\n        Background: T2.t2_background,\n        Basket: T2.t2_basket,\n        TTobak: TTobaki,\n        TTobakiTouch: this.TTobakiTouch,\n        onTreeTouchStartHandle: this.onTreeTouchStartHandle,\n        onTreeTouchEndHandle: this.onTreeTouchEndHandle,\n        isDragging: isDragging,\n        touchPosition: touchPosition,\n        createRandomApple: this.createRandomApple,\n        dropApple: this.dropApple,\n        Apple: Apple,\n        answer: answer,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onRestartButtonHandle: this.onRestartButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        showPopup: showPopup,\n        showDailyPopup: showDailyPopup,\n        showDonePopup: showDonePopup,\n        currentIndex: currentIndex,\n        totalNum: totalNum,\n        bt_complete: T2.bt_complete,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 21\n        }\n      }));\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nCount.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Count));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T2_Count/CountContainer.js"],"names":["React","withRouter","DndProvider","TouchBackend","PropTypes","connect","LoadingComp","T2","TTobak","T_Api2","soundURL","twinkle","CountPresenter","idx_txt","Count","Component","constructor","match","location","newRequest","console","log","user","props","s_id","student","data","ask","code","currentIndex","cure","currentCure","currentAudio","Audio","cure_path","setState","totalNum","length","message","e","playSound","play","changeTTobaki","ttobak3_2","gameState","addEventListener","TTobaki","ttobak1_1","TTobakiTouch","state","ttobaki","answer","effect_sound","ttobak2_1","Apple","numOfApples","cure_word","toString","cure_id","learning_type","gameDone","setTimeout","timeOut","isDragging","touchPosition","randomApple","t2_Apples","Math","floor","random","applesInBasket","createRandomApple","newApple","dropApple","clearTimeout","concat","showDonePopup","showDailyPopup","onTreeTouchStartHandle","changedTouches","pageX","pageY","onTreeTouchEndHandle","imagesPreloading","picture","i","prop","arr","img","Image","src","onload","percent","numOfLoadedImage","totalImages","isImageLoaded","onContinueButtonHandle","showPopup","onRestartButtonHandle","onPauseButtonHandle","params","cureLength","Object","keys","componentDidMount","u_id","history","push","componentWillUnmount","pause","render","t2_background","t2_basket","bt_complete","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { DndProvider } from 'react-dnd'\nimport { TouchBackend } from 'react-dnd-touch-backend';\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport LoadingComp from 'Components/LoadingComp';\nimport { T2, TTobak } from 'images';\nimport { T_Api2, soundURL } from 'api';\nimport twinkle from 'twinkle.mp3';\n\nimport CountPresenter from './CountPresenter';\n\nconst idx_txt = 'count';\n\nclass Count extends React.Component {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor({ match, location }) {\n        super();\n        this.learning_type = match.params.learning_type;\n        this.effect_sound = new Audio(twinkle);\n        this.cure = null;\n        this.cureLength = 0;\n        this.currentIndex = 0;\n        this.currentAudio = null;\n        this.currentCure = 0;\n        this.timeOut = null;\n        this.numOfLoadedImage = 0;\n        this.picture = { T2, TTobak };\n        this.totalImages = Object.keys(T2).length + Object.keys(TTobak).length + 3;\n\n        this.state = {\n            gameState: false,\n            isDragging: false,\n            touchPosition: [],\n            Apple: {\n                randomApple: T2.t2_Apples[Math.floor(Math.random() * 4)],\n                applesInBasket: [],\n                numOfApples: 0,\n            },\n            TTobaki: TTobak.ttobak1_1,\n            isImageLoaded: false,\n            showPopup: false,\n            showDonePopup: false,\n            showDailyPopup: false,\n            percent: 0,\n            currentIndex: 1,\n            totalNum: 0,\n        };\n\n        if (this.learning_type === 'daily') {\n            console.log(location.state.data.cure);\n            this.cure = location.state.data.cure;\n            this.currentCure = this.cure[this.currentIndex];\n            this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n            this.state = {\n                ...this.state,\n                totalNum: this.cure.length,\n            }\n        }\n    }\n\n    async componentDidMount() {\n        const { user } = this.props;\n\n        if (!user.user.u_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        if (!user.student.s_id) {\n            this.props.history.push('/root/selectstd');\n            return;\n        }\n\n        if (this.learning_type !== 'daily') this.newRequest();\n        this.imagesPreloading(this.picture);\n    }\n\n    componentWillUnmount() {\n        if (!!this.currentAudio) {\n            this.currentAudio.pause();\n            this.currentAudio = null;\n        }\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        try {\n            const { data } = await T_Api2.ask(s_id, idx_txt);\n            console.log(data);\n\n            if (data.code === 'specified' || data.code === 1) {\n                this.currentIndex = 0;\n                this.cure = data.cure;\n                this.currentCure = data.cure[this.currentIndex];\n                this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n\n                this.setState({\n                    totalNum: this.cure.length,\n                })\n            }\n            else console.log('data message: ' + data.message);\n        } catch (e) {\n            console.log('error: ' + e);\n        }\n    }\n\n    playSound = () => {\n        if (!!this.currentAudio) {\n            this.currentAudio.play();\n            this.changeTTobaki(TTobak.ttobak3_2);\n\n            this.setState({\n                gameState: false,\n            });\n\n            this.currentAudio.addEventListener('ended', () => {\n                this.setState({\n                    gameState: true,\n                    TTobaki: TTobak.ttobak1_1,\n                })\n            });\n        }\n    }\n\n    TTobakiTouch = () => {\n        const { gameState } = this.state;\n        if (gameState) {\n            this.playSound();\n        }\n    }\n\n    changeTTobaki = (ttobaki) => {\n        this.setState({\n            TTobaki: ttobaki\n        });\n    }\n\n    answer = async () => {\n        this.effect_sound.play();\n        this.setState({\n            TTobaki: TTobak.ttobak2_1\n        })\n        const { Apple: { numOfApples } } = this.state;\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        const { data } = await T_Api2.answer(\n            s_id,\n            this.cure[this.currentIndex].cure_word.length.toString(),\n            numOfApples.toString(),\n            this.cure[this.currentIndex].cure_id,\n            this.learning_type === 'review' ? 'T' : 'F',\n            idx_txt\n        );\n        console.log(data);\n\n        if (this.currentIndex < this.cure.length - 1) this.currentIndex++;\n        else {\n            this.gameDone();\n            return;\n        }\n\n        this.currentCure = this.cure[this.currentIndex];\n        this.currentAudio = new Audio(soundURL + this.cure[this.currentIndex].cure_path);\n\n        setTimeout(() => {\n            this.setState({\n                gameState: false,\n                timeOut: null,\n                isDragging: false,\n                touchPosition: [],\n                TTobaki: TTobak.ttobak1_1,\n                Apple: {\n                    randomApple: T2.t2_Apples[Math.floor(Math.random() * 4)],\n                    applesInBasket: [],\n                    numOfApples: 0,\n                },\n                currentIndex: this.currentIndex + 1\n            });\n        }, 1000);\n\n        setTimeout(() => {\n            this.playSound();\n        }, 2000);\n    }\n\n    createRandomApple = () => {\n        const newApple = T2.t2_Apples[Math.floor(Math.random() * 4)];\n\n        this.setState({\n            Apple: {\n                ...this.state.Apple,\n                randomApple: newApple,\n            }\n        })\n        return newApple;\n    }\n\n    dropApple = () => {\n        const { Apple: { applesInBasket, numOfApples, randomApple } } = this.state;\n        if (this.timeOut) clearTimeout(this.timeOut);\n\n        this.timeOut = setTimeout(() => {\n            this.answer();\n        }, 3000);\n\n        this.setState({\n            Apple: {\n                ...this.state.Apple,\n                numOfApples: numOfApples <= 5 ? numOfApples + 1 : 5,\n                applesInBasket: applesInBasket.concat(randomApple),\n            },\n        });\n    }\n\n    gameDone = () => {\n        console.log('game doen!');\n        if (this.learning_type !== 'daily') {\n            this.setState({\n                showDonePopup: true,\n            })\n        } else {\n            this.setState({\n                showDailyPopup: true,\n            })\n        }\n    }\n\n    onTreeTouchStartHandle = e => {\n        this.setState({\n            isDragging: true,\n            touchPosition: [e.changedTouches[0].pageX, e.changedTouches[0].pageY],\n        })\n    }\n\n    onTreeTouchEndHandle = () => {\n        this.setState({\n            isDragging: false,\n        })\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                if (typeof (picture[i][prop]) === 'object') {\n                    let arr = picture[i][prop];\n                    for (let i in arr) {\n                        let img = new Image();\n                        img.src = arr[i];\n                        img.onload = () => {\n                            this.setState({\n                                percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                            })\n                            if (this.numOfLoadedImage === this.totalImages) {\n                                this.setState({\n                                    isImageLoaded: true,\n                                })\n                                setTimeout(() => this.playSound(), 1000);\n                            }\n                        };\n                    }\n\n                } else {\n                    let img = new Image();\n                    img.src = picture[i][prop];\n                    img.onload = () => {\n                        this.setState({\n                            percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                        })\n                        if (this.numOfLoadedImage === this.totalImages) {\n                            this.setState({\n                                isImageLoaded: true,\n                            })\n                            setTimeout(() => this.playSound(), 1000);\n                        }\n                    };\n                }\n            }\n        }\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onRestartButtonHandle = () => {\n        this.setState({\n            showDonePopup: false,\n        })\n        this.newRequest();\n        setTimeout(() => {\n            this.setState({\n                gameState: false,\n                timeOut: null,\n                isDragging: false,\n                touchPosition: [],\n                TTobaki: TTobak.ttobak1_1,\n                Apple: {\n                    randomApple: T2.t2_Apples[Math.floor(Math.random() * 4)],\n                    applesInBasket: [],\n                    numOfApples: 0,\n                },\n            });\n        }, 2000);\n        setTimeout(() => this.playSound(), 4000);\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { isDragging, touchPosition, Apple, answer, TTobaki, isImageLoaded, showPopup, showDonePopup, showDailyPopup, percent,\n            currentIndex, totalNum } = this.state;\n        if (isImageLoaded) {\n            return (\n                <DndProvider backend={TouchBackend}>\n                    <CountPresenter\n                        Background={T2.t2_background}\n                        Basket={T2.t2_basket}\n                        TTobak={TTobaki}\n                        TTobakiTouch={this.TTobakiTouch}\n                        onTreeTouchStartHandle={this.onTreeTouchStartHandle}\n                        onTreeTouchEndHandle={this.onTreeTouchEndHandle}\n                        isDragging={isDragging}\n                        touchPosition={touchPosition}\n                        createRandomApple={this.createRandomApple}\n                        dropApple={this.dropApple}\n                        Apple={Apple}\n                        answer={answer}\n                        onContinueButtonHandle={this.onContinueButtonHandle}\n                        onRestartButtonHandle={this.onRestartButtonHandle}\n                        onPauseButtonHandle={this.onPauseButtonHandle}\n                        showPopup={showPopup}\n                        showDailyPopup={showDailyPopup}\n                        showDonePopup={showDonePopup}\n                        currentIndex={currentIndex}\n                        totalNum={totalNum}\n                        bt_complete={T2.bt_complete}\n                    />\n                </DndProvider>\n            );\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(Count));"]},"metadata":{},"sourceType":"module"}