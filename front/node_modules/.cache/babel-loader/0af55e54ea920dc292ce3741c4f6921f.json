{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T3_Common/CommonContainer.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { T3, TTobak } from 'images';\nimport CommonPresenter from './CommonPresenter';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport LoadingComp from 'Components/LoadingComp';\nimport { T_Api2, soundURL } from 'api';\nconst idx_text = 'common';\n\nclass Common extends React.Component {\n  constructor({\n    match,\n    location\n  }) {\n    super();\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n\n      try {\n        const {\n          data\n        } = await T_Api2.ask(s_id, idx_text);\n        console.log(data);\n\n        if (data.code === 'specified' || data.code === 1) {\n          this.currentIndex = 0;\n          this.cure = data.cure;\n          this.setCurrent(0);\n          this.setState({\n            totalNum: this.cure.length\n          });\n        } else console.log('data message: ' + data.message);\n      } catch (e) {\n        console.log('error: ' + e);\n      }\n    };\n\n    this.setCurrent = timeout => {\n      this.currentCure = this.cure[this.currentIndex];\n      this.currentAudio = [new Audio(soundURL + this.currentCure.com_e1path), new Audio(soundURL + this.currentCure.com_e2path), new Audio(soundURL + this.currentCure.com_e3path), new Audio(soundURL + this.currentCure.com_e4path), new Audio(soundURL + this.currentCure.com_w1path), new Audio(soundURL + this.currentCure.com_w2path), new Audio(soundURL + this.currentCure.com_w3path)];\n      this.setListener();\n      setTimeout(() => {\n        this.setState({\n          boxTextList: [this.cure[this.currentIndex].com_e1, this.cure[this.currentIndex].com_e2, this.cure[this.currentIndex].com_e3, this.cure[this.currentIndex].com_e4],\n          TTobaki: TTobak.ttobak1_1,\n          currentIndex: this.currentIndex + 1\n        });\n      }, timeout);\n    };\n\n    this.setListener = () => {\n      this.currentAudio[0].addEventListener('ended', () => {\n        this.listenerFunc(0, 500);\n      });\n      this.currentAudio[1].addEventListener('ended', () => {\n        this.listenerFunc(1, 500);\n      });\n      this.currentAudio[2].addEventListener('ended', () => {\n        this.listenerFunc(2, 500);\n      });\n      this.currentAudio[3].addEventListener('ended', () => {\n        this.listenerFunc(3, 1500);\n      });\n      this.currentAudio[4].addEventListener('ended', () => {\n        this.setState({\n          TTobaki: TTobak.ttobak1_1\n        });\n        setTimeout(() => {\n          if (!!this.currentAudio[5]) {\n            this.currentAudio[5].play();\n            this.setState({\n              TTobaki: TTobak.ttobak3_2\n            });\n          }\n        }, 1000);\n      });\n      this.currentAudio[5].addEventListener('ended', () => {\n        this.setState({\n          TTobaki: TTobak.ttobak1_1\n        });\n        setTimeout(() => {\n          if (!!this.currentAudio[6]) {\n            this.currentAudio[6].play();\n            this.setState({\n              TTobaki: TTobak.ttobak3_2\n            });\n          }\n        }, 1000);\n      });\n      this.currentAudio[6].addEventListener('ended', () => {\n        this.setState({\n          gameState: true,\n          TTobaki: TTobak.ttobak1_1\n        });\n      });\n    };\n\n    this.listenerFunc = (index, time) => {\n      this.setState({\n        TTobaki: TTobak.ttobak1_1\n      });\n      setTimeout(() => {\n        if (!!this.currentAudio[index + 1]) {\n          this.currentAudio[index + 1].play();\n          this.setState({\n            TTobaki: TTobak.ttobak1_2\n          });\n        }\n      }, time);\n    };\n\n    this.playSound = () => {\n      this.setState({\n        gameState: false,\n        TTobaki: TTobak.ttobak1_2\n      });\n\n      if (!!this.currentAudio[0]) {\n        this.currentAudio[0].play();\n      }\n    };\n\n    this.onTTobakiTouchHandle = () => {\n      const {\n        gameState\n      } = this.state;\n      if (gameState) this.playSound();\n    };\n\n    this.onBoxTouchHandle = async index => {\n      const {\n        gameState\n      } = this.state;\n      if (!gameState) return;\n      this.setState({\n        TTobaki: TTobak.ttobak2_2\n      });\n\n      try {\n        const {\n          user\n        } = this.props;\n        const s_id = user.student.s_id;\n        const {\n          boxTextList,\n          is_review\n        } = this.state;\n        const {\n          data\n        } = await T_Api2.answer(s_id, this.cure[this.currentIndex].com_ans, boxTextList[index], this.cure[this.currentIndex].com_id, is_review, idx_text);\n        console.log(data);\n\n        if (data.code === 1) {\n          if (this.currentIndex < this.cure.length - 1) {\n            this.currentIndex++;\n          } else {\n            this.gameDone();\n            return;\n          }\n\n          this.setCurrent(2000);\n          setTimeout(() => {\n            this.playSound();\n          }, 4000);\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.gameDone = () => {\n      console.log('game doen!');\n\n      if (this.learning_type !== 'daily') {\n        this.setState({\n          showDonePopup: true\n        });\n      } else {\n        this.setState({\n          showDailyPopup: true\n        });\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n              setTimeout(() => this.playSound(), 1000);\n            }\n          };\n        }\n      }\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onRestartButtonHandle = () => {\n      this.setState({\n        showDonePopup: false\n      });\n      this.newRequest();\n      setTimeout(() => this.playSound(), 2000);\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.learning_type = match.params.learning_type;\n    this.currentAudio = null;\n    this.cure = null;\n    this.currentIndex = 0;\n    this.currentCure = null;\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      T3,\n      TTobak\n    };\n    this.totalImages = Object.keys(T3).length + Object.keys(TTobak).length;\n    this.state = {\n      is_review: match.params.is_review,\n      TTobaki: TTobak.ttobak1_1,\n      gameState: false,\n      boxTextList: null,\n      isAnimate: [false, false, false, false],\n      isImageLoaded: false,\n      showPopup: false,\n      showDonePopup: false,\n      showDailyPopup: false,\n      percent: 0,\n      currentIndex: 1,\n      totalNum: 0\n    };\n\n    if (this.learning_type === 'daily') {\n      console.log(location.state.data.cure);\n      this.cure = location.state.data.cure;\n      this.state = { ...this.state,\n        totalNum: this.cure.length\n      };\n    }\n  }\n\n  async componentDidMount() {\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    if (!user.student.s_id) {\n      this.props.history.push('/root/selectstd');\n      return;\n    }\n\n    if (this.learning_type !== 'daily') this.newRequest();else {\n      this.setCurrent(0);\n    }\n    this.imagesPreloading(this.picture);\n  }\n\n  componentWillUnmount() {\n    for (var i = 0; i < 7; i++) {\n      if (!!this.currentAudio[i]) {\n        this.currentAudio[i].pause();\n        this.currentAudio[i] = null;\n      }\n    }\n  }\n\n  render() {\n    const {\n      boxTextList,\n      isAnimate,\n      TTobaki,\n      isImageLoaded,\n      showPopup,\n      showDonePopup,\n      showDailyPopup,\n      percent,\n      gameState,\n      currentIndex,\n      totalNum\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(CommonPresenter, {\n        Background: T3.t3_background,\n        TTobak: TTobaki,\n        onTTobakiTouchHandle: this.onTTobakiTouchHandle,\n        boxTextList: boxTextList || ['ㄱ', 'ㄴ', 'ㄷ', 'ㄹ'],\n        onBoxTouchHandle: this.onBoxTouchHandle,\n        BoxImg: T3.t3_textbox,\n        isAnimate: isAnimate,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onRestartButtonHandle: this.onRestartButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        showPopup: showPopup,\n        showDailyPopup: showDailyPopup,\n        showDonePopup: showDonePopup,\n        gameState: gameState,\n        currentIndex: currentIndex,\n        totalNum: totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 21\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nCommon.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Common));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T3_Common/CommonContainer.js"],"names":["React","withRouter","T3","TTobak","CommonPresenter","PropTypes","connect","LoadingComp","T_Api2","soundURL","idx_text","Common","Component","constructor","match","location","newRequest","console","log","user","props","s_id","student","data","ask","code","currentIndex","cure","setCurrent","setState","totalNum","length","message","e","timeout","currentCure","currentAudio","Audio","com_e1path","com_e2path","com_e3path","com_e4path","com_w1path","com_w2path","com_w3path","setListener","setTimeout","boxTextList","com_e1","com_e2","com_e3","com_e4","TTobaki","ttobak1_1","addEventListener","listenerFunc","play","ttobak3_2","gameState","index","time","ttobak1_2","playSound","onTTobakiTouchHandle","state","onBoxTouchHandle","ttobak2_2","is_review","answer","com_ans","com_id","gameDone","learning_type","showDonePopup","showDailyPopup","imagesPreloading","picture","i","prop","img","Image","src","onload","percent","numOfLoadedImage","totalImages","isImageLoaded","onContinueButtonHandle","showPopup","onRestartButtonHandle","onPauseButtonHandle","params","Object","keys","isAnimate","componentDidMount","u_id","history","push","componentWillUnmount","pause","render","t3_background","t3_textbox","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport { T3, TTobak } from 'images';\nimport CommonPresenter from './CommonPresenter';\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport LoadingComp from 'Components/LoadingComp';\nimport { T_Api2, soundURL } from 'api';\n\nconst idx_text = 'common';\n\nclass Common extends React.Component {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor({ match, location }) {\n        super();\n        this.learning_type = match.params.learning_type;\n        this.currentAudio = null;\n        this.cure = null;\n        this.currentIndex = 0;\n        this.currentCure = null;\n        this.numOfLoadedImage = 0;\n        this.picture = { T3, TTobak };\n        this.totalImages = Object.keys(T3).length + Object.keys(TTobak).length;\n\n        this.state = {\n            is_review: match.params.is_review,\n            TTobaki: TTobak.ttobak1_1,\n            gameState: false,\n            boxTextList: null,\n            isAnimate: [false, false, false, false],\n            isImageLoaded: false,\n            showPopup: false,\n            showDonePopup: false,\n            showDailyPopup: false,\n            percent: 0,\n            currentIndex: 1,\n            totalNum: 0,\n        };\n\n        if (this.learning_type === 'daily') {\n            console.log(location.state.data.cure);\n            this.cure = location.state.data.cure;\n            this.state = {\n                ...this.state,\n                totalNum: this.cure.length,\n            }\n        }\n    }\n\n    async componentDidMount() {\n        const { user } = this.props;\n\n        if (!user.user.u_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        if (!user.student.s_id) {\n            this.props.history.push('/root/selectstd');\n            return;\n        }\n\n        if (this.learning_type !== 'daily') this.newRequest();\n        else {\n            this.setCurrent(0);\n        }\n        this.imagesPreloading(this.picture);\n    }\n\n    componentWillUnmount() {\n        for (var i = 0; i < 7; i++) {\n            if (!!this.currentAudio[i]) {\n                this.currentAudio[i].pause();\n                this.currentAudio[i] = null;\n            }\n        }\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        try {\n            const { data } = await T_Api2.ask(s_id, idx_text);\n            console.log(data);\n\n            if (data.code === 'specified' || data.code === 1) {\n                this.currentIndex = 0;\n                this.cure = data.cure;\n                this.setCurrent(0);\n\n                this.setState({\n                    totalNum: this.cure.length,\n                })\n            }\n            else console.log('data message: ' + data.message);\n        } catch (e) {\n            console.log('error: ' + e);\n        }\n    }\n\n    setCurrent = (timeout) => {\n        this.currentCure = this.cure[this.currentIndex];\n        this.currentAudio = [\n            new Audio(soundURL + this.currentCure.com_e1path),\n            new Audio(soundURL + this.currentCure.com_e2path),\n            new Audio(soundURL + this.currentCure.com_e3path),\n            new Audio(soundURL + this.currentCure.com_e4path),\n            new Audio(soundURL + this.currentCure.com_w1path),\n            new Audio(soundURL + this.currentCure.com_w2path),\n            new Audio(soundURL + this.currentCure.com_w3path),\n        ];\n\n        this.setListener();\n        setTimeout(() => {\n            this.setState({\n                boxTextList: [\n                    this.cure[this.currentIndex].com_e1,\n                    this.cure[this.currentIndex].com_e2,\n                    this.cure[this.currentIndex].com_e3,\n                    this.cure[this.currentIndex].com_e4],\n                TTobaki: TTobak.ttobak1_1,\n                currentIndex: this.currentIndex + 1\n            })\n        }, timeout);\n    }\n\n    setListener = () => {\n        this.currentAudio[0].addEventListener('ended', () => {\n            this.listenerFunc(0, 500);\n        });\n        this.currentAudio[1].addEventListener('ended', () => {\n            this.listenerFunc(1, 500);\n        });\n        this.currentAudio[2].addEventListener('ended', () => {\n            this.listenerFunc(2, 500);\n        });\n        this.currentAudio[3].addEventListener('ended', () => {\n            this.listenerFunc(3, 1500);\n        });\n        this.currentAudio[4].addEventListener('ended', () => {\n            this.setState({\n                TTobaki: TTobak.ttobak1_1\n            })\n            setTimeout(() => {\n                if (!!this.currentAudio[5]) {\n                    this.currentAudio[5].play();\n                    this.setState({\n                        TTobaki: TTobak.ttobak3_2\n                    })\n                }\n            }, 1000);\n        });\n        this.currentAudio[5].addEventListener('ended', () => {\n            this.setState({\n                TTobaki: TTobak.ttobak1_1\n            })\n            setTimeout(() => {\n                if (!!this.currentAudio[6]) {\n                    this.currentAudio[6].play();\n                    this.setState({\n                        TTobaki: TTobak.ttobak3_2\n                    })\n                }\n            }, 1000);\n        });\n        this.currentAudio[6].addEventListener('ended', () => {\n            this.setState({\n                gameState: true,\n                TTobaki: TTobak.ttobak1_1\n            })\n        });\n    }\n\n    listenerFunc = (index, time) => {\n        this.setState({\n            TTobaki: TTobak.ttobak1_1\n        });\n        setTimeout(() => {\n            if (!!this.currentAudio[index + 1]) {\n                this.currentAudio[index + 1].play();\n                this.setState({\n                    TTobaki: TTobak.ttobak1_2\n                })\n            }\n        }, time);\n    }\n\n    playSound = () => {\n        this.setState({\n            gameState: false,\n            TTobaki: TTobak.ttobak1_2\n        });\n\n        if (!!this.currentAudio[0]) {\n            this.currentAudio[0].play();\n        }\n    }\n\n    onTTobakiTouchHandle = () => {\n        const { gameState } = this.state;\n        if (gameState) this.playSound();\n    }\n\n    onBoxTouchHandle = async (index) => {\n        const { gameState } = this.state;\n        if (!gameState) return;\n\n        this.setState({\n            TTobaki: TTobak.ttobak2_2\n        })\n\n        try {\n            const { user } = this.props;\n            const s_id = user.student.s_id;\n            const { boxTextList, is_review } = this.state;\n            const { data } = await T_Api2.answer(\n                s_id,\n                this.cure[this.currentIndex].com_ans,\n                boxTextList[index],\n                this.cure[this.currentIndex].com_id,\n                is_review,\n                idx_text\n            );\n            console.log(data);\n\n            if (data.code === 1) {\n                if (this.currentIndex < this.cure.length - 1) {\n                    this.currentIndex++;\n                } else {\n                    this.gameDone();\n                    return;\n                }\n\n                this.setCurrent(2000);\n\n                setTimeout(() => {\n                    this.playSound();\n                }, 4000);\n\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    gameDone = () => {\n        console.log('game doen!');\n        if (this.learning_type !== 'daily') {\n            this.setState({\n                showDonePopup: true,\n            })\n        } else {\n            this.setState({\n                showDailyPopup: true,\n            })\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    })\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                        setTimeout(() => this.playSound(), 1000);\n                    }\n                };\n            }\n        }\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onRestartButtonHandle = () => {\n        this.setState({\n            showDonePopup: false,\n        })\n        this.newRequest();\n        setTimeout(() => this.playSound(), 2000);\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { boxTextList, isAnimate, TTobaki, isImageLoaded, showPopup, showDonePopup, showDailyPopup, percent, gameState,\n            currentIndex, totalNum } = this.state;\n\n        if (isImageLoaded) {\n            return (<CommonPresenter\n                Background={T3.t3_background}\n                TTobak={TTobaki}\n                onTTobakiTouchHandle={this.onTTobakiTouchHandle}\n                boxTextList={boxTextList || ['ㄱ', 'ㄴ', 'ㄷ', 'ㄹ']}\n                onBoxTouchHandle={this.onBoxTouchHandle}\n                BoxImg={T3.t3_textbox}\n                isAnimate={isAnimate}\n                onContinueButtonHandle={this.onContinueButtonHandle}\n                onRestartButtonHandle={this.onRestartButtonHandle}\n                onPauseButtonHandle={this.onPauseButtonHandle}\n                showPopup={showPopup}\n                showDailyPopup={showDailyPopup}\n                showDonePopup={showDonePopup}\n                gameState={gameState}\n                currentIndex={currentIndex}\n                totalNum={totalNum}\n            />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(Common));"]},"metadata":{},"sourceType":"module"}