{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Diagnose/Sweep/SweepContainer.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { D1_Api, soundURL, D_tutorial } from 'api';\nimport LoadingComp from 'Components/LoadingComp';\nimport SweepPresenter from './SweepPresenter';\nimport { D1, TTobak } from 'images';\nconst idx_txt = 'swp';\nconst UP = 'up';\nconst DOWN = 'down';\nconst initState = {\n  gameState: false,\n  // 게임 상태\n  UpButton: D1.d1_UpButton_UP,\n  // 버튼 이미지 상태\n  DownButton: D1.d1_DownButton_UP,\n  // 버튼 이미지 상태\n  stdAnswer: [],\n  // 학습자 정답\n  Answer: [],\n  // 정답 상자\n  TTobaki: TTobak.ttobak1_1,\n  // 또박이 이미지 상태\n  swpSound: null,\n  isImageLoaded: false,\n  percent: 0,\n  showPopup: false,\n  showNextPopup: false,\n  currentIndex: 1,\n  totalNum: 0,\n  tutorialState: false\n};\n\nclass Sweep extends React.PureComponent {\n  constructor(props) {\n    super();\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n\n      try {\n        // console.log(s_id);\n        const {\n          data\n        } = await D1_Api.ask(s_id);\n        console.log(data);\n\n        switch (data.code) {\n          case 1:\n            const {\n              answers,\n              swp: {\n                ques_id,\n                ques_path1,\n                ques_path2\n              }\n            } = data;\n            this.currentIndex = 0;\n            this.ques_id = ques_id;\n            this.ques_path = [ques_path2, ques_path1];\n            this.oriAnswer = answers;\n            this.buttonSound = [new Audio(soundURL + this.ques_path[0]), new Audio(soundURL + this.ques_path[1])];\n            this.setState({\n              totalNum: this.oriAnswer.length\n            });\n            this.setListener();\n            setTimeout(() => this.playSound(), 3000);\n            break;\n\n          case 2:\n            break;\n\n          case 3:\n            break;\n\n          case 'tutorial':\n            this.tutorial(data);\n            break;\n\n          default:\n            console.log('data message: ' + data.message);\n            break;\n        }\n      } catch (e) {\n        console.log('error: ' + e);\n      }\n    };\n\n    this.tutorial = data => {\n      this.voice = [];\n      this.voice_desc = [];\n      this.swp = [new Audio(soundURL + data.sample_ques.ques_path2), new Audio(soundURL + data.sample_ques.ques_path1)];\n      this.buttonSound = [new Audio(soundURL + data.sample_ques.ques_path2), new Audio(soundURL + data.sample_ques.ques_path1)];\n\n      for (let i = 0; i < 4; i++) {\n        this.voice.push(new Audio(soundURL + data.voice[i].voc_path));\n        this.voice_desc.push(data.voice[i].voc_desc);\n        this.voice[i].addEventListener('ended', () => {\n          this.setState({\n            TTobaki: TTobak.ttobak1_1,\n            gameState: 'tutorial',\n            tutorialState: this.voice_desc[i]\n          });\n        });\n      }\n\n      const swpUp = cnt => {\n        if (cnt >= 2) {\n          setTimeout(() => {\n            if (!!this.voice[1]) this.voice[1].play();\n            this.setState({\n              TTobaki: TTobak.ttobak3_2,\n              gameState: false\n            });\n          }, 1000);\n          return cnt;\n        }\n\n        if (!!this.swp[0]) this.swp[0].play();\n        this.setState({\n          UpButton: D1.d1_UpButton_DOWN\n        });\n        setTimeout(() => {\n          this.setState({\n            UpButton: D1.d1_UpButton_UP\n          });\n          setTimeout(() => {\n            cnt = swpUp(++cnt);\n          }, 1000);\n        }, 500);\n      };\n\n      this.voice[0].addEventListener('ended', () => {\n        this.setState({\n          TTobaki: TTobak.ttobak1_1\n        });\n        setTimeout(() => {\n          swpUp(0);\n        }, 1000);\n      });\n      this.voice[3].addEventListener('ended', async () => {\n        const {\n          data\n        } = await D_tutorial.answer(this.props.user.student.s_id, idx_txt);\n        console.log(data);\n        this.setState({\n          initState\n        });\n        this.newRequest();\n        this.voice = null;\n        this.voice_desc = null;\n        this.swp = null;\n        this.buttonSound = null;\n      });\n      setTimeout(() => {\n        if (!!this.voice[0]) this.voice[0].play();\n        this.setState({\n          TTobaki: TTobak.ttobak3_2,\n          gameState: false\n        });\n      }, 1500);\n    };\n\n    this.tutorialButtonEvent = id => {\n      const swpDown = cnt => {\n        if (cnt >= 2) {\n          setTimeout(() => {\n            if (!!this.voice[2]) this.voice[2].play();\n            this.setState({\n              TTobaki: TTobak.ttobak3_2,\n              gameState: false\n            });\n          }, 1200);\n          return cnt;\n        }\n\n        if (!!this.swp[1]) this.swp[1].play();\n        this.setState({\n          DownButton: D1.d1_DownButton_DOWN\n        });\n        setTimeout(() => {\n          this.setState({\n            DownButton: D1.d1_DownButton_UP\n          });\n          setTimeout(() => {\n            cnt = swpDown(++cnt);\n          }, 1000);\n        }, 500);\n      };\n\n      if (id === UP && this.state.tutorialState === this.voice_desc[1]) {\n        this.setState({\n          tutorialState: this.voice_desc[2]\n        });\n        setTimeout(() => {\n          swpDown(0);\n        }, 2000);\n      } else if (id === DOWN && this.state.tutorialState === this.voice_desc[2]) {\n        setTimeout(() => {\n          this.setState({\n            TTobaki: TTobak.ttobak3_2,\n            gameState: false,\n            tutorialState: this.voice_desc[3]\n          });\n          if (!!this.voice[3]) this.voice[3].play();\n        }, 2000);\n      }\n    };\n\n    this.setListener = () => {\n      try {\n        this.setState({\n          swpSound: [UP === this.oriAnswer[this.currentIndex][0] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1]), UP === this.oriAnswer[this.currentIndex][1] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1])],\n          currentIndex: this.currentIndex + 1\n        });\n        this.state.swpSound[0].addEventListener('ended', () => {\n          setTimeout(() => {\n            if (!!this.state.swpSound[1]) this.state.swpSound[1].play();\n          }, 900);\n        });\n        this.state.swpSound[1].addEventListener('ended', () => {\n          this.setState({\n            gameState: true,\n            TTobaki: TTobak.ttobak1_1\n          });\n        });\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.onTouchStart = id => {\n      const {\n        Answer,\n        stdAnswer,\n        gameState\n      } = this.state;\n\n      switch (id) {\n        case DOWN:\n          // console.log('down-down');\n          this.setState({\n            DownButton: D1.d1_DownButton_DOWN,\n            Answer: Answer.concat(gameState === true ? D1.d1_AnswerDown : []),\n            stdAnswer: stdAnswer.concat(gameState === true ? DOWN : [])\n          });\n          break;\n\n        case UP:\n          // console.log('up-down');\n          this.setState({\n            UpButton: D1.d1_UpButton_DOWN,\n            Answer: Answer.concat(gameState === true ? D1.d1_AnswerUp : []),\n            stdAnswer: stdAnswer.concat(gameState === true ? UP : [])\n          });\n          break;\n\n        default:\n      }\n    };\n\n    this.onTouchEnd = id => {\n      const {\n        gameState\n      } = this.state;\n\n      switch (id) {\n        case DOWN:\n          // console.log('down-up');\n          this.setState({\n            DownButton: D1.d1_DownButton_UP\n          });\n          if (gameState !== false && !!this.buttonSound[1]) this.buttonSound[1].play();\n          break;\n\n        case UP:\n          // console.log('up-up');\n          this.setState({\n            UpButton: D1.d1_UpButton_UP\n          });\n          if (gameState !== false && !!this.buttonSound[0]) this.buttonSound[0].play();\n          break;\n\n        default:\n      }\n\n      if (gameState === 'tutorial') {\n        this.tutorialButtonEvent(id);\n      } else if (this.state.Answer.length === 2) this.finished();\n    };\n\n    this.TTobakiTouch = async () => {\n      if (this.state.gameState === true) {\n        this.playSound();\n      }\n    };\n\n    this.playSound = () => {\n      if (!!this.state.swpSound[0]) {\n        this.setState({\n          gameState: false,\n          TTobaki: TTobak.ttobak3_2\n        });\n        this.state.swpSound[0].play();\n      }\n    };\n\n    this.finished = async () => {\n      if (this.state.gameState === 'tutorial') return;\n      this.setState({\n        gameState: false,\n        TTobaki: TTobak.ttobak2_1\n      });\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n      const {\n        stdAnswer\n      } = this.state;\n      const answer = [this.oriAnswer[this.currentIndex][0], this.oriAnswer[this.currentIndex][1]];\n\n      try {\n        const {\n          data\n        } = await D1_Api.answer(s_id, this.ques_id, answer, stdAnswer);\n        console.log(data);\n        setTimeout(() => {\n          this.setState({\n            gameState: false,\n            Answer: [],\n            sweep: [],\n            path: [],\n            stdAnswer: [],\n            TTobaki: TTobak.ttobak1_1\n          });\n        }, 1500);\n\n        if (data.code === 1) {\n          if (data.to_next === true || data.to_next_freq === true) {\n            this.newRequest();\n            console.log('next');\n          } else if (data.is_stop || data.to_next === '모든 단계를 풀었습니다.') {\n            this.setState({\n              showNextPopup: true\n            });\n          } else {\n            if (this.currentIndex < this.oriAnswer.length - 1) this.currentIndex++;else {\n              this.setState({\n                showNextPopup: true\n              });\n              return;\n            }\n            this.setListener();\n            setTimeout(() => {\n              this.playSound();\n            }, 2000);\n          }\n        }\n      } catch (e) {\n        console.log(e); // TODO 에러 처리\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n            }\n          };\n        }\n      }\n    };\n\n    this.onPopupButtonHandle = () => {\n      this.props.history.replace('/diagnose/recognition');\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.buttonSound = null; // up_sweep, down_sweep 소리 경로\n\n    this.currentIndex = 0;\n    this.oriAnswer = null;\n    this.ques_id = null;\n    this.ques_path = null;\n    this.currentIndex = 0;\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      D1,\n      TTobak\n    };\n    this.totalImages = Object.keys(D1).length + Object.keys(TTobak).length;\n    this.state = initState;\n  }\n\n  async componentDidMount() {\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id || !user.student.s_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    this.imagesPreloading(this.picture);\n    this.newRequest();\n  }\n\n  componentWillUnmount() {\n    let audioArr = [this.voice, this.voice_desc, this.swp];\n\n    for (let i = 0; i < audioArr.length; i++) {\n      if (!!audioArr[i]) {\n        for (var j = 0; i < audioArr[i].length; j++) {\n          if (!!audioArr[i][j]) {\n            audioArr[i][j].pause();\n            audioArr[i][j] = null;\n          }\n        }\n      }\n    }\n\n    if (!!this.state.swpSound) {\n      this.state.swpSound[0].pause();\n      this.state.swpSound[1].pause();\n    }\n\n    this.setState({\n      swpSound: null\n    });\n  }\n\n  render() {\n    const {\n      UpButton,\n      DownButton,\n      Answer,\n      TTobaki,\n      isImageLoaded,\n      showPopup,\n      showNextPopup,\n      percent\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(SweepPresenter, {\n        Background: D1.d1_background,\n        UP: UP,\n        DOWN: DOWN,\n        onTouchStart: this.onTouchStart,\n        onTouchEnd: this.onTouchEnd,\n        UpButton: UpButton,\n        DownButton: DownButton,\n        Answer: Answer,\n        TTobak: TTobaki,\n        TTobakiTouch: this.TTobakiTouch,\n        AnswerBox: D1.d1_box,\n        showPopup: showPopup,\n        showNextPopup: showNextPopup,\n        onPopupButtonHandle: this.onPopupButtonHandle,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        currentIndex: this.state.currentIndex,\n        totalNum: this.state.totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 17\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nSweep.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Sweep));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Diagnose/Sweep/SweepContainer.js"],"names":["React","withRouter","PropTypes","connect","D1_Api","soundURL","D_tutorial","LoadingComp","SweepPresenter","D1","TTobak","idx_txt","UP","DOWN","initState","gameState","UpButton","d1_UpButton_UP","DownButton","d1_DownButton_UP","stdAnswer","Answer","TTobaki","ttobak1_1","swpSound","isImageLoaded","percent","showPopup","showNextPopup","currentIndex","totalNum","tutorialState","Sweep","PureComponent","constructor","props","newRequest","console","log","user","s_id","student","data","ask","code","answers","swp","ques_id","ques_path1","ques_path2","ques_path","oriAnswer","buttonSound","Audio","setState","length","setListener","setTimeout","playSound","tutorial","message","e","voice","voice_desc","sample_ques","i","push","voc_path","voc_desc","addEventListener","swpUp","cnt","play","ttobak3_2","d1_UpButton_DOWN","answer","tutorialButtonEvent","id","swpDown","d1_DownButton_DOWN","state","onTouchStart","concat","d1_AnswerDown","d1_AnswerUp","onTouchEnd","finished","TTobakiTouch","ttobak2_1","sweep","path","to_next","to_next_freq","is_stop","imagesPreloading","picture","prop","img","Image","src","onload","numOfLoadedImage","totalImages","onPopupButtonHandle","history","replace","onContinueButtonHandle","onPauseButtonHandle","Object","keys","componentDidMount","u_id","componentWillUnmount","audioArr","j","pause","render","d1_background","d1_box","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport { D1_Api, soundURL, D_tutorial } from 'api';\nimport LoadingComp from 'Components/LoadingComp';\nimport SweepPresenter from './SweepPresenter';\nimport { D1, TTobak } from 'images';\n\nconst idx_txt = 'swp';\nconst UP = 'up';\nconst DOWN = 'down';\nconst initState = {\n    gameState: false,                           // 게임 상태\n    UpButton: D1.d1_UpButton_UP,                // 버튼 이미지 상태\n    DownButton: D1.d1_DownButton_UP,            // 버튼 이미지 상태\n    stdAnswer: [],                              // 학습자 정답\n    Answer: [],                                 // 정답 상자\n    TTobaki: TTobak.ttobak1_1,                  // 또박이 이미지 상태\n    swpSound: null,\n    isImageLoaded: false,\n    percent: 0,\n    showPopup: false,\n    showNextPopup: false,\n    currentIndex: 1,\n    totalNum: 0,\n    tutorialState: false,\n};\n\nclass Sweep extends React.PureComponent {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor(props) {\n        super();\n        this.buttonSound = null;                           // up_sweep, down_sweep 소리 경로\n        this.currentIndex = 0;\n        this.oriAnswer = null;\n        this.ques_id = null;\n        this.ques_path = null;\n        this.currentIndex = 0;\n        this.numOfLoadedImage = 0;\n        this.picture = { D1, TTobak };\n        this.totalImages = Object.keys(D1).length + Object.keys(TTobak).length;\n\n        this.state = initState;\n    }\n\n    async componentDidMount() {\n        const { user } = this.props;\n\n        if (!user.user.u_id || !user.student.s_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        this.imagesPreloading(this.picture);\n        this.newRequest();\n    }\n\n    componentWillUnmount() {\n        let audioArr = [this.voice, this.voice_desc, this.swp];\n        for (let i = 0; i < audioArr.length; i++) {\n            if (!!audioArr[i]) {\n                for (var j = 0; i < audioArr[i].length; j++) {\n                    if (!!audioArr[i][j]) {\n                        audioArr[i][j].pause();\n                        audioArr[i][j] = null;\n                    }\n                }\n            }\n        }\n\n        if (!!this.state.swpSound) {\n            this.state.swpSound[0].pause();\n            this.state.swpSound[1].pause();\n        }\n        this.setState({\n            swpSound: null,\n        });\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        try {\n            // console.log(s_id);\n            const { data } = await D1_Api.ask(s_id);\n            console.log(data);\n\n            switch (data.code) {\n                case 1:\n                    const { answers, swp: { ques_id, ques_path1, ques_path2 } } = data;\n                    this.currentIndex = 0;\n                    this.ques_id = ques_id;\n                    this.ques_path = [ques_path2, ques_path1];\n                    this.oriAnswer = answers;\n                    this.buttonSound = [new Audio(soundURL + this.ques_path[0]), new Audio(soundURL + this.ques_path[1])];\n                    this.setState({\n                        totalNum: this.oriAnswer.length,\n                    });\n                    this.setListener();\n                    setTimeout(() => this.playSound(), 3000);\n                    break;\n                case 2:\n                    break;\n                case 3:\n                    break;\n                case 'tutorial':\n                    this.tutorial(data);\n                    break;\n                default:\n                    console.log('data message: ' + data.message);\n                    break;\n            }\n        } catch (e) {\n            console.log('error: ' + e);\n        }\n    }\n\n    tutorial = (data) => {\n        this.voice = [];\n        this.voice_desc = [];\n        this.swp = [new Audio(soundURL + data.sample_ques.ques_path2), new Audio(soundURL + data.sample_ques.ques_path1)];\n        this.buttonSound = [new Audio(soundURL + data.sample_ques.ques_path2), new Audio(soundURL + data.sample_ques.ques_path1)];\n        for (let i = 0; i < 4; i++) {\n            this.voice.push(new Audio(soundURL + data.voice[i].voc_path));\n            this.voice_desc.push(data.voice[i].voc_desc);\n\n            this.voice[i].addEventListener('ended', () => {\n                this.setState({\n                    TTobaki: TTobak.ttobak1_1,\n                    gameState: 'tutorial',\n                    tutorialState: this.voice_desc[i],\n                });\n            });\n        }\n\n        const swpUp = (cnt) => {\n            if (cnt >= 2) {\n                setTimeout(() => {\n                    if (!!this.voice[1]) this.voice[1].play();\n                    this.setState({\n                        TTobaki: TTobak.ttobak3_2,\n                        gameState: false,\n                    })\n                }, 1000);\n                return cnt;\n            }\n\n            if (!!this.swp[0]) this.swp[0].play();\n            this.setState({\n                UpButton: D1.d1_UpButton_DOWN,\n            });\n            setTimeout(() => {\n                this.setState({\n                    UpButton: D1.d1_UpButton_UP,\n                });\n                setTimeout(() => {\n                    cnt = swpUp(++cnt);\n                }, 1000);\n            }, 500);\n        };\n\n        this.voice[0].addEventListener('ended', () => {\n            this.setState({\n                TTobaki: TTobak.ttobak1_1,\n            });\n\n            setTimeout(() => {\n                swpUp(0);\n            }, 1000);\n        })\n\n        this.voice[3].addEventListener('ended', async () => {\n            const { data } = await D_tutorial.answer(this.props.user.student.s_id, idx_txt);\n            console.log(data);\n            this.setState({\n                initState,\n            });\n            this.newRequest();\n\n            this.voice = null;\n            this.voice_desc = null;\n            this.swp = null;\n            this.buttonSound = null;\n        })\n\n        setTimeout(() => {\n            if (!!this.voice[0]) this.voice[0].play();\n            this.setState({\n                TTobaki: TTobak.ttobak3_2,\n                gameState: false,\n            })\n        }, 1500);\n    }\n\n    tutorialButtonEvent = (id) => {\n        const swpDown = (cnt) => {\n            if (cnt >= 2) {\n                setTimeout(() => {\n                    if (!!this.voice[2]) this.voice[2].play();\n                    this.setState({\n                        TTobaki: TTobak.ttobak3_2,\n                        gameState: false,\n                    })\n                }, 1200);\n                return cnt;\n            }\n\n            if (!!this.swp[1]) this.swp[1].play();\n            this.setState({\n                DownButton: D1.d1_DownButton_DOWN,\n            });\n            setTimeout(() => {\n                this.setState({\n                    DownButton: D1.d1_DownButton_UP,\n                });\n                setTimeout(() => {\n                    cnt = swpDown(++cnt);\n                }, 1000);\n            }, 500);\n        };\n\n        if (id === UP && this.state.tutorialState === this.voice_desc[1]) {\n            this.setState({\n                tutorialState: this.voice_desc[2],\n            })\n            setTimeout(() => {\n                swpDown(0);\n            }, 2000);\n        } else if (id === DOWN && this.state.tutorialState === this.voice_desc[2]) {\n            setTimeout(() => {\n                this.setState({\n                    TTobaki: TTobak.ttobak3_2,\n                    gameState: false,\n                    tutorialState: this.voice_desc[3],\n                })\n                if (!!this.voice[3]) this.voice[3].play();\n            }, 2000);\n        }\n    }\n\n    setListener = () => {\n        try {\n            this.setState({\n                swpSound: [\n                    (UP === this.oriAnswer[this.currentIndex][0] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1])),\n                    (UP === this.oriAnswer[this.currentIndex][1] ? new Audio(soundURL + this.ques_path[0]) : new Audio(soundURL + this.ques_path[1]))\n                ],\n                currentIndex: this.currentIndex + 1,\n            })\n\n            this.state.swpSound[0].addEventListener('ended', () => {\n                setTimeout(() => {\n                    if (!!this.state.swpSound[1]) this.state.swpSound[1].play();\n                }, 900)\n            });\n\n            this.state.swpSound[1].addEventListener('ended', () => {\n                this.setState({\n                    gameState: true,\n                    TTobaki: TTobak.ttobak1_1\n                });\n            });\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    onTouchStart = (id) => {\n        const { Answer, stdAnswer, gameState } = this.state;\n\n        switch (id) {\n            case DOWN:\n                // console.log('down-down');\n                this.setState({\n                    DownButton: D1.d1_DownButton_DOWN,\n                    Answer: Answer.concat(gameState === true ? D1.d1_AnswerDown : []),\n                    stdAnswer: stdAnswer.concat(gameState === true ? DOWN : [])\n                });\n                break;\n            case UP:\n                // console.log('up-down');\n                this.setState({\n                    UpButton: D1.d1_UpButton_DOWN,\n                    Answer: Answer.concat(gameState === true ? D1.d1_AnswerUp : []),\n                    stdAnswer: stdAnswer.concat(gameState === true ? UP : [])\n                });\n                break;\n            default:\n        }\n    }\n\n    onTouchEnd = (id) => {\n        const { gameState } = this.state;\n\n        switch (id) {\n            case DOWN:\n                // console.log('down-up');\n                this.setState({\n                    DownButton: D1.d1_DownButton_UP\n                });\n                if (gameState !== false && !!this.buttonSound[1]) this.buttonSound[1].play();\n                break;\n            case UP:\n                // console.log('up-up');\n                this.setState({\n                    UpButton: D1.d1_UpButton_UP\n                });\n                if (gameState !== false && !!this.buttonSound[0]) this.buttonSound[0].play();\n                break;\n            default:\n        }\n\n        if (gameState === 'tutorial') {\n            this.tutorialButtonEvent(id);\n        }\n        else if (this.state.Answer.length === 2) this.finished();\n    }\n\n    TTobakiTouch = async () => {\n        if (this.state.gameState === true) {\n            this.playSound();\n        }\n    }\n\n    playSound = () => {\n        if (!!this.state.swpSound[0]) {\n            this.setState({\n                gameState: false,\n                TTobaki: TTobak.ttobak3_2,\n            });\n\n            this.state.swpSound[0].play();\n        }\n    }\n\n    finished = async () => {\n        if (this.state.gameState === 'tutorial') return;\n\n        this.setState({\n            gameState: false,\n            TTobaki: TTobak.ttobak2_1,\n        });\n\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        const { stdAnswer } = this.state;\n        const answer = [this.oriAnswer[this.currentIndex][0], this.oriAnswer[this.currentIndex][1]];\n\n        try {\n            const { data } = await D1_Api.answer(s_id, this.ques_id, answer, stdAnswer);\n            console.log(data);\n\n            setTimeout(() => {\n                this.setState({\n                    gameState: false,\n                    Answer: [],\n                    sweep: [],\n                    path: [],\n                    stdAnswer: [],\n                    TTobaki: TTobak.ttobak1_1,\n                });\n            }, 1500);\n\n            if (data.code === 1) {\n                if (data.to_next === true || data.to_next_freq === true) {\n                    this.newRequest();\n                    console.log('next');\n                }\n                else if (data.is_stop || data.to_next === '모든 단계를 풀었습니다.') {\n                    this.setState({\n                        showNextPopup: true,\n                    });\n                } else {\n                    if (this.currentIndex < this.oriAnswer.length - 1) this.currentIndex++;\n                    else {\n                        this.setState({\n                            showNextPopup: true,\n                        });\n                        return;\n                    }\n\n                    this.setListener();\n\n                    setTimeout(() => {\n                        this.playSound();\n                    }, 2000);\n                }\n            }\n        } catch (e) {\n            console.log(e);\n            // TODO 에러 처리\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                    }\n                };\n            }\n        }\n    }\n\n    onPopupButtonHandle = () => {\n        this.props.history.replace('/diagnose/recognition');\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { UpButton, DownButton, Answer, TTobaki, isImageLoaded, showPopup, showNextPopup, percent } = this.state;\n\n        if (isImageLoaded) {\n            return (\n                <SweepPresenter\n                    Background={D1.d1_background}\n                    UP={UP} DOWN={DOWN}\n                    onTouchStart={this.onTouchStart}\n                    onTouchEnd={this.onTouchEnd}\n                    UpButton={UpButton}\n                    DownButton={DownButton}\n                    Answer={Answer}\n                    TTobak={TTobaki}\n                    TTobakiTouch={this.TTobakiTouch}\n                    AnswerBox={D1.d1_box}\n                    showPopup={showPopup}\n                    showNextPopup={showNextPopup}\n                    onPopupButtonHandle={this.onPopupButtonHandle}\n                    onContinueButtonHandle={this.onContinueButtonHandle}\n                    onPauseButtonHandle={this.onPauseButtonHandle}\n                    currentIndex={this.state.currentIndex}\n                    totalNum={this.state.totalNum}\n                />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(Sweep));"]},"metadata":{},"sourceType":"module"}