{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T6_ConsoMatch/ConsoMatchContainer.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ConsoMatchPresenter from './ConsoMatchPresenter';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport LoadingComp from 'Components/LoadingComp';\nimport { T6, Characters } from 'images';\nimport { T_Api4, soundURL, T_tutorial } from 'api';\nconst idx_txt = 'consomatch';\nconst initState = {\n  gameState: false,\n  PicBoxList: null,\n  Worm: Characters.worm2_2,\n  isImageLoaded: false,\n  showPopup: false,\n  showDonePopup: false,\n  showDailyPopup: false,\n  percent: 0,\n  currentIndex: 1,\n  totalNum: 0\n};\n\nclass ConsoMatch extends React.Component {\n  constructor({\n    match\n  }) {\n    super();\n\n    this.getListFilter = (key, value) => {\n      return this.cure.filter(object => {\n        return object[key] === value;\n      })[0];\n    };\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n      const {\n        data\n      } = await T_Api4.ask(s_id);\n      console.log(data);\n\n      if (data.code === 'tutorial') {\n        this.tutorial(data);\n        return;\n      }\n\n      if (data.code === 'specified' || data.code === 1) {\n        this.currentIndex = 0;\n        this.answer = data.answer;\n        this.cure = data.cure;\n        if (this.numOfLoadedImage !== this.totalImages) this.pictursPreloading(this.cure);\n        this.totalImages += this.cure.length;\n        this.setCurrent(0);\n        this.setState({\n          totalNum: this.cure.length,\n          cureText: this.currentCure.cure_text\n        });\n        setTimeout(() => this.playSound(), 2000);\n      } else console.log('data message: ' + data.message);\n    };\n\n    this.daily = () => {\n      if (this.props.location.state.data.code === 'tutorial') {\n        this.tutorial(this.props.location.state.data);\n        return;\n      }\n\n      console.log(this.props.location.state.data);\n      this.answer = this.props.location.state.data.answer;\n      this.cure = this.props.location.state.data.cure;\n      this.currentCure = this.answer[this.currentIndex];\n      this.currentCure.is_first = 'T';\n      if (this.numOfLoadedImage !== this.totalImages) this.pictursPreloading(this.cure);\n      this.setState({\n        totalNum: this.answer.length,\n        cureText: this.currentCure.cure_text,\n        PicBoxList: [soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2]\n      });\n      this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n      this.currentAudio.addEventListener('ended', () => {\n        this.setState({\n          gameState: true,\n          Worm: Characters.worm2_2\n        });\n      });\n      setTimeout(() => this.playSound(), 2000);\n    };\n\n    this.tutorial = data => {\n      this.voice = [new Audio(soundURL + data.tut_voice[0].voc_path), new Audio(soundURL + data.tut_voice[1].voc_path), new Audio(soundURL + data.tut_voice[2].voc_path)];\n      this.currentCure = data.sample_ques;\n      this.setState({\n        PicBoxList: [soundURL + this.currentCure[0].cure_path2, soundURL + this.currentCure[1].cure_path2, soundURL + this.currentCure[2].cure_path2]\n      });\n      this.currentAudio = new Audio(soundURL + this.currentCure[0].cure_path);\n      this.currentAudio.addEventListener('ended', () => {\n        this.setState({\n          Worm: Characters.worm2_2\n        });\n        setTimeout(() => {\n          this.voice[1].play();\n        }, 1000);\n      });\n      this.voice[0].addEventListener('ended', () => {\n        setTimeout(() => {\n          this.playSound();\n        }, 1000);\n      });\n      this.voice[1].addEventListener('ended', () => {\n        this.setState({\n          gameState: 'tutorial',\n          Worm: Characters.worm2_2\n        });\n      });\n      this.voice[2].addEventListener('ended', async () => {\n        const {\n          data\n        } = await T_tutorial.answer(this.props.user.student.s_id, idx_txt, this.currentCure.cure_id);\n        console.log(data);\n        if (this.learning_type === 'daily') this.daily();else this.newRequest();\n        this.currentAudio = null;\n        this.currentCure = null;\n        this.voice = null;\n      });\n      setTimeout(() => {\n        this.voice[0].play();\n      }, 2000);\n    };\n\n    this.setCurrent = timeout => {\n      this.currentCure = this.answer[this.currentIndex];\n      this.currentCure.is_first = 'T';\n      this.currentAudio.remove();\n      this.currentAudio = null;\n      this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n      this.currentAudio.addEventListener('ended', () => {\n        this.setState({\n          gameState: true,\n          Worm: Characters.worm2_2\n        });\n      });\n      setTimeout(() => {\n        this.setState({\n          PicBoxList: [soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2],\n          currentIndex: this.currentIndex + 1,\n          Worm: Characters.worm2_2\n        });\n      }, timeout);\n    };\n\n    this.playSound = () => {\n      if (!!this.currentAudio) {\n        this.setState({\n          gameState: false,\n          Worm: Characters.worm2_1\n        });\n        this.currentAudio.play();\n      }\n    };\n\n    this.gameDone = () => {\n      console.log('done!');\n\n      if (this.learning_type !== 'daily') {\n        this.setState({\n          showDonePopup: true\n        });\n      } else {\n        this.setState({\n          showDailyPopup: true\n        });\n      }\n    };\n\n    this.onFrameTouchHandle = async id => {\n      const {\n        gameState\n      } = this.state;\n\n      if (gameState === 'tutorial') {\n        if (id === 0) {\n          this.setState({\n            gameState: false\n          });\n          setTimeout(() => {\n            this.voice[2].play();\n          }, 1000);\n        }\n\n        return;\n      }\n\n      if (!gameState) return;\n      this.setState({\n        gameState: false\n      });\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n      const cure_id = [this.getListFilter('cure_tid', this.currentCure[0]).cure_id, this.getListFilter('cure_tid', this.currentCure[1]).cure_id, this.getListFilter('cure_tid', this.currentCure[2]).cure_id];\n      const {\n        data\n      } = await T_Api4.answer(s_id, cure_id, this.getListFilter('cure_tid', this.currentCure[id]).cure_word, this.getListFilter('cure_tid', this.currentCure[3][0]).cure_word, this.learning_type === 'review' ? 'T' : 'F', this.learning_type === 'daily' ? 'T' : 'F', this.currentCure.is_first);\n      console.log(data);\n\n      switch (data.code) {\n        case 1:\n          if (data.correct_voice.voc_desc === 'retry') {\n            this.currentCure.is_first = 'F';\n            this.retry_script = new Audio(soundURL + data.correct_voice.voc_path);\n            this.retry_script.addEventListener('ended', () => {\n              this.setState({\n                gameState: true,\n                Worm: Characters.worm2_2\n              });\n            });\n            setTimeout(() => {\n              this.retry_script.play();\n              this.setState({\n                gameState: false,\n                Worm: Characters.worm2_1\n              });\n            }, 1000);\n            return;\n          } else {\n            this.setState({\n              Worm: Characters.worm3_1\n            });\n            this.good_script = new Audio(soundURL + data.correct_voice.voc_path);\n            this.good_script.addEventListener('ended', () => this.nextStep());\n            setTimeout(() => {\n              this.good_script.play();\n              this.setState({\n                gameState: false\n              });\n            }, 1000);\n          }\n\n          break;\n\n        case 2:\n          console.log(data.message);\n          this.gameDone();\n          break;\n\n        default:\n          this.props.history.push('/main/main');\n          break;\n      }\n    };\n\n    this.nextStep = () => {\n      if (this.currentIndex < this.answer.length - 1) this.currentIndex++;else {\n        this.gameDone();\n        return;\n      }\n      this.setCurrent(1000);\n      setTimeout(() => {\n        this.playSound();\n      }, 2000);\n    };\n\n    this.onWormTouchHandle = () => {\n      if (this.state.gameState) this.playSound();\n    };\n\n    this.pictursPreloading = picture => {\n      let timeoutPreloading = setTimeout(() => {\n        this.props.history.push('/main/main');\n      }, 10000);\n\n      try {\n        for (let i in picture) {\n          let img = new Image();\n          img.src = soundURL + picture[i].cure_path2;\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n              setTimeout(() => this.playSound(), 1000);\n              clearTimeout(timeoutPreloading);\n            }\n          };\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n              if (this.learning_type !== 'daily') this.newRequest();else this.daily();\n            }\n          };\n        }\n      }\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onRestartButtonHandle = () => {\n      this.setState({\n        showDonePopup: false\n      });\n      this.newRequest();\n      setTimeout(() => this.playSound(), 2000);\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.learning_type = match.params.learning_type;\n    this.cure = null;\n    this.answer = null;\n    this.currentCure = null;\n    this.currentAudio = null;\n    this.currentIndex = 0;\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      T6,\n      Characters\n    };\n    this.totalImages = Object.keys(T6).length + Object.keys(Characters).length;\n    this.state = initState;\n  }\n\n  componentDidCatch() {}\n\n  async componentDidMount() {\n    this.imagesPreloading(this.picture);\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id || !user.student.s_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n  }\n\n  componentWillUnmount() {\n    if (!!this.currentAudio) {\n      this.currentAudio.pause();\n      this.currentAudio.remove();\n      this.currentAudio = null;\n    }\n\n    if (!!this.voice) {\n      for (let i = 0; i < this.voice.length; i++) {\n        if (!!this.voice[i]) {\n          this.voice[i].pause();\n          this.voice[i].remove();\n          this.voice[i] = null;\n        }\n      }\n    }\n  }\n\n  render() {\n    const {\n      PicBoxList,\n      Worm,\n      isImageLoaded,\n      showPopup,\n      percent,\n      gameState,\n      showDailyPopup,\n      showDonePopup,\n      currentIndex,\n      totalNum\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(ConsoMatchPresenter, {\n        Background: T6.t6_background,\n        Worm: Worm,\n        onWormTouchHandle: this.onWormTouchHandle,\n        frameList: PicBoxList || [T6.t6_excpic, T6.t6_excpic, T6.t6_excpic],\n        onFrameTouchHandle: this.onFrameTouchHandle,\n        showPopup: showPopup,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        onRestartButtonHandle: this.onRestartButtonHandle,\n        showDailyPopup: showDailyPopup,\n        showDonePopup: showDonePopup,\n        gameState: gameState,\n        currentIndex: currentIndex,\n        totalNum: totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 17\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nConsoMatch.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(ConsoMatch));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T6_ConsoMatch/ConsoMatchContainer.js"],"names":["React","withRouter","ConsoMatchPresenter","PropTypes","connect","LoadingComp","T6","Characters","T_Api4","soundURL","T_tutorial","idx_txt","initState","gameState","PicBoxList","Worm","worm2_2","isImageLoaded","showPopup","showDonePopup","showDailyPopup","percent","currentIndex","totalNum","ConsoMatch","Component","constructor","match","getListFilter","key","value","cure","filter","object","newRequest","console","log","user","props","s_id","student","data","ask","code","tutorial","answer","numOfLoadedImage","totalImages","pictursPreloading","length","setCurrent","setState","cureText","currentCure","cure_text","setTimeout","playSound","message","daily","location","state","is_first","cure_path2","currentAudio","Audio","cure_path","addEventListener","voice","tut_voice","voc_path","sample_ques","play","cure_id","learning_type","timeout","remove","worm2_1","gameDone","onFrameTouchHandle","id","cure_word","correct_voice","voc_desc","retry_script","worm3_1","good_script","nextStep","history","push","onWormTouchHandle","picture","timeoutPreloading","i","img","Image","src","onload","clearTimeout","e","imagesPreloading","prop","onContinueButtonHandle","onRestartButtonHandle","onPauseButtonHandle","params","Object","keys","componentDidCatch","componentDidMount","u_id","componentWillUnmount","pause","render","t6_background","t6_excpic","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,mBAAP,MAAgC,uBAAhC;AAEA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,OAAOC,WAAP,MAAwB,wBAAxB;AACA,SAASC,EAAT,EAAaC,UAAb,QAA+B,QAA/B;AACA,SAASC,MAAT,EAAiBC,QAAjB,EAA2BC,UAA3B,QAA6C,KAA7C;AAEA,MAAMC,OAAO,GAAG,YAAhB;AACA,MAAMC,SAAS,GAAG;AACdC,EAAAA,SAAS,EAAE,KADG;AAEdC,EAAAA,UAAU,EAAE,IAFE;AAGdC,EAAAA,IAAI,EAAER,UAAU,CAACS,OAHH;AAIdC,EAAAA,aAAa,EAAE,KAJD;AAKdC,EAAAA,SAAS,EAAE,KALG;AAMdC,EAAAA,aAAa,EAAE,KAND;AAOdC,EAAAA,cAAc,EAAE,KAPF;AAQdC,EAAAA,OAAO,EAAE,CARK;AASdC,EAAAA,YAAY,EAAE,CATA;AAUdC,EAAAA,QAAQ,EAAE;AAVI,CAAlB;;AAaA,MAAMC,UAAN,SAAyBxB,KAAK,CAACyB,SAA/B,CAAyC;AAMrCC,EAAAA,WAAW,CAAC;AAAEC,IAAAA;AAAF,GAAD,EAAY;AACnB;;AADmB,SA+CvBC,aA/CuB,GA+CP,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC5B,aAAO,KAAKC,IAAL,CAAUC,MAAV,CAAkBC,MAAD,IAAY;AAAE,eAAOA,MAAM,CAACJ,GAAD,CAAN,KAAgBC,KAAvB;AAA8B,OAA7D,EAA+D,CAA/D,CAAP;AACH,KAjDsB;;AAAA,SAmDvBI,UAnDuB,GAmDV,YAAY;AACrBC,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,YAAM;AAAEC,QAAAA;AAAF,UAAW,KAAKC,KAAtB;AACA,YAAMC,IAAI,GAAGF,IAAI,CAACG,OAAL,CAAaD,IAA1B;AAEA,YAAM;AAAEE,QAAAA;AAAF,UAAW,MAAMjC,MAAM,CAACkC,GAAP,CAAWH,IAAX,CAAvB;AACAJ,MAAAA,OAAO,CAACC,GAAR,CAAYK,IAAZ;;AAEA,UAAIA,IAAI,CAACE,IAAL,KAAc,UAAlB,EAA8B;AAC1B,aAAKC,QAAL,CAAcH,IAAd;AACA;AACH;;AAED,UAAIA,IAAI,CAACE,IAAL,KAAc,WAAd,IAA6BF,IAAI,CAACE,IAAL,KAAc,CAA/C,EAAkD;AAC9C,aAAKrB,YAAL,GAAoB,CAApB;AACA,aAAKuB,MAAL,GAAcJ,IAAI,CAACI,MAAnB;AACA,aAAKd,IAAL,GAAYU,IAAI,CAACV,IAAjB;AAEA,YAAI,KAAKe,gBAAL,KAA0B,KAAKC,WAAnC,EAAgD,KAAKC,iBAAL,CAAuB,KAAKjB,IAA5B;AAChD,aAAKgB,WAAL,IAAoB,KAAKhB,IAAL,CAAUkB,MAA9B;AACA,aAAKC,UAAL,CAAgB,CAAhB;AAEA,aAAKC,QAAL,CAAc;AACV5B,UAAAA,QAAQ,EAAE,KAAKQ,IAAL,CAAUkB,MADV;AAEVG,UAAAA,QAAQ,EAAE,KAAKC,WAAL,CAAiBC;AAFjB,SAAd;AAIAC,QAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACH,OAdD,MAeKrB,OAAO,CAACC,GAAR,CAAY,mBAAmBK,IAAI,CAACgB,OAApC;AAER,KAjFsB;;AAAA,SAmFvBC,KAnFuB,GAmFf,MAAM;AACV,UAAI,KAAKpB,KAAL,CAAWqB,QAAX,CAAoBC,KAApB,CAA0BnB,IAA1B,CAA+BE,IAA/B,KAAwC,UAA5C,EAAwD;AACpD,aAAKC,QAAL,CAAc,KAAKN,KAAL,CAAWqB,QAAX,CAAoBC,KAApB,CAA0BnB,IAAxC;AACA;AACH;;AAEDN,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAKE,KAAL,CAAWqB,QAAX,CAAoBC,KAApB,CAA0BnB,IAAtC;AAEA,WAAKI,MAAL,GAAc,KAAKP,KAAL,CAAWqB,QAAX,CAAoBC,KAApB,CAA0BnB,IAA1B,CAA+BI,MAA7C;AACA,WAAKd,IAAL,GAAY,KAAKO,KAAL,CAAWqB,QAAX,CAAoBC,KAApB,CAA0BnB,IAA1B,CAA+BV,IAA3C;AACA,WAAKsB,WAAL,GAAmB,KAAKR,MAAL,CAAY,KAAKvB,YAAjB,CAAnB;AACA,WAAK+B,WAAL,CAAiBQ,QAAjB,GAA4B,GAA5B;AAEA,UAAI,KAAKf,gBAAL,KAA0B,KAAKC,WAAnC,EAAgD,KAAKC,iBAAL,CAAuB,KAAKjB,IAA5B;AAEhD,WAAKoB,QAAL,CAAc;AACV5B,QAAAA,QAAQ,EAAE,KAAKsB,MAAL,CAAYI,MADZ;AAEVG,QAAAA,QAAQ,EAAE,KAAKC,WAAL,CAAiBC,SAFjB;AAGVxC,QAAAA,UAAU,EAAE,CACRL,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDS,UADvD,EAERrD,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDS,UAFvD,EAGRrD,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDS,UAHvD;AAHF,OAAd;AAUA,WAAKC,YAAL,GAAoB,IAAIC,KAAJ,CAAUvD,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAA/B,EAAuDY,SAA5E,CAApB;AACA,WAAKF,YAAL,CAAkBG,gBAAlB,CAAmC,OAAnC,EAA4C,MAAM;AAC9C,aAAKf,QAAL,CAAc;AACVtC,UAAAA,SAAS,EAAE,IADD;AAEVE,UAAAA,IAAI,EAAER,UAAU,CAACS;AAFP,SAAd;AAIH,OALD;AAMAuC,MAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACH,KApHsB;;AAAA,SAsHvBZ,QAtHuB,GAsHXH,IAAD,IAAU;AACjB,WAAK0B,KAAL,GAAa,CACT,IAAIH,KAAJ,CAAUvD,QAAQ,GAAGgC,IAAI,CAAC2B,SAAL,CAAe,CAAf,EAAkBC,QAAvC,CADS,EAET,IAAIL,KAAJ,CAAUvD,QAAQ,GAAGgC,IAAI,CAAC2B,SAAL,CAAe,CAAf,EAAkBC,QAAvC,CAFS,EAGT,IAAIL,KAAJ,CAAUvD,QAAQ,GAAGgC,IAAI,CAAC2B,SAAL,CAAe,CAAf,EAAkBC,QAAvC,CAHS,CAAb;AAKA,WAAKhB,WAAL,GAAmBZ,IAAI,CAAC6B,WAAxB;AAEA,WAAKnB,QAAL,CAAc;AACVrC,QAAAA,UAAU,EAAE,CACRL,QAAQ,GAAG,KAAK4C,WAAL,CAAiB,CAAjB,EAAoBS,UADvB,EAERrD,QAAQ,GAAG,KAAK4C,WAAL,CAAiB,CAAjB,EAAoBS,UAFvB,EAGRrD,QAAQ,GAAG,KAAK4C,WAAL,CAAiB,CAAjB,EAAoBS,UAHvB;AADF,OAAd;AAQA,WAAKC,YAAL,GAAoB,IAAIC,KAAJ,CAAUvD,QAAQ,GAAG,KAAK4C,WAAL,CAAiB,CAAjB,EAAoBY,SAAzC,CAApB;AACA,WAAKF,YAAL,CAAkBG,gBAAlB,CAAmC,OAAnC,EAA4C,MAAM;AAC9C,aAAKf,QAAL,CAAc;AACVpC,UAAAA,IAAI,EAAER,UAAU,CAACS;AADP,SAAd;AAGAuC,QAAAA,UAAU,CAAC,MAAM;AACb,eAAKY,KAAL,CAAW,CAAX,EAAcI,IAAd;AACH,SAFS,EAEP,IAFO,CAAV;AAGH,OAPD;AASA,WAAKJ,KAAL,CAAW,CAAX,EAAcD,gBAAd,CAA+B,OAA/B,EAAwC,MAAM;AAC1CX,QAAAA,UAAU,CAAC,MAAM;AACb,eAAKC,SAAL;AACH,SAFS,EAEP,IAFO,CAAV;AAGH,OAJD;AAMA,WAAKW,KAAL,CAAW,CAAX,EAAcD,gBAAd,CAA+B,OAA/B,EAAwC,MAAM;AAC1C,aAAKf,QAAL,CAAc;AACVtC,UAAAA,SAAS,EAAE,UADD;AAEVE,UAAAA,IAAI,EAAER,UAAU,CAACS;AAFP,SAAd;AAIH,OALD;AAOA,WAAKmD,KAAL,CAAW,CAAX,EAAcD,gBAAd,CAA+B,OAA/B,EAAwC,YAAY;AAChD,cAAM;AAAEzB,UAAAA;AAAF,YAAW,MAAM/B,UAAU,CAACmC,MAAX,CAAkB,KAAKP,KAAL,CAAWD,IAAX,CAAgBG,OAAhB,CAAwBD,IAA1C,EAAgD5B,OAAhD,EAAyD,KAAK0C,WAAL,CAAiBmB,OAA1E,CAAvB;AACArC,QAAAA,OAAO,CAACC,GAAR,CAAYK,IAAZ;AACA,YAAI,KAAKgC,aAAL,KAAuB,OAA3B,EAAoC,KAAKf,KAAL,GAApC,KACK,KAAKxB,UAAL;AAEL,aAAK6B,YAAL,GAAoB,IAApB;AACA,aAAKV,WAAL,GAAmB,IAAnB;AACA,aAAKc,KAAL,GAAa,IAAb;AACH,OATD;AAWAZ,MAAAA,UAAU,CAAC,MAAM;AACb,aAAKY,KAAL,CAAW,CAAX,EAAcI,IAAd;AACH,OAFS,EAEP,IAFO,CAAV;AAGH,KA3KsB;;AAAA,SA6KvBrB,UA7KuB,GA6KTwB,OAAD,IAAa;AACtB,WAAKrB,WAAL,GAAmB,KAAKR,MAAL,CAAY,KAAKvB,YAAjB,CAAnB;AACA,WAAK+B,WAAL,CAAiBQ,QAAjB,GAA4B,GAA5B;AAEA,WAAKE,YAAL,CAAkBY,MAAlB;AACA,WAAKZ,YAAL,GAAoB,IAApB;AACA,WAAKA,YAAL,GAAoB,IAAIC,KAAJ,CAAUvD,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAA/B,EAAuDY,SAA5E,CAApB;AACA,WAAKF,YAAL,CAAkBG,gBAAlB,CAAmC,OAAnC,EAA4C,MAAM;AAC9C,aAAKf,QAAL,CAAc;AACVtC,UAAAA,SAAS,EAAE,IADD;AAEVE,UAAAA,IAAI,EAAER,UAAU,CAACS;AAFP,SAAd;AAIH,OALD;AAOAuC,MAAAA,UAAU,CAAC,MAAM;AACb,aAAKJ,QAAL,CAAc;AACVrC,UAAAA,UAAU,EAAE,CACRL,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDS,UADvD,EAERrD,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDS,UAFvD,EAGRrD,QAAQ,GAAG,KAAKmB,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDS,UAHvD,CADF;AAMVxC,UAAAA,YAAY,EAAE,KAAKA,YAAL,GAAoB,CANxB;AAOVP,UAAAA,IAAI,EAAER,UAAU,CAACS;AAPP,SAAd;AASH,OAVS,EAUP0D,OAVO,CAAV;AAWH,KAtMsB;;AAAA,SAwMvBlB,SAxMuB,GAwMX,MAAM;AACd,UAAI,CAAC,CAAC,KAAKO,YAAX,EAAyB;AACrB,aAAKZ,QAAL,CAAc;AACVtC,UAAAA,SAAS,EAAE,KADD;AAEVE,UAAAA,IAAI,EAAER,UAAU,CAACqE;AAFP,SAAd;AAIA,aAAKb,YAAL,CAAkBQ,IAAlB;AACH;AACJ,KAhNsB;;AAAA,SAkNvBM,QAlNuB,GAkNZ,MAAM;AACb1C,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;;AACA,UAAI,KAAKqC,aAAL,KAAuB,OAA3B,EAAoC;AAChC,aAAKtB,QAAL,CAAc;AACVhC,UAAAA,aAAa,EAAE;AADL,SAAd;AAGH,OAJD,MAIO;AACH,aAAKgC,QAAL,CAAc;AACV/B,UAAAA,cAAc,EAAE;AADN,SAAd;AAGH;AACJ,KA7NsB;;AAAA,SA+NvB0D,kBA/NuB,GA+NF,MAAOC,EAAP,IAAc;AAC/B,YAAM;AAAElE,QAAAA;AAAF,UAAgB,KAAK+C,KAA3B;;AACA,UAAI/C,SAAS,KAAK,UAAlB,EAA8B;AAC1B,YAAIkE,EAAE,KAAK,CAAX,EAAc;AACV,eAAK5B,QAAL,CAAc;AAAEtC,YAAAA,SAAS,EAAE;AAAb,WAAd;AACA0C,UAAAA,UAAU,CAAC,MAAM;AACb,iBAAKY,KAAL,CAAW,CAAX,EAAcI,IAAd;AACH,WAFS,EAEP,IAFO,CAAV;AAGH;;AACD;AACH;;AACD,UAAI,CAAC1D,SAAL,EAAgB;AAEhB,WAAKsC,QAAL,CAAc;AACVtC,QAAAA,SAAS,EAAE;AADD,OAAd;AAIA,YAAM;AAAEwB,QAAAA;AAAF,UAAW,KAAKC,KAAtB;AACA,YAAMC,IAAI,GAAGF,IAAI,CAACG,OAAL,CAAaD,IAA1B;AACA,YAAMiC,OAAO,GAAG,CACZ,KAAK5C,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDmB,OADxC,EAEZ,KAAK5C,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDmB,OAFxC,EAGZ,KAAK5C,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,CAA/B,EAAoDmB,OAHxC,CAAhB;AAKA,YAAM;AAAE/B,QAAAA;AAAF,UAAW,MAAMjC,MAAM,CAACqC,MAAP,CACnBN,IADmB,EAEnBiC,OAFmB,EAGnB,KAAK5C,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB0B,EAAjB,CAA/B,EAAqDC,SAHlC,EAInB,KAAKpD,aAAL,CAAmB,UAAnB,EAA+B,KAAKyB,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAA/B,EAAuD2B,SAJpC,EAKnB,KAAKP,aAAL,KAAuB,QAAvB,GAAkC,GAAlC,GAAwC,GALrB,EAMnB,KAAKA,aAAL,KAAuB,OAAvB,GAAiC,GAAjC,GAAuC,GANpB,EAOnB,KAAKpB,WAAL,CAAiBQ,QAPE,CAAvB;AASA1B,MAAAA,OAAO,CAACC,GAAR,CAAYK,IAAZ;;AAEA,cAAQA,IAAI,CAACE,IAAb;AACI,aAAK,CAAL;AACI,cAAIF,IAAI,CAACwC,aAAL,CAAmBC,QAAnB,KAAgC,OAApC,EAA6C;AACzC,iBAAK7B,WAAL,CAAiBQ,QAAjB,GAA4B,GAA5B;AACA,iBAAKsB,YAAL,GAAoB,IAAInB,KAAJ,CAAUvD,QAAQ,GAAGgC,IAAI,CAACwC,aAAL,CAAmBZ,QAAxC,CAApB;AACA,iBAAKc,YAAL,CAAkBjB,gBAAlB,CAAmC,OAAnC,EAA4C,MAAM;AAC9C,mBAAKf,QAAL,CAAc;AACVtC,gBAAAA,SAAS,EAAE,IADD;AAEVE,gBAAAA,IAAI,EAAER,UAAU,CAACS;AAFP,eAAd;AAIH,aALD;AAOAuC,YAAAA,UAAU,CAAC,MAAM;AACb,mBAAK4B,YAAL,CAAkBZ,IAAlB;AACA,mBAAKpB,QAAL,CAAc;AACVtC,gBAAAA,SAAS,EAAE,KADD;AAEVE,gBAAAA,IAAI,EAAER,UAAU,CAACqE;AAFP,eAAd;AAIH,aANS,EAMP,IANO,CAAV;AAOA;AACH,WAlBD,MAkBO;AACH,iBAAKzB,QAAL,CAAc;AACVpC,cAAAA,IAAI,EAAER,UAAU,CAAC6E;AADP,aAAd;AAGA,iBAAKC,WAAL,GAAmB,IAAIrB,KAAJ,CAAUvD,QAAQ,GAAGgC,IAAI,CAACwC,aAAL,CAAmBZ,QAAxC,CAAnB;AACA,iBAAKgB,WAAL,CAAiBnB,gBAAjB,CAAkC,OAAlC,EAA2C,MAAM,KAAKoB,QAAL,EAAjD;AACA/B,YAAAA,UAAU,CAAC,MAAM;AACb,mBAAK8B,WAAL,CAAiBd,IAAjB;AACA,mBAAKpB,QAAL,CAAc;AACVtC,gBAAAA,SAAS,EAAE;AADD,eAAd;AAGH,aALS,EAKP,IALO,CAAV;AAMH;;AACD;;AACJ,aAAK,CAAL;AACIsB,UAAAA,OAAO,CAACC,GAAR,CAAYK,IAAI,CAACgB,OAAjB;AACA,eAAKoB,QAAL;AACA;;AACJ;AACI,eAAKvC,KAAL,CAAWiD,OAAX,CAAmBC,IAAnB,CAAwB,YAAxB;AACA;AAxCR;AA0CH,KA5SsB;;AAAA,SA8SvBF,QA9SuB,GA8SZ,MAAM;AACb,UAAI,KAAKhE,YAAL,GAAoB,KAAKuB,MAAL,CAAYI,MAAZ,GAAqB,CAA7C,EAAgD,KAAK3B,YAAL,GAAhD,KACK;AACD,aAAKuD,QAAL;AACA;AACH;AACD,WAAK3B,UAAL,CAAgB,IAAhB;AAEAK,MAAAA,UAAU,CAAC,MAAM;AACb,aAAKC,SAAL;AACH,OAFS,EAEP,IAFO,CAAV;AAGH,KAzTsB;;AAAA,SA2TvBiC,iBA3TuB,GA2TH,MAAM;AACtB,UAAI,KAAK7B,KAAL,CAAW/C,SAAf,EAA0B,KAAK2C,SAAL;AAC7B,KA7TsB;;AAAA,SA+TvBR,iBA/TuB,GA+TF0C,OAAD,IAAa;AAC7B,UAAIC,iBAAiB,GAAGpC,UAAU,CAAC,MAAM;AACrC,aAAKjB,KAAL,CAAWiD,OAAX,CAAmBC,IAAnB,CAAwB,YAAxB;AACH,OAFiC,EAE/B,KAF+B,CAAlC;;AAIA,UAAI;AACA,aAAK,IAAII,CAAT,IAAcF,OAAd,EAAuB;AACnB,cAAIG,GAAG,GAAG,IAAIC,KAAJ,EAAV;AACAD,UAAAA,GAAG,CAACE,GAAJ,GAAUtF,QAAQ,GAAGiF,OAAO,CAACE,CAAD,CAAP,CAAW9B,UAAhC;;AACA+B,UAAAA,GAAG,CAACG,MAAJ,GAAa,MAAM;AACf,iBAAK7C,QAAL,CAAc;AACV9B,cAAAA,OAAO,EAAG,EAAE,KAAKyB,gBAAP,GAA0B,KAAKC,WAAhC,GAA+C;AAD9C,aAAd;;AAIA,gBAAI,KAAKD,gBAAL,KAA0B,KAAKC,WAAnC,EAAgD;AAC5C,mBAAKI,QAAL,CAAc;AACVlC,gBAAAA,aAAa,EAAE;AADL,eAAd;AAGAsC,cAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACAyC,cAAAA,YAAY,CAACN,iBAAD,CAAZ;AACH;AACJ,WAZD;AAaH;AACJ,OAlBD,CAkBE,OAAOO,CAAP,EAAU;AACR/D,QAAAA,OAAO,CAACC,GAAR,CAAY8D,CAAZ;AACH;AACJ,KAzVsB;;AAAA,SA2VvBC,gBA3VuB,GA2VHT,OAAD,IAAa;AAC5B,WAAK,IAAIE,CAAT,IAAcF,OAAd,EAAuB;AACnB,aAAK,IAAIU,IAAT,IAAiBV,OAAO,CAACE,CAAD,CAAxB,EAA6B;AACzB,cAAIC,GAAG,GAAG,IAAIC,KAAJ,EAAV;AACAD,UAAAA,GAAG,CAACE,GAAJ,GAAUL,OAAO,CAACE,CAAD,CAAP,CAAWQ,IAAX,CAAV;;AACAP,UAAAA,GAAG,CAACG,MAAJ,GAAa,MAAM;AACf,iBAAK7C,QAAL,CAAc;AACV9B,cAAAA,OAAO,EAAG,EAAE,KAAKyB,gBAAP,GAA0B,KAAKC,WAAhC,GAA+C;AAD9C,aAAd;;AAIA,gBAAI,KAAKD,gBAAL,KAA0B,KAAKC,WAAnC,EAAgD;AAC5C,mBAAKI,QAAL,CAAc;AACVlC,gBAAAA,aAAa,EAAE;AADL,eAAd;AAGA,kBAAI,KAAKwD,aAAL,KAAuB,OAA3B,EAAoC,KAAKvC,UAAL,GAApC,KACK,KAAKwB,KAAL;AACR;AACJ,WAZD;AAaH;AACJ;AACJ,KA/WsB;;AAAA,SAiXvB2C,sBAjXuB,GAiXE,MAAM;AAC3B,WAAKlD,QAAL,CAAc;AACVjC,QAAAA,SAAS,EAAE;AADD,OAAd;AAGH,KArXsB;;AAAA,SAuXvBoF,qBAvXuB,GAuXC,MAAM;AAC1B,WAAKnD,QAAL,CAAc;AACVhC,QAAAA,aAAa,EAAE;AADL,OAAd;AAGA,WAAKe,UAAL;AACAqB,MAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACH,KA7XsB;;AAAA,SA+XvB+C,mBA/XuB,GA+XD,MAAM;AACxB,WAAKpD,QAAL,CAAc;AACVjC,QAAAA,SAAS,EAAE;AADD,OAAd;AAGH,KAnYsB;;AAEnB,SAAKuD,aAAL,GAAqB9C,KAAK,CAAC6E,MAAN,CAAa/B,aAAlC;AACA,SAAK1C,IAAL,GAAY,IAAZ;AACA,SAAKc,MAAL,GAAc,IAAd;AACA,SAAKQ,WAAL,GAAmB,IAAnB;AACA,SAAKU,YAAL,GAAoB,IAApB;AACA,SAAKzC,YAAL,GAAoB,CAApB;AACA,SAAKwB,gBAAL,GAAwB,CAAxB;AACA,SAAK4C,OAAL,GAAe;AAAEpF,MAAAA,EAAF;AAAMC,MAAAA;AAAN,KAAf;AACA,SAAKwC,WAAL,GAAmB0D,MAAM,CAACC,IAAP,CAAYpG,EAAZ,EAAgB2C,MAAhB,GAAyBwD,MAAM,CAACC,IAAP,CAAYnG,UAAZ,EAAwB0C,MAApE;AAEA,SAAKW,KAAL,GAAahD,SAAb;AACH;;AAED+F,EAAAA,iBAAiB,GAAG,CAEnB;;AAED,QAAMC,iBAAN,GAA0B;AACtB,SAAKT,gBAAL,CAAsB,KAAKT,OAA3B;AACA,UAAM;AAAErD,MAAAA;AAAF,QAAW,KAAKC,KAAtB;;AAEA,QAAI,CAACD,IAAI,CAACA,IAAL,CAAUwE,IAAX,IAAmB,CAACxE,IAAI,CAACG,OAAL,CAAaD,IAArC,EAA2C;AACvC,WAAKD,KAAL,CAAWiD,OAAX,CAAmBC,IAAnB,CAAwB,cAAxB;AACA;AACH;AACJ;;AAEDsB,EAAAA,oBAAoB,GAAG;AACnB,QAAI,CAAC,CAAC,KAAK/C,YAAX,EAAyB;AACrB,WAAKA,YAAL,CAAkBgD,KAAlB;AACA,WAAKhD,YAAL,CAAkBY,MAAlB;AACA,WAAKZ,YAAL,GAAoB,IAApB;AACH;;AAED,QAAI,CAAC,CAAC,KAAKI,KAAX,EAAkB;AACd,WAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzB,KAAL,CAAWlB,MAA/B,EAAuC2C,CAAC,EAAxC,EAA4C;AACxC,YAAI,CAAC,CAAC,KAAKzB,KAAL,CAAWyB,CAAX,CAAN,EAAqB;AACjB,eAAKzB,KAAL,CAAWyB,CAAX,EAAcmB,KAAd;AACA,eAAK5C,KAAL,CAAWyB,CAAX,EAAcjB,MAAd;AACA,eAAKR,KAAL,CAAWyB,CAAX,IAAgB,IAAhB;AACH;AACJ;AACJ;AACJ;;AAwVDoB,EAAAA,MAAM,GAAG;AACL,UAAM;AAAElG,MAAAA,UAAF;AAAcC,MAAAA,IAAd;AAAoBE,MAAAA,aAApB;AAAmCC,MAAAA,SAAnC;AAA8CG,MAAAA,OAA9C;AAAuDR,MAAAA,SAAvD;AAAkEO,MAAAA,cAAlE;AAAkFD,MAAAA,aAAlF;AACFG,MAAAA,YADE;AACYC,MAAAA;AADZ,QACyB,KAAKqC,KADpC;;AAGA,QAAI3C,aAAJ,EAAmB;AACf,0BACI,oBAAC,mBAAD;AACI,QAAA,UAAU,EAAEX,EAAE,CAAC2G,aADnB;AAEI,QAAA,IAAI,EAAElG,IAFV;AAGI,QAAA,iBAAiB,EAAE,KAAK0E,iBAH5B;AAII,QAAA,SAAS,EAAE3E,UAAU,IAAI,CAACR,EAAE,CAAC4G,SAAJ,EAAe5G,EAAE,CAAC4G,SAAlB,EAA6B5G,EAAE,CAAC4G,SAAhC,CAJ7B;AAKI,QAAA,kBAAkB,EAAE,KAAKpC,kBAL7B;AAMI,QAAA,SAAS,EAAE5D,SANf;AAOI,QAAA,sBAAsB,EAAE,KAAKmF,sBAPjC;AAQI,QAAA,mBAAmB,EAAE,KAAKE,mBAR9B;AASI,QAAA,qBAAqB,EAAE,KAAKD,qBAThC;AAUI,QAAA,cAAc,EAAElF,cAVpB;AAWI,QAAA,aAAa,EAAED,aAXnB;AAYI,QAAA,SAAS,EAAEN,SAZf;AAaI,QAAA,YAAY,EAAES,YAblB;AAcI,QAAA,QAAQ,EAAEC,QAdd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ;AAiBH,KAlBD,MAmBK;AACD,0BAAO,oBAAC,WAAD;AAAa,QAAA,OAAO,EAAEF,OAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACH;AACJ;;AAraoC;;AAAnCG,U,CACK2F,S,GAAY;AACf9E,EAAAA,IAAI,EAAElC,SAAS,CAACiH,QAAV,CAAmBjH,SAAS,CAACkH,GAA7B,EAAkCC,UADzB;AAEfC,EAAAA,QAAQ,EAAEpH,SAAS,CAACqH,IAAV,CAAeF;AAFV,C;;AAuavB,SAASG,eAAT,CAAyB7D,KAAzB,EAAgC;AAC5B,SAAO;AAAEvB,IAAAA,IAAI,EAAEuB,KAAK,CAACvB;AAAd,GAAP;AACH;;AAED,eAAejC,OAAO,CAACqH,eAAD,CAAP,CAAyBxH,UAAU,CAACuB,UAAD,CAAnC,CAAf","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ConsoMatchPresenter from './ConsoMatchPresenter';\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport LoadingComp from 'Components/LoadingComp';\nimport { T6, Characters } from 'images';\nimport { T_Api4, soundURL, T_tutorial } from 'api';\n\nconst idx_txt = 'consomatch';\nconst initState = {\n    gameState: false,\n    PicBoxList: null,\n    Worm: Characters.worm2_2,\n    isImageLoaded: false,\n    showPopup: false,\n    showDonePopup: false,\n    showDailyPopup: false,\n    percent: 0,\n    currentIndex: 1,\n    totalNum: 0,\n};\n\nclass ConsoMatch extends React.Component {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor({ match }) {\n        super();\n        this.learning_type = match.params.learning_type;\n        this.cure = null;\n        this.answer = null;\n        this.currentCure = null;\n        this.currentAudio = null;\n        this.currentIndex = 0;\n        this.numOfLoadedImage = 0;\n        this.picture = { T6, Characters };\n        this.totalImages = Object.keys(T6).length + Object.keys(Characters).length;\n\n        this.state = initState;\n    }\n\n    componentDidCatch() {\n\n    }\n\n    async componentDidMount() {\n        this.imagesPreloading(this.picture);\n        const { user } = this.props;\n\n        if (!user.user.u_id || !user.student.s_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n    }\n\n    componentWillUnmount() {\n        if (!!this.currentAudio) {\n            this.currentAudio.pause();\n            this.currentAudio.remove();\n            this.currentAudio = null;\n        }\n\n        if (!!this.voice) {\n            for (let i = 0; i < this.voice.length; i++) {\n                if (!!this.voice[i]) {\n                    this.voice[i].pause();\n                    this.voice[i].remove();\n                    this.voice[i] = null;\n                }\n            }\n        }\n    }\n\n    getListFilter = (key, value) => {\n        return this.cure.filter((object) => { return object[key] === value })[0]\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        const { data } = await T_Api4.ask(s_id);\n        console.log(data);\n\n        if (data.code === 'tutorial') {\n            this.tutorial(data);\n            return;\n        }\n\n        if (data.code === 'specified' || data.code === 1) {\n            this.currentIndex = 0;\n            this.answer = data.answer;\n            this.cure = data.cure;\n\n            if (this.numOfLoadedImage !== this.totalImages) this.pictursPreloading(this.cure);\n            this.totalImages += this.cure.length;\n            this.setCurrent(0);\n\n            this.setState({\n                totalNum: this.cure.length,\n                cureText: this.currentCure.cure_text,\n            })\n            setTimeout(() => this.playSound(), 2000);\n        }\n        else console.log('data message: ' + data.message);\n\n    }\n\n    daily = () => {\n        if (this.props.location.state.data.code === 'tutorial') {\n            this.tutorial(this.props.location.state.data);\n            return;\n        }\n\n        console.log(this.props.location.state.data);\n\n        this.answer = this.props.location.state.data.answer;\n        this.cure = this.props.location.state.data.cure;\n        this.currentCure = this.answer[this.currentIndex];\n        this.currentCure.is_first = 'T';\n\n        if (this.numOfLoadedImage !== this.totalImages) this.pictursPreloading(this.cure);\n\n        this.setState({\n            totalNum: this.answer.length,\n            cureText: this.currentCure.cure_text,\n            PicBoxList: [\n                soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2,\n                soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2,\n                soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2,\n            ]\n        });\n\n        this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n        this.currentAudio.addEventListener('ended', () => {\n            this.setState({\n                gameState: true,\n                Worm: Characters.worm2_2,\n            })\n        });\n        setTimeout(() => this.playSound(), 2000);\n    }\n\n    tutorial = (data) => {\n        this.voice = [\n            new Audio(soundURL + data.tut_voice[0].voc_path),\n            new Audio(soundURL + data.tut_voice[1].voc_path),\n            new Audio(soundURL + data.tut_voice[2].voc_path),\n        ];\n        this.currentCure = data.sample_ques;\n\n        this.setState({\n            PicBoxList: [\n                soundURL + this.currentCure[0].cure_path2,\n                soundURL + this.currentCure[1].cure_path2,\n                soundURL + this.currentCure[2].cure_path2,\n            ]\n        });\n\n        this.currentAudio = new Audio(soundURL + this.currentCure[0].cure_path);\n        this.currentAudio.addEventListener('ended', () => {\n            this.setState({\n                Worm: Characters.worm2_2,\n            });\n            setTimeout(() => {\n                this.voice[1].play();\n            }, 1000);\n        });\n\n        this.voice[0].addEventListener('ended', () => {\n            setTimeout(() => {\n                this.playSound();\n            }, 1000);\n        });\n\n        this.voice[1].addEventListener('ended', () => {\n            this.setState({\n                gameState: 'tutorial',\n                Worm: Characters.worm2_2,\n            });\n        });\n\n        this.voice[2].addEventListener('ended', async () => {\n            const { data } = await T_tutorial.answer(this.props.user.student.s_id, idx_txt, this.currentCure.cure_id);\n            console.log(data);\n            if (this.learning_type === 'daily') this.daily();\n            else this.newRequest();\n\n            this.currentAudio = null;\n            this.currentCure = null;\n            this.voice = null;\n        });\n\n        setTimeout(() => {\n            this.voice[0].play();\n        }, 2000);\n    }\n\n    setCurrent = (timeout) => {\n        this.currentCure = this.answer[this.currentIndex];\n        this.currentCure.is_first = 'T';\n\n        this.currentAudio.remove();\n        this.currentAudio = null;\n        this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n        this.currentAudio.addEventListener('ended', () => {\n            this.setState({\n                gameState: true,\n                Worm: Characters.worm2_2,\n            })\n        })\n\n        setTimeout(() => {\n            this.setState({\n                PicBoxList: [\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2,\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2,\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2,\n                ],\n                currentIndex: this.currentIndex + 1,\n                Worm: Characters.worm2_2,\n            })\n        }, timeout);\n    }\n\n    playSound = () => {\n        if (!!this.currentAudio) {\n            this.setState({\n                gameState: false,\n                Worm: Characters.worm2_1,\n            });\n            this.currentAudio.play();\n        }\n    }\n\n    gameDone = () => {\n        console.log('done!');\n        if (this.learning_type !== 'daily') {\n            this.setState({\n                showDonePopup: true,\n            })\n        } else {\n            this.setState({\n                showDailyPopup: true,\n            })\n        }\n    }\n\n    onFrameTouchHandle = async (id) => {\n        const { gameState } = this.state;\n        if (gameState === 'tutorial') {\n            if (id === 0) {\n                this.setState({ gameState: false });\n                setTimeout(() => {\n                    this.voice[2].play();\n                }, 1000);\n            }\n            return;\n        }\n        if (!gameState) return;\n\n        this.setState({\n            gameState: false,\n        });\n\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n        const cure_id = [\n            this.getListFilter('cure_tid', this.currentCure[0]).cure_id,\n            this.getListFilter('cure_tid', this.currentCure[1]).cure_id,\n            this.getListFilter('cure_tid', this.currentCure[2]).cure_id,\n        ];\n        const { data } = await T_Api4.answer(\n            s_id,\n            cure_id,\n            this.getListFilter('cure_tid', this.currentCure[id]).cure_word,\n            this.getListFilter('cure_tid', this.currentCure[3][0]).cure_word,\n            this.learning_type === 'review' ? 'T' : 'F',\n            this.learning_type === 'daily' ? 'T' : 'F',\n            this.currentCure.is_first\n        );\n        console.log(data);\n\n        switch (data.code) {\n            case 1:\n                if (data.correct_voice.voc_desc === 'retry') {\n                    this.currentCure.is_first = 'F';\n                    this.retry_script = new Audio(soundURL + data.correct_voice.voc_path);\n                    this.retry_script.addEventListener('ended', () => {\n                        this.setState({\n                            gameState: true,\n                            Worm: Characters.worm2_2,\n                        });\n                    });\n\n                    setTimeout(() => {\n                        this.retry_script.play();\n                        this.setState({\n                            gameState: false,\n                            Worm: Characters.worm2_1,\n                        });\n                    }, 1000);\n                    return;\n                } else {\n                    this.setState({\n                        Worm: Characters.worm3_1,\n                    })\n                    this.good_script = new Audio(soundURL + data.correct_voice.voc_path);\n                    this.good_script.addEventListener('ended', () => this.nextStep());\n                    setTimeout(() => {\n                        this.good_script.play();\n                        this.setState({\n                            gameState: false,\n                        });\n                    }, 1000);\n                }\n                break;\n            case 2:\n                console.log(data.message);\n                this.gameDone();\n                break;\n            default:\n                this.props.history.push('/main/main')\n                break;\n        }\n    }\n\n    nextStep = () => {\n        if (this.currentIndex < this.answer.length - 1) this.currentIndex++;\n        else {\n            this.gameDone();\n            return;\n        }\n        this.setCurrent(1000);\n\n        setTimeout(() => {\n            this.playSound();\n        }, 2000);\n    }\n\n    onWormTouchHandle = () => {\n        if (this.state.gameState) this.playSound();\n    }\n\n    pictursPreloading = (picture) => {\n        let timeoutPreloading = setTimeout(() => {\n            this.props.history.push('/main/main');\n        }, 10000);\n\n        try {\n            for (let i in picture) {\n                let img = new Image();\n                img.src = soundURL + picture[i].cure_path2;\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                        setTimeout(() => this.playSound(), 1000);\n                        clearTimeout(timeoutPreloading);\n                    }\n                };\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                        if (this.learning_type !== 'daily') this.newRequest();\n                        else this.daily();\n                    }\n                };\n            }\n        }\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onRestartButtonHandle = () => {\n        this.setState({\n            showDonePopup: false,\n        })\n        this.newRequest();\n        setTimeout(() => this.playSound(), 2000);\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { PicBoxList, Worm, isImageLoaded, showPopup, percent, gameState, showDailyPopup, showDonePopup,\n            currentIndex, totalNum } = this.state;\n\n        if (isImageLoaded) {\n            return (\n                <ConsoMatchPresenter\n                    Background={T6.t6_background}\n                    Worm={Worm}\n                    onWormTouchHandle={this.onWormTouchHandle}\n                    frameList={PicBoxList || [T6.t6_excpic, T6.t6_excpic, T6.t6_excpic]}\n                    onFrameTouchHandle={this.onFrameTouchHandle}\n                    showPopup={showPopup}\n                    onContinueButtonHandle={this.onContinueButtonHandle}\n                    onPauseButtonHandle={this.onPauseButtonHandle}\n                    onRestartButtonHandle={this.onRestartButtonHandle}\n                    showDailyPopup={showDailyPopup}\n                    showDonePopup={showDonePopup}\n                    gameState={gameState}\n                    currentIndex={currentIndex}\n                    totalNum={totalNum}\n                />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(ConsoMatch));"]},"metadata":{},"sourceType":"module"}