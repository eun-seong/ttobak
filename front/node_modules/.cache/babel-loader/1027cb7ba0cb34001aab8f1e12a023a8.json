{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Diagnose/Attention/AttentionContainer.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport LoadingComp from 'Components/LoadingComp';\nimport AttentionPresenter from './AttentionPresenter';\nimport { SoundEffect } from 'images';\nimport { D3, TTobak } from 'images';\nimport { D3_Api, soundURL } from 'api';\n\nclass Attention extends React.Component {\n  constructor() {\n    super();\n\n    this.androidResponse = async e => {\n      console.log(e.detail);\n      this.setState({\n        isRecording: false\n      });\n      this.recording_end_sound.play();\n      this.audioResult = e.detail;\n      this.andriodListener();\n    };\n\n    this.newRequest = async () => {\n      const {\n        user\n      } = this.props;\n      const data = await D3_Api.ask(user.student.s_id, user.student.s_id);\n      console.log(data);\n\n      if (data.code === 1) {\n        this.cure = data.focus;\n        this.currentIndex = 0;\n        this.currentCure = this.cure[this.currentIndex];\n        this.currentAudio = new Audio(soundURL + this.currentCure.ques_path1);\n        this.setState({\n          totalNum: this.cure.length\n        });\n      }\n    };\n\n    this.andriodListener = async () => {\n      this.setState({\n        TTobaki: TTobak.ttobak2_1\n      });\n\n      try {\n        if (this.audioResult.status === 'Success') {\n          const {\n            s_id\n          } = this.state;\n          console.log(s_id, this.currentCure.ques_id, this.audioResult.score, this.audioResult.phone_score, this.audioResult.speed_score, this.audioResult.rhythm_score);\n          const {\n            data\n          } = await D3_Api.answer(s_id, this.currentCure.ques_id, this.audioResult.score, this.audioResult.phone_score, this.audioResult.speed_score, this.audioResult.rhythm_score);\n          console.log(data);\n\n          if (data.code === 1) {\n            if (data.is_stop) {\n              this.gameDone();\n            } else if (data.to_next_level) {\n              this.newRequest();\n              setTimeout(() => {\n                this.playSound();\n              }, 3000);\n            } else {\n              if (this.currentIndex < this.cure.length - 1) {\n                this.currentIndex++;\n              } else {\n                this.gameDone();\n                return;\n              }\n\n              this.currentCure = this.cure[this.currentIndex];\n              this.currentAudio = null;\n              this.currentAudio = new Audio(soundURL + this.currentCure.ques_path1);\n              setTimeout(() => {\n                this.setState({\n                  TTobaki: TTobak.ttobak1_1,\n                  currentIndex: this.currentIndex + 1\n                });\n              }, 3000);\n              setTimeout(() => {\n                this.playSound();\n              }, 5500);\n            }\n          } else console.log(data.message);\n        } else {\n          console.log(this.audioResult.message);\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.playSound = () => {\n      if (!!this.currentAudio) {\n        this.setState({\n          TTobaki: TTobak.ttobak3_2\n        });\n        this.currentAudio.play();\n        this.currentAudio.addEventListener('ended', () => {\n          this.setState({\n            TTobaki: TTobak.ttobak1_1\n          });\n          setTimeout(() => {\n            console.log('이제 따라 읽어볼까요?');\n            this.recording_start_sound.play();\n            this.setState({\n              isRecording: true\n            });\n            window.BRIDGE.recordAudio('m', this.currentCure.ques_char);\n          }, 1000);\n        });\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n              setTimeout(() => this.playSound(), 2000);\n            }\n          };\n        }\n      }\n    };\n\n    this.gameDone = () => {\n      console.log('game doen!');\n      this.setState({\n        showNextPopup: true\n      });\n    };\n\n    this.onPopupButtonHandle = () => {\n      this.props.history.replace('/diagnose/result');\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.recording_start_sound = new Audio(SoundEffect.recording_start);\n    this.recording_end_sound = new Audio(SoundEffect.recording_end);\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      D3,\n      TTobak\n    };\n    this.totalImages = Object.keys(D3).length + Object.keys(TTobak).length;\n    this.cure = null;\n    this.currentCure = null;\n    this.currentIndex = 0;\n    this.currentAudio = null;\n    this.audioResult = null;\n    this.state = {\n      gameState: false,\n      s_id: 4,\n      isImageLoaded: false,\n      percent: 0,\n      showPopup: false,\n      showNextPopup: false,\n      isRecording: false,\n      TTobak: TTobak.ttobak1_1,\n      currentIndex: 1,\n      totalNum: 0\n    };\n  }\n\n  async componentDidMount() {\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    if (!user.student.s_id) {\n      this.props.history.push('/root/selectstd');\n      return;\n    }\n\n    this.newRequest();\n    this.imagesPreloading(this.picture);\n    window.addEventListener(\"android\", this.androidResponse);\n  }\n\n  componentWillUnmount() {\n    if (!!this.currentAudio) {\n      this.currentAudio.pause();\n      this.currentAudio = null;\n    }\n\n    window.removeEventListener(\"android\", this.androidResponse);\n  }\n\n  render() {\n    const {\n      isImageLoaded,\n      showPopup,\n      showNextPopup,\n      percent,\n      TTobak,\n      isRecording\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(AttentionPresenter, {\n        Background: D3.d3_background,\n        TTobak: TTobak,\n        isRecording: isRecording,\n        showPopup: showPopup,\n        showNextPopup: showNextPopup,\n        onPopupButtonHandle: this.onPopupButtonHandle,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        currentIndex: this.state.currentIndex,\n        totalNum: this.state.totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 21\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nAttention.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Attention));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Diagnose/Attention/AttentionContainer.js"],"names":["React","withRouter","PropTypes","connect","LoadingComp","AttentionPresenter","SoundEffect","D3","TTobak","D3_Api","soundURL","Attention","Component","constructor","androidResponse","e","console","log","detail","setState","isRecording","recording_end_sound","play","audioResult","andriodListener","newRequest","user","props","data","ask","student","s_id","code","cure","focus","currentIndex","currentCure","currentAudio","Audio","ques_path1","totalNum","length","TTobaki","ttobak2_1","status","state","ques_id","score","phone_score","speed_score","rhythm_score","answer","is_stop","gameDone","to_next_level","setTimeout","playSound","ttobak1_1","message","ttobak3_2","addEventListener","recording_start_sound","window","BRIDGE","recordAudio","ques_char","imagesPreloading","picture","i","prop","img","Image","src","onload","percent","numOfLoadedImage","totalImages","isImageLoaded","showNextPopup","onPopupButtonHandle","history","replace","onContinueButtonHandle","showPopup","onPauseButtonHandle","recording_start","recording_end","Object","keys","gameState","componentDidMount","u_id","push","componentWillUnmount","pause","removeEventListener","render","d3_background","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport LoadingComp from 'Components/LoadingComp';\nimport AttentionPresenter from './AttentionPresenter';\nimport { SoundEffect } from 'images';\n\nimport { D3, TTobak } from 'images';\nimport { D3_Api, soundURL } from 'api';\n\nclass Attention extends React.Component {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor() {\n        super();\n        this.recording_start_sound = new Audio(SoundEffect.recording_start);\n        this.recording_end_sound = new Audio(SoundEffect.recording_end);\n        this.numOfLoadedImage = 0;\n        this.picture = { D3, TTobak };\n        this.totalImages = Object.keys(D3).length + Object.keys(TTobak).length;\n        this.cure = null;\n        this.currentCure = null;\n        this.currentIndex = 0;\n        this.currentAudio = null;\n        this.audioResult = null;\n\n        this.state = {\n            gameState: false,\n            s_id: 4,\n            isImageLoaded: false,\n            percent: 0,\n            showPopup: false,\n            showNextPopup: false,\n            isRecording: false,\n            TTobak: TTobak.ttobak1_1,\n            currentIndex: 1,\n            totalNum: 0,\n        };\n    }\n\n    async componentDidMount() {\n        const { user } = this.props;\n\n        if (!user.user.u_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        if (!user.student.s_id) {\n            this.props.history.push('/root/selectstd');\n            return;\n        }\n\n        this.newRequest();\n        this.imagesPreloading(this.picture);\n\n        window.addEventListener(\"android\", this.androidResponse);\n    }\n\n    componentWillUnmount() {\n        if (!!this.currentAudio) {\n            this.currentAudio.pause();\n            this.currentAudio = null;\n        }\n        window.removeEventListener(\"android\", this.androidResponse)\n    }\n\n    androidResponse = async (e) => {\n        console.log(e.detail);\n        this.setState({\n            isRecording: false,\n        })\n        this.recording_end_sound.play();\n        this.audioResult = e.detail;\n        this.andriodListener();\n    }\n\n    newRequest = async () => {\n        const { user } = this.props;\n\n        const data = await D3_Api.ask(user.student.s_id, user.student.s_id);\n        console.log(data);\n\n        if (data.code === 1) {\n            this.cure = data.focus;\n            this.currentIndex = 0;\n            this.currentCure = this.cure[this.currentIndex];\n            this.currentAudio = new Audio(soundURL + this.currentCure.ques_path1);\n            this.setState({\n                totalNum: this.cure.length,\n            })\n        }\n    }\n\n    andriodListener = async () => {\n        this.setState({\n            TTobaki: TTobak.ttobak2_1,\n        });\n\n        try {\n            if (this.audioResult.status === 'Success') {\n                const { s_id } = this.state;\n                console.log(\n                    s_id,\n                    this.currentCure.ques_id,\n                    this.audioResult.score,\n                    this.audioResult.phone_score,\n                    this.audioResult.speed_score,\n                    this.audioResult.rhythm_score)\n                const { data } = await D3_Api.answer(\n                    s_id,\n                    this.currentCure.ques_id,\n                    this.audioResult.score,\n                    this.audioResult.phone_score,\n                    this.audioResult.speed_score,\n                    this.audioResult.rhythm_score,\n                );\n                console.log(data);\n\n                if (data.code === 1) {\n                    if (data.is_stop) {\n                        this.gameDone();\n                    } else if (data.to_next_level) {\n                        this.newRequest();\n                        setTimeout(() => {\n                            this.playSound();\n                        }, 3000);\n                    } else {\n                        if (this.currentIndex < this.cure.length - 1) {\n                            this.currentIndex++;\n                        } else {\n                            this.gameDone();\n                            return;\n                        }\n                        this.currentCure = this.cure[this.currentIndex];\n                        this.currentAudio = null;\n                        this.currentAudio = new Audio(soundURL + this.currentCure.ques_path1);\n\n                        setTimeout(() => {\n                            this.setState({\n                                TTobaki: TTobak.ttobak1_1,\n                                currentIndex: this.currentIndex + 1,\n                            });\n                        }, 3000);\n\n                        setTimeout(() => {\n                            this.playSound();\n                        }, 5500);\n                    }\n                }\n                else console.log(data.message);\n\n            } else {\n                console.log(this.audioResult.message);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    playSound = () => {\n        if (!!this.currentAudio) {\n            this.setState({\n                TTobaki: TTobak.ttobak3_2,\n            });\n            this.currentAudio.play();\n            this.currentAudio.addEventListener('ended', () => {\n                this.setState({\n                    TTobaki: TTobak.ttobak1_1,\n                });\n                setTimeout(() => {\n                    console.log('이제 따라 읽어볼까요?');\n                    this.recording_start_sound.play();\n                    this.setState({\n                        isRecording: true,\n                    });\n                    window.BRIDGE.recordAudio('m', this.currentCure.ques_char);\n                }, 1000);\n            });\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                        setTimeout(() => this.playSound(), 2000);\n                    }\n                };\n            }\n        }\n    }\n\n    gameDone = () => {\n        console.log('game doen!');\n        this.setState({\n            showNextPopup: true,\n        });\n    }\n\n    onPopupButtonHandle = () => {\n        this.props.history.replace('/diagnose/result');\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { isImageLoaded, showPopup, showNextPopup, percent, TTobak, isRecording } = this.state;\n\n        if (isImageLoaded) {\n            return (<AttentionPresenter\n                Background={D3.d3_background}\n                TTobak={TTobak}\n                isRecording={isRecording}\n                showPopup={showPopup}\n                showNextPopup={showNextPopup}\n                onPopupButtonHandle={this.onPopupButtonHandle}\n                onContinueButtonHandle={this.onContinueButtonHandle}\n                onPauseButtonHandle={this.onPauseButtonHandle}\n                currentIndex={this.state.currentIndex}\n                totalNum={this.state.totalNum}\n            />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(Attention));"]},"metadata":{},"sourceType":"module"}