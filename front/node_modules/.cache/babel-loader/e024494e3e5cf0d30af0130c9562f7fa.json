{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T1_Shadowing/ShadowingContainer.js\";\nimport React from 'react';\nimport ShadowingPresenter from './ShadowingPresenter';\nimport recording_end from 'recording_end.mp3';\nimport recording_start from 'recording_start.mp3';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { T1, TTobak } from 'images';\nimport { T1_Api, soundURL } from 'api';\nimport LoadingComp from 'Components/LoadingComp';\n\nclass Shadowing extends React.Component {\n  constructor({\n    match,\n    location\n  }) {\n    super();\n\n    this.androidResponse = async e => {\n      console.log(e.detail);\n      this.setState({\n        isRecording: false\n      });\n      this.recording_end_sound.play();\n      this.audioResult = e.detail;\n      this.andriodListener();\n    };\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n\n      try {\n        const {\n          data\n        } = await T1_Api.ask(s_id, this.idx_text);\n        console.log(data);\n\n        if (data.code === 'specified' || data.code === 1) {\n          this.currentIndex = 0;\n          this.cure = data.cure;\n          this.currentCure = data.cure[this.currentIndex];\n          this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n          if (this.idx_text === 'vowelword' || this.idx_text === 'consoword') this.currentCure.cure_text = this.currentCure.cure_word;\n          this.setState({\n            TTobaki: TTobak.ttobak1_1,\n            cureText: this.currentCure.cure_text,\n            totalNum: this.cure.length\n          });\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.andriodListener = async () => {\n      this.setState({\n        TTobaki: TTobak.ttobak2_1\n      });\n\n      try {\n        if (this.audioResult.status === 'Success') {\n          const {\n            user\n          } = this.props;\n          const s_id = user.student.s_id;\n          const {\n            data\n          } = await T1_Api.answer(s_id, this.audioResult.score, this.audioResult.phone_score, this.audioResult.speed_score, this.audioResult.rhythm_score, this.learning_type === 'review' ? 'T' : 'F', this.currentCure.cure_id, this.idx_text);\n          console.log(data);\n\n          if (data.code === 1) {\n            if (this.currentIndex < this.cure.length - 1) {\n              this.currentIndex++;\n            } else {\n              this.gameDone();\n              return;\n            }\n\n            this.currentCure = this.cure[this.currentIndex];\n            this.currentAudio = null;\n            this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n            if (this.idx_text === 'vowelword' || this.idx_text === 'consoword') this.currentCure.cure_text = this.currentCure.cure_word;\n            setTimeout(() => {\n              this.setState({\n                TTobaki: TTobak.ttobak1_1,\n                cureText: this.currentCure.cure_text,\n                currentIndex: this.currentIndex + 1\n              });\n            }, 3000);\n            setTimeout(() => {\n              this.playSound();\n            }, 5500);\n          } else if (data.code === 2) {\n            this.gameDone();\n          } else console.log(data.message);\n        } else {\n          console.log(this.audioResult.message);\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.playSound = () => {\n      if (!!this.currentAudio) {\n        this.setState({\n          TTobaki: TTobak.ttobak3_2\n        });\n        this.currentAudio.play();\n        this.currentAudio.addEventListener('ended', () => {\n          this.setState({\n            TTobaki: TTobak.ttobak1_1\n          });\n          setTimeout(() => {\n            console.log('이제 따라 읽어볼까요?');\n            this.recording_start_sound.play();\n            this.setState({\n              isRecording: true\n            });\n            window.BRIDGE.recordAudio('m', this.currentCure.cure_text);\n          }, 1000);\n        });\n      }\n    };\n\n    this.gameDone = () => {\n      console.log('game doen!');\n\n      if (this.learning_type !== 'daily') {\n        this.setState({\n          showDonePopup: true\n        });\n      } else {\n        this.setState({\n          showDailyPopup: true\n        });\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true,\n                TTobaki: TTobak.ttobak1_1\n              });\n              setTimeout(() => this.playSound(), 1000);\n            }\n          };\n        }\n      }\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onRestartButtonHandle = () => {\n      this.setState({\n        showDonePopup: false\n      });\n      this.newRequest();\n      setTimeout(() => this.playSound(), 2000);\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.idx_text = match.params.type;\n    this.learning_type = match.params.learning_type;\n    this.recording_start_sound = new Audio(recording_start);\n    this.recording_end_sound = new Audio(recording_end);\n    this.cure = null;\n    this.currentCure = null;\n    this.currentIndex = 0;\n    this.currentAudio = null;\n    this.audioResult = null;\n    this.picture = {\n      T1,\n      TTobak\n    };\n    this.totalImages = Object.keys(this.picture.T1).length + Object.keys(this.picture.TTobak).length;\n    this.numOfLoadedImage = 0;\n    this.state = {\n      cureText: null,\n      isRecording: false,\n      TTobaki: TTobak.ttobak1_1,\n      isImageLoaded: false,\n      showPopup: false,\n      showDonePopup: false,\n      showDailyPopup: false,\n      percent: 0,\n      currentIndex: 0,\n      totalNum: 0\n    };\n\n    if (this.learning_type === 'daily') {\n      console.log(location.state.data.read);\n      this.cure = location.state.data.read;\n      this.state = { ...this.state,\n        totalNum: this.cure.length\n      };\n    }\n  }\n\n  async componentDidMount() {\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    if (!user.student.s_id) {\n      this.props.history.push('/root/selectstd');\n      return;\n    }\n\n    if (this.learning_type !== 'daily') this.newRequest();else {\n      this.currentCure = this.cure[this.currentIndex];\n      this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n      if (this.idx_text === 'vowelword' || this.idx_text === 'consoword') this.currentCure.cure_text = this.currentCure.cure_word;\n      this.state = {\n        cureText: this.currentCure.cure_text\n      };\n    }\n    this.imagesPreloading(this.picture);\n    window.addEventListener(\"android\", this.androidResponse);\n  }\n\n  componentWillUnmount() {\n    if (!!this.currentAudio) {\n      this.currentAudio.pause();\n      this.currentAudio = null;\n    }\n\n    window.removeEventListener(\"android\", this.androidResponse);\n  }\n\n  render() {\n    const {\n      type,\n      cureText,\n      TTobaki,\n      isRecording,\n      isImageLoaded,\n      showPopup,\n      showDonePopup,\n      showDailyPopup,\n      percent,\n      currentIndex,\n      totalNum\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(ShadowingPresenter, {\n        Background: T1.t1_background,\n        TextBox: T1.t1_textbox,\n        TTobak: TTobaki,\n        type: type,\n        text: cureText,\n        isRecording: isRecording,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onRestartButtonHandle: this.onRestartButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        showPopup: showPopup,\n        showDailyPopup: showDailyPopup,\n        showDonePopup: showDonePopup,\n        currentIndex: currentIndex,\n        totalNum: totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 21\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nShadowing.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(Shadowing));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T1_Shadowing/ShadowingContainer.js"],"names":["React","ShadowingPresenter","recording_end","recording_start","withRouter","PropTypes","connect","T1","TTobak","T1_Api","soundURL","LoadingComp","Shadowing","Component","constructor","match","location","androidResponse","e","console","log","detail","setState","isRecording","recording_end_sound","play","audioResult","andriodListener","newRequest","user","props","s_id","student","data","ask","idx_text","code","currentIndex","cure","currentCure","currentAudio","Audio","cure_path","cure_text","cure_word","TTobaki","ttobak1_1","cureText","totalNum","length","ttobak2_1","status","answer","score","phone_score","speed_score","rhythm_score","learning_type","cure_id","gameDone","setTimeout","playSound","message","ttobak3_2","addEventListener","recording_start_sound","window","BRIDGE","recordAudio","showDonePopup","showDailyPopup","imagesPreloading","picture","i","prop","img","Image","src","onload","percent","numOfLoadedImage","totalImages","isImageLoaded","onContinueButtonHandle","showPopup","onRestartButtonHandle","onPauseButtonHandle","params","type","Object","keys","state","read","componentDidMount","u_id","history","push","componentWillUnmount","pause","removeEventListener","render","t1_background","t1_textbox","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,OAAOC,aAAP,MAA0B,mBAA1B;AACA,OAAOC,eAAP,MAA4B,qBAA5B;AAEA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,OAAT,QAAwB,aAAxB;AAEA,SAASC,EAAT,EAAaC,MAAb,QAA2B,QAA3B;AACA,SAASC,MAAT,EAAiBC,QAAjB,QAAiC,KAAjC;AACA,OAAOC,WAAP,MAAwB,wBAAxB;;AAEA,MAAMC,SAAN,SAAwBZ,KAAK,CAACa,SAA9B,CAAwC;AAMpCC,EAAAA,WAAW,CAAC;AAAEC,IAAAA,KAAF;AAASC,IAAAA;AAAT,GAAD,EAAsB;AAC7B;;AAD6B,SA0EjCC,eA1EiC,GA0Ef,MAAOC,CAAP,IAAa;AAC3BC,MAAAA,OAAO,CAACC,GAAR,CAAYF,CAAC,CAACG,MAAd;AACA,WAAKC,QAAL,CAAc;AACVC,QAAAA,WAAW,EAAE;AADH,OAAd;AAGA,WAAKC,mBAAL,CAAyBC,IAAzB;AACA,WAAKC,WAAL,GAAmBR,CAAC,CAACG,MAArB;AACA,WAAKM,eAAL;AACH,KAlFgC;;AAAA,SAoFjCC,UApFiC,GAoFpB,YAAY;AACrBT,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,YAAM;AAAES,QAAAA;AAAF,UAAW,KAAKC,KAAtB;AACA,YAAMC,IAAI,GAAGF,IAAI,CAACG,OAAL,CAAaD,IAA1B;;AAEA,UAAI;AACA,cAAM;AAAEE,UAAAA;AAAF,YAAW,MAAMxB,MAAM,CAACyB,GAAP,CAAWH,IAAX,EAAiB,KAAKI,QAAtB,CAAvB;AACAhB,QAAAA,OAAO,CAACC,GAAR,CAAYa,IAAZ;;AAEA,YAAIA,IAAI,CAACG,IAAL,KAAc,WAAd,IAA6BH,IAAI,CAACG,IAAL,KAAc,CAA/C,EAAkD;AAC9C,eAAKC,YAAL,GAAoB,CAApB;AACA,eAAKC,IAAL,GAAYL,IAAI,CAACK,IAAjB;AACA,eAAKC,WAAL,GAAmBN,IAAI,CAACK,IAAL,CAAU,KAAKD,YAAf,CAAnB;AACA,eAAKG,YAAL,GAAoB,IAAIC,KAAJ,CAAU/B,QAAQ,GAAG,KAAK6B,WAAL,CAAiBG,SAAtC,CAApB;AACA,cAAI,KAAKP,QAAL,KAAkB,WAAlB,IAAiC,KAAKA,QAAL,KAAkB,WAAvD,EACI,KAAKI,WAAL,CAAiBI,SAAjB,GAA6B,KAAKJ,WAAL,CAAiBK,SAA9C;AACJ,eAAKtB,QAAL,CAAc;AACVuB,YAAAA,OAAO,EAAErC,MAAM,CAACsC,SADN;AAEVC,YAAAA,QAAQ,EAAE,KAAKR,WAAL,CAAiBI,SAFjB;AAGVK,YAAAA,QAAQ,EAAE,KAAKV,IAAL,CAAUW;AAHV,WAAd;AAKH;AACJ,OAjBD,CAiBE,OAAO/B,CAAP,EAAU;AACRC,QAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACH;AACJ,KA7GgC;;AAAA,SA+GjCS,eA/GiC,GA+Gf,YAAY;AAC1B,WAAKL,QAAL,CAAc;AACVuB,QAAAA,OAAO,EAAErC,MAAM,CAAC0C;AADN,OAAd;;AAIA,UAAI;AACA,YAAI,KAAKxB,WAAL,CAAiByB,MAAjB,KAA4B,SAAhC,EAA2C;AACvC,gBAAM;AAAEtB,YAAAA;AAAF,cAAW,KAAKC,KAAtB;AACA,gBAAMC,IAAI,GAAGF,IAAI,CAACG,OAAL,CAAaD,IAA1B;AACA,gBAAM;AAAEE,YAAAA;AAAF,cAAW,MAAMxB,MAAM,CAAC2C,MAAP,CACnBrB,IADmB,EAEnB,KAAKL,WAAL,CAAiB2B,KAFE,EAGnB,KAAK3B,WAAL,CAAiB4B,WAHE,EAInB,KAAK5B,WAAL,CAAiB6B,WAJE,EAKnB,KAAK7B,WAAL,CAAiB8B,YALE,EAMnB,KAAKC,aAAL,KAAuB,QAAvB,GAAkC,GAAlC,GAAwC,GANrB,EAOnB,KAAKlB,WAAL,CAAiBmB,OAPE,EAQnB,KAAKvB,QARc,CAAvB;AAUAhB,UAAAA,OAAO,CAACC,GAAR,CAAYa,IAAZ;;AAEA,cAAIA,IAAI,CAACG,IAAL,KAAc,CAAlB,EAAqB;AACjB,gBAAI,KAAKC,YAAL,GAAoB,KAAKC,IAAL,CAAUW,MAAV,GAAmB,CAA3C,EAA8C;AAC1C,mBAAKZ,YAAL;AACH,aAFD,MAEO;AACH,mBAAKsB,QAAL;AACA;AACH;;AACD,iBAAKpB,WAAL,GAAmB,KAAKD,IAAL,CAAU,KAAKD,YAAf,CAAnB;AACA,iBAAKG,YAAL,GAAoB,IAApB;AACA,iBAAKA,YAAL,GAAoB,IAAIC,KAAJ,CAAU/B,QAAQ,GAAG,KAAK6B,WAAL,CAAiBG,SAAtC,CAApB;AACA,gBAAI,KAAKP,QAAL,KAAkB,WAAlB,IAAiC,KAAKA,QAAL,KAAkB,WAAvD,EACI,KAAKI,WAAL,CAAiBI,SAAjB,GAA6B,KAAKJ,WAAL,CAAiBK,SAA9C;AAEJgB,YAAAA,UAAU,CAAC,MAAM;AACb,mBAAKtC,QAAL,CAAc;AACVuB,gBAAAA,OAAO,EAAErC,MAAM,CAACsC,SADN;AAEVC,gBAAAA,QAAQ,EAAE,KAAKR,WAAL,CAAiBI,SAFjB;AAGVN,gBAAAA,YAAY,EAAE,KAAKA,YAAL,GAAoB;AAHxB,eAAd;AAKH,aANS,EAMP,IANO,CAAV;AAQAuB,YAAAA,UAAU,CAAC,MAAM;AACb,mBAAKC,SAAL;AACH,aAFS,EAEP,IAFO,CAAV;AAIH,WAzBD,MAyBO,IAAI5B,IAAI,CAACG,IAAL,KAAc,CAAlB,EAAqB;AACxB,iBAAKuB,QAAL;AACH,WAFM,MAGFxC,OAAO,CAACC,GAAR,CAAYa,IAAI,CAAC6B,OAAjB;AAER,SA7CD,MA6CO;AACH3C,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKM,WAAL,CAAiBoC,OAA7B;AACH;AACJ,OAjDD,CAiDE,OAAO5C,CAAP,EAAU;AACRC,QAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACH;AACJ,KAxKgC;;AAAA,SA0KjC2C,SA1KiC,GA0KrB,MAAM;AACd,UAAI,CAAC,CAAC,KAAKrB,YAAX,EAAyB;AACrB,aAAKlB,QAAL,CAAc;AACVuB,UAAAA,OAAO,EAAErC,MAAM,CAACuD;AADN,SAAd;AAGA,aAAKvB,YAAL,CAAkBf,IAAlB;AACA,aAAKe,YAAL,CAAkBwB,gBAAlB,CAAmC,OAAnC,EAA4C,MAAM;AAC9C,eAAK1C,QAAL,CAAc;AACVuB,YAAAA,OAAO,EAAErC,MAAM,CAACsC;AADN,WAAd;AAGAc,UAAAA,UAAU,CAAC,MAAM;AACbzC,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ;AACA,iBAAK6C,qBAAL,CAA2BxC,IAA3B;AACA,iBAAKH,QAAL,CAAc;AACVC,cAAAA,WAAW,EAAE;AADH,aAAd;AAGA2C,YAAAA,MAAM,CAACC,MAAP,CAAcC,WAAd,CAA0B,GAA1B,EAA+B,KAAK7B,WAAL,CAAiBI,SAAhD;AACH,WAPS,EAOP,IAPO,CAAV;AAQH,SAZD;AAaH;AACJ,KA9LgC;;AAAA,SAgMjCgB,QAhMiC,GAgMtB,MAAM;AACbxC,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;;AACA,UAAI,KAAKqC,aAAL,KAAuB,OAA3B,EAAoC;AAChC,aAAKnC,QAAL,CAAc;AACV+C,UAAAA,aAAa,EAAE;AADL,SAAd;AAGH,OAJD,MAIO;AACH,aAAK/C,QAAL,CAAc;AACVgD,UAAAA,cAAc,EAAE;AADN,SAAd;AAGH;AACJ,KA3MgC;;AAAA,SA6MjCC,gBA7MiC,GA6MbC,OAAD,IAAa;AAC5B,WAAK,IAAIC,CAAT,IAAcD,OAAd,EAAuB;AACnB,aAAK,IAAIE,IAAT,IAAiBF,OAAO,CAACC,CAAD,CAAxB,EAA6B;AACzB,cAAIE,GAAG,GAAG,IAAIC,KAAJ,EAAV;AACAD,UAAAA,GAAG,CAACE,GAAJ,GAAUL,OAAO,CAACC,CAAD,CAAP,CAAWC,IAAX,CAAV;;AACAC,UAAAA,GAAG,CAACG,MAAJ,GAAa,MAAM;AACf,iBAAKxD,QAAL,CAAc;AACVyD,cAAAA,OAAO,EAAG,EAAE,KAAKC,gBAAP,GAA0B,KAAKC,WAAhC,GAA+C;AAD9C,aAAd;;AAGA,gBAAI,KAAKD,gBAAL,KAA0B,KAAKC,WAAnC,EAAgD;AAC5C,mBAAK3D,QAAL,CAAc;AACV4D,gBAAAA,aAAa,EAAE,IADL;AAEVrC,gBAAAA,OAAO,EAAErC,MAAM,CAACsC;AAFN,eAAd;AAIAc,cAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACH;AACJ,WAXD;AAYH;AACJ;AACJ,KAhOgC;;AAAA,SAmOjCsB,sBAnOiC,GAmOR,MAAM;AAC3B,WAAK7D,QAAL,CAAc;AACV8D,QAAAA,SAAS,EAAE;AADD,OAAd;AAGH,KAvOgC;;AAAA,SAyOjCC,qBAzOiC,GAyOT,MAAM;AAC1B,WAAK/D,QAAL,CAAc;AACV+C,QAAAA,aAAa,EAAE;AADL,OAAd;AAGA,WAAKzC,UAAL;AACAgC,MAAAA,UAAU,CAAC,MAAM,KAAKC,SAAL,EAAP,EAAyB,IAAzB,CAAV;AACH,KA/OgC;;AAAA,SAiPjCyB,mBAjPiC,GAiPX,MAAM;AACxB,WAAKhE,QAAL,CAAc;AACV8D,QAAAA,SAAS,EAAE;AADD,OAAd;AAGH,KArPgC;;AAE7B,SAAKjD,QAAL,GAAgBpB,KAAK,CAACwE,MAAN,CAAaC,IAA7B;AACA,SAAK/B,aAAL,GAAqB1C,KAAK,CAACwE,MAAN,CAAa9B,aAAlC;AACA,SAAKQ,qBAAL,GAA6B,IAAIxB,KAAJ,CAAUtC,eAAV,CAA7B;AACA,SAAKqB,mBAAL,GAA2B,IAAIiB,KAAJ,CAAUvC,aAAV,CAA3B;AACA,SAAKoC,IAAL,GAAY,IAAZ;AACA,SAAKC,WAAL,GAAmB,IAAnB;AACA,SAAKF,YAAL,GAAoB,CAApB;AACA,SAAKG,YAAL,GAAoB,IAApB;AACA,SAAKd,WAAL,GAAmB,IAAnB;AACA,SAAK8C,OAAL,GAAe;AAAEjE,MAAAA,EAAF;AAAMC,MAAAA;AAAN,KAAf;AACA,SAAKyE,WAAL,GAAmBQ,MAAM,CAACC,IAAP,CAAY,KAAKlB,OAAL,CAAajE,EAAzB,EAA6B0C,MAA7B,GAAsCwC,MAAM,CAACC,IAAP,CAAY,KAAKlB,OAAL,CAAahE,MAAzB,EAAiCyC,MAA1F;AACA,SAAK+B,gBAAL,GAAwB,CAAxB;AAEA,SAAKW,KAAL,GAAa;AACT5C,MAAAA,QAAQ,EAAE,IADD;AAETxB,MAAAA,WAAW,EAAE,KAFJ;AAGTsB,MAAAA,OAAO,EAAErC,MAAM,CAACsC,SAHP;AAIToC,MAAAA,aAAa,EAAE,KAJN;AAKTE,MAAAA,SAAS,EAAE,KALF;AAMTf,MAAAA,aAAa,EAAE,KANN;AAOTC,MAAAA,cAAc,EAAE,KAPP;AAQTS,MAAAA,OAAO,EAAE,CARA;AAST1C,MAAAA,YAAY,EAAE,CATL;AAUTW,MAAAA,QAAQ,EAAE;AAVD,KAAb;;AAaA,QAAI,KAAKS,aAAL,KAAuB,OAA3B,EAAoC;AAChCtC,MAAAA,OAAO,CAACC,GAAR,CAAYJ,QAAQ,CAAC2E,KAAT,CAAe1D,IAAf,CAAoB2D,IAAhC;AACA,WAAKtD,IAAL,GAAYtB,QAAQ,CAAC2E,KAAT,CAAe1D,IAAf,CAAoB2D,IAAhC;AACA,WAAKD,KAAL,GAAa,EACT,GAAG,KAAKA,KADC;AAET3C,QAAAA,QAAQ,EAAE,KAAKV,IAAL,CAAUW;AAFX,OAAb;AAIH;AACJ;;AAED,QAAM4C,iBAAN,GAA0B;AACtB,UAAM;AAAEhE,MAAAA;AAAF,QAAW,KAAKC,KAAtB;;AAEA,QAAG,CAACD,IAAI,CAACA,IAAL,CAAUiE,IAAd,EAAoB;AAChB,WAAKhE,KAAL,CAAWiE,OAAX,CAAmBC,IAAnB,CAAwB,cAAxB;AACA;AACH;;AAED,QAAG,CAACnE,IAAI,CAACG,OAAL,CAAaD,IAAjB,EAAuB;AACnB,WAAKD,KAAL,CAAWiE,OAAX,CAAmBC,IAAnB,CAAwB,iBAAxB;AACA;AACH;;AAED,QAAI,KAAKvC,aAAL,KAAuB,OAA3B,EAAoC,KAAK7B,UAAL,GAApC,KACK;AACD,WAAKW,WAAL,GAAmB,KAAKD,IAAL,CAAU,KAAKD,YAAf,CAAnB;AACA,WAAKG,YAAL,GAAoB,IAAIC,KAAJ,CAAU/B,QAAQ,GAAG,KAAK6B,WAAL,CAAiBG,SAAtC,CAApB;AACA,UAAI,KAAKP,QAAL,KAAkB,WAAlB,IAAiC,KAAKA,QAAL,KAAkB,WAAvD,EACI,KAAKI,WAAL,CAAiBI,SAAjB,GAA6B,KAAKJ,WAAL,CAAiBK,SAA9C;AACJ,WAAK+C,KAAL,GAAa;AACT5C,QAAAA,QAAQ,EAAE,KAAKR,WAAL,CAAiBI;AADlB,OAAb;AAGH;AACD,SAAK4B,gBAAL,CAAsB,KAAKC,OAA3B;AAEAN,IAAAA,MAAM,CAACF,gBAAP,CAAwB,SAAxB,EAAmC,KAAK/C,eAAxC;AACH;;AAEDgF,EAAAA,oBAAoB,GAAG;AACnB,QAAI,CAAC,CAAC,KAAKzD,YAAX,EAAyB;AACrB,WAAKA,YAAL,CAAkB0D,KAAlB;AACA,WAAK1D,YAAL,GAAoB,IAApB;AACH;;AACD0B,IAAAA,MAAM,CAACiC,mBAAP,CAA2B,SAA3B,EAAsC,KAAKlF,eAA3C;AACH;;AA+KDmF,EAAAA,MAAM,GAAG;AACL,UAAM;AAAEZ,MAAAA,IAAF;AAAQzC,MAAAA,QAAR;AAAkBF,MAAAA,OAAlB;AAA2BtB,MAAAA,WAA3B;AAAwC2D,MAAAA,aAAxC;AACFE,MAAAA,SADE;AACSf,MAAAA,aADT;AACwBC,MAAAA,cADxB;AACwCS,MAAAA,OADxC;AAEF1C,MAAAA,YAFE;AAEYW,MAAAA;AAFZ,QAEyB,KAAK2C,KAFpC;;AAIA,QAAIT,aAAJ,EAAmB;AACf,0BAAQ,oBAAC,kBAAD;AACJ,QAAA,UAAU,EAAE3E,EAAE,CAAC8F,aADX;AAEJ,QAAA,OAAO,EAAE9F,EAAE,CAAC+F,UAFR;AAGJ,QAAA,MAAM,EAAEzD,OAHJ;AAIJ,QAAA,IAAI,EAAE2C,IAJF;AAKJ,QAAA,IAAI,EAAEzC,QALF;AAMJ,QAAA,WAAW,EAAExB,WANT;AAOJ,QAAA,sBAAsB,EAAE,KAAK4D,sBAPzB;AAQJ,QAAA,qBAAqB,EAAE,KAAKE,qBARxB;AASJ,QAAA,mBAAmB,EAAE,KAAKC,mBATtB;AAUJ,QAAA,SAAS,EAAEF,SAVP;AAWJ,QAAA,cAAc,EAAEd,cAXZ;AAYJ,QAAA,aAAa,EAAED,aAZX;AAaJ,QAAA,YAAY,EAAEhC,YAbV;AAcJ,QAAA,QAAQ,EAAEW,QAdN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAR;AAgBH,KAjBD,MAkBK;AACD,0BAAO,oBAAC,WAAD;AAAa,QAAA,OAAO,EAAE+B,OAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACH;AACJ;;AAvRmC;;AAAlCnE,S,CACK2F,S,GAAY;AACf1E,EAAAA,IAAI,EAAExB,SAAS,CAACmG,QAAV,CAAmBnG,SAAS,CAACoG,GAA7B,EAAkCC,UADzB;AAEfC,EAAAA,QAAQ,EAAEtG,SAAS,CAACuG,IAAV,CAAeF;AAFV,C;;AAyRvB,SAASG,eAAT,CAAyBlB,KAAzB,EAAgC;AAC5B,SAAO;AAAE9D,IAAAA,IAAI,EAAE8D,KAAK,CAAC9D;AAAd,GAAP;AACH;;AAED,eAAevB,OAAO,CAACuG,eAAD,CAAP,CAAyBzG,UAAU,CAACQ,SAAD,CAAnC,CAAf","sourcesContent":["import React from 'react';\nimport ShadowingPresenter from './ShadowingPresenter';\nimport recording_end from 'recording_end.mp3';\nimport recording_start from 'recording_start.mp3';\n\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport { T1, TTobak } from 'images';\nimport { T1_Api, soundURL } from 'api';\nimport LoadingComp from 'Components/LoadingComp';\n\nclass Shadowing extends React.Component {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor({ match, location }) {\n        super();\n        this.idx_text = match.params.type;\n        this.learning_type = match.params.learning_type;\n        this.recording_start_sound = new Audio(recording_start);\n        this.recording_end_sound = new Audio(recording_end);\n        this.cure = null;\n        this.currentCure = null;\n        this.currentIndex = 0;\n        this.currentAudio = null;\n        this.audioResult = null;\n        this.picture = { T1, TTobak };\n        this.totalImages = Object.keys(this.picture.T1).length + Object.keys(this.picture.TTobak).length;\n        this.numOfLoadedImage = 0;\n\n        this.state = {\n            cureText: null,\n            isRecording: false,\n            TTobaki: TTobak.ttobak1_1,\n            isImageLoaded: false,\n            showPopup: false,\n            showDonePopup: false,\n            showDailyPopup: false,\n            percent: 0,\n            currentIndex: 0,\n            totalNum: 0,\n        }\n\n        if (this.learning_type === 'daily') {\n            console.log(location.state.data.read);\n            this.cure = location.state.data.read;\n            this.state = {\n                ...this.state,\n                totalNum: this.cure.length,\n            }\n        }\n    }\n\n    async componentDidMount() {\n        const { user } = this.props;\n        \n        if(!user.user.u_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        if(!user.student.s_id) {\n            this.props.history.push('/root/selectstd');\n            return;\n        }\n\n        if (this.learning_type !== 'daily') this.newRequest();\n        else {\n            this.currentCure = this.cure[this.currentIndex];\n            this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n            if (this.idx_text === 'vowelword' || this.idx_text === 'consoword')\n                this.currentCure.cure_text = this.currentCure.cure_word;\n            this.state = {\n                cureText: this.currentCure.cure_text\n            };\n        }\n        this.imagesPreloading(this.picture);\n\n        window.addEventListener(\"android\", this.androidResponse);\n    }\n\n    componentWillUnmount() {\n        if (!!this.currentAudio) {\n            this.currentAudio.pause();\n            this.currentAudio = null;\n        }\n        window.removeEventListener(\"android\", this.androidResponse)\n    }\n\n    androidResponse = async (e) => {\n        console.log(e.detail);\n        this.setState({\n            isRecording: false,\n        })\n        this.recording_end_sound.play();\n        this.audioResult = e.detail;\n        this.andriodListener();\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        try {\n            const { data } = await T1_Api.ask(s_id, this.idx_text);\n            console.log(data);\n\n            if (data.code === 'specified' || data.code === 1) {\n                this.currentIndex = 0;\n                this.cure = data.cure;\n                this.currentCure = data.cure[this.currentIndex];\n                this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n                if (this.idx_text === 'vowelword' || this.idx_text === 'consoword')\n                    this.currentCure.cure_text = this.currentCure.cure_word;\n                this.setState({\n                    TTobaki: TTobak.ttobak1_1,\n                    cureText: this.currentCure.cure_text,\n                    totalNum: this.cure.length,\n                });\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    andriodListener = async () => {\n        this.setState({\n            TTobaki: TTobak.ttobak2_1,\n        });\n\n        try {\n            if (this.audioResult.status === 'Success') {\n                const { user } = this.props;\n                const s_id = user.student.s_id;\n                const { data } = await T1_Api.answer(\n                    s_id,\n                    this.audioResult.score,\n                    this.audioResult.phone_score,\n                    this.audioResult.speed_score,\n                    this.audioResult.rhythm_score,\n                    this.learning_type === 'review' ? 'T' : 'F',\n                    this.currentCure.cure_id,\n                    this.idx_text\n                );\n                console.log(data);\n\n                if (data.code === 1) {\n                    if (this.currentIndex < this.cure.length - 1) {\n                        this.currentIndex++;\n                    } else {\n                        this.gameDone();\n                        return;\n                    }\n                    this.currentCure = this.cure[this.currentIndex];\n                    this.currentAudio = null;\n                    this.currentAudio = new Audio(soundURL + this.currentCure.cure_path);\n                    if (this.idx_text === 'vowelword' || this.idx_text === 'consoword')\n                        this.currentCure.cure_text = this.currentCure.cure_word;\n\n                    setTimeout(() => {\n                        this.setState({\n                            TTobaki: TTobak.ttobak1_1,\n                            cureText: this.currentCure.cure_text,\n                            currentIndex: this.currentIndex + 1\n                        });\n                    }, 3000);\n\n                    setTimeout(() => {\n                        this.playSound();\n                    }, 5500);\n\n                } else if (data.code === 2) {\n                    this.gameDone();\n                }\n                else console.log(data.message);\n\n            } else {\n                console.log(this.audioResult.message);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    playSound = () => {\n        if (!!this.currentAudio) {\n            this.setState({\n                TTobaki: TTobak.ttobak3_2,\n            });\n            this.currentAudio.play();\n            this.currentAudio.addEventListener('ended', () => {\n                this.setState({\n                    TTobaki: TTobak.ttobak1_1,\n                });\n                setTimeout(() => {\n                    console.log('이제 따라 읽어볼까요?');\n                    this.recording_start_sound.play();\n                    this.setState({\n                        isRecording: true,\n                    });\n                    window.BRIDGE.recordAudio('m', this.currentCure.cure_text);\n                }, 1000);\n            });\n        }\n    }\n\n    gameDone = () => {\n        console.log('game doen!');\n        if (this.learning_type !== 'daily') {\n            this.setState({\n                showDonePopup: true,\n            })\n        } else {\n            this.setState({\n                showDailyPopup: true,\n            })\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    })\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                            TTobaki: TTobak.ttobak1_1,\n                        })\n                        setTimeout(() => this.playSound(), 1000);\n                    }\n                };\n            }\n        }\n    }\n\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onRestartButtonHandle = () => {\n        this.setState({\n            showDonePopup: false,\n        })\n        this.newRequest();\n        setTimeout(() => this.playSound(), 2000);\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { type, cureText, TTobaki, isRecording, isImageLoaded,\n            showPopup, showDonePopup, showDailyPopup, percent,\n            currentIndex, totalNum } = this.state;\n\n        if (isImageLoaded) {\n            return (<ShadowingPresenter\n                Background={T1.t1_background}\n                TextBox={T1.t1_textbox}\n                TTobak={TTobaki}\n                type={type}\n                text={cureText}\n                isRecording={isRecording}\n                onContinueButtonHandle={this.onContinueButtonHandle}\n                onRestartButtonHandle={this.onRestartButtonHandle}\n                onPauseButtonHandle={this.onPauseButtonHandle}\n                showPopup={showPopup}\n                showDailyPopup={showDailyPopup}\n                showDonePopup={showDonePopup}\n                currentIndex={currentIndex}\n                totalNum={totalNum}\n            />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(Shadowing));"]},"metadata":{},"sourceType":"module"}