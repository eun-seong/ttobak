{"ast":null,"code":"var _jsxFileName = \"/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T6_ConsoMatch/ConsoMatchContainer.js\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ConsoMatchPresenter from './ConsoMatchPresenter';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport LoadingComp from 'Components/LoadingComp';\nimport { T6, Characters } from 'images';\nimport { T_Api4, soundURL } from 'api';\n\nclass ConsoMatch extends React.Component {\n  constructor({\n    match,\n    location\n  }) {\n    super();\n\n    this.getListFilter = (key, value) => {\n      return this.cure.filter(object => {\n        return object[key] === value;\n      })[0];\n    };\n\n    this.newRequest = async () => {\n      console.log('new request');\n      const {\n        user\n      } = this.props;\n      const s_id = user.student.s_id;\n\n      try {\n        const {\n          data\n        } = await T_Api4.ask(s_id);\n        console.log(data);\n\n        if (data.code === 'specified' || data.code === 1) {\n          this.currentIndex = 0;\n          this.answer = data.answer;\n          this.cure = data.cure;\n          this.totalImages += this.cure.length;\n          this.pictursPreloading(this.cure);\n          this.setCurrent(0);\n          this.setState({\n            totalNum: this.cure.length\n          });\n        } else console.log('data message: ' + data.message);\n      } catch (e) {\n        console.log('error: ' + e);\n      }\n    };\n\n    this.setCurrent = timeout => {\n      this.currentCure = this.answer[this.currentIndex];\n      this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n      this.currentAudio.addEventListener('ended', () => {\n        this.setState({\n          gameState: true,\n          Worm: Characters.worm2_2\n        });\n      });\n      setTimeout(() => {\n        this.setState({\n          PicBoxList: [soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2],\n          currentIndex: this.currentIndex + 1\n        });\n      }, timeout);\n    };\n\n    this.playSound = () => {\n      if (!!this.currentAudio) {\n        this.setState({\n          gameState: false,\n          Worm: Characters.worm2_1\n        });\n        this.currentAudio.play();\n      }\n    };\n\n    this.gameDone = () => {\n      console.log('done!');\n\n      if (this.learning_type !== 'daily') {\n        this.setState({\n          showDonePopup: true\n        });\n      } else {\n        this.setState({\n          showDailyPopup: true\n        });\n      }\n    };\n\n    this.onFrameTouchHandle = async id => {\n      const {\n        gameState\n      } = this.state;\n      if (!gameState) return;\n      this.setState({\n        gameState: false,\n        Worm: Characters.worm3_1\n      });\n\n      try {\n        const {\n          user\n        } = this.props;\n        const s_id = user.student.s_id;\n        const cure_id = [this.getListFilter('cure_tid', this.currentCure[0]).cure_id, this.getListFilter('cure_tid', this.currentCure[1]).cure_id, this.getListFilter('cure_tid', this.currentCure[2]).cure_id];\n        const {\n          data\n        } = await T_Api4.answer(s_id, cure_id, this.getListFilter('cure_tid', this.currentCure[id]).cure_word, this.getListFilter('cure_tid', this.currentCure[3][0]).cure_word, this.learning_type === 'review' ? 'T' : 'F');\n        console.log(data);\n\n        switch (data.code) {\n          case 1:\n            if (this.currentIndex < this.answer.length - 1) this.currentIndex++;else {\n              this.gameDone();\n              return;\n            }\n            this.setCurrent(2000);\n            setTimeout(() => {\n              this.playSound();\n            }, 3000);\n            break;\n\n          case 2:\n            console.log(data.message);\n            this.gameDone();\n            break;\n\n          default:\n            this.props.history.replace('/main/main');\n            break;\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.onWormTouchHandle = () => {\n      if (this.state.gameState) this.playSound();\n    };\n\n    this.pictursPreloading = picture => {\n      let timeoutPreloading = setTimeout(() => {\n        this.props.history.replace('/main/main');\n      }, 10000);\n\n      try {\n        for (let i in picture) {\n          let img = new Image();\n          img.src = soundURL + picture[i].cure_path2;\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n              setTimeout(() => this.playSound(), 1000);\n              clearTimeout(timeoutPreloading);\n            }\n          };\n        }\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.imagesPreloading = picture => {\n      for (let i in picture) {\n        for (let prop in picture[i]) {\n          let img = new Image();\n          img.src = picture[i][prop];\n\n          img.onload = () => {\n            this.setState({\n              percent: ++this.numOfLoadedImage / this.totalImages * 100\n            });\n\n            if (this.numOfLoadedImage === this.totalImages) {\n              this.setState({\n                isImageLoaded: true\n              });\n              setTimeout(() => this.playSound(), 1000);\n            }\n          };\n        }\n      }\n    };\n\n    this.onContinueButtonHandle = () => {\n      this.setState({\n        showPopup: false\n      });\n    };\n\n    this.onRestartButtonHandle = () => {\n      this.setState({\n        showDonePopup: false\n      });\n      this.newRequest();\n      setTimeout(() => this.playSound(), 2000);\n    };\n\n    this.onPauseButtonHandle = () => {\n      this.setState({\n        showPopup: true\n      });\n    };\n\n    this.learning_type = match.params.learning_type;\n    this.cure = null;\n    this.answer = null;\n    this.currentCure = null;\n    this.currentAudio = null;\n    this.currentIndex = 0;\n    this.numOfLoadedImage = 0;\n    this.picture = {\n      T6,\n      Characters\n    };\n    this.totalImages = Object.keys(T6).length + Object.keys(Characters).length;\n    this.state = {\n      gameState: false,\n      PicBoxList: null,\n      Worm: Characters.worm2_2,\n      isImageLoaded: false,\n      showPopup: false,\n      showDonePopup: false,\n      showDailyPopup: false,\n      percent: 0,\n      currentIndex: 1,\n      totalNum: 0\n    };\n\n    if (this.learning_type === 'daily') {\n      console.log(location.state.data.cure);\n      this.answer = location.state.data.answer;\n      this.cure = location.state.data.cure;\n      this.currentCure = this.answer[this.currentIndex];\n      console.log(soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2);\n      this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n      this.currentAudio.addEventListener('ended', () => {\n        this.setState({\n          gameState: true,\n          Worm: Characters.worm2_2\n        });\n      });\n      this.state = { ...this.state,\n        totalNum: this.cure.length\n      };\n    }\n  }\n\n  componentDidCatch() {}\n\n  async componentDidMount() {\n    this.imagesPreloading(this.picture);\n    const {\n      user\n    } = this.props;\n\n    if (!user.user.u_id) {\n      this.props.history.push('/root/signin');\n      return;\n    }\n\n    if (!user.student.s_id) {\n      this.props.history.push('/root/selectstd');\n      return;\n    }\n\n    if (this.learning_type !== 'daily') this.newRequest();else {\n      this.setState({\n        PicBoxList: [soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2, soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2]\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    if (!!this.currentAudio) {\n      this.currentAudio.pause();\n      this.currentAudio = null;\n    }\n  }\n\n  render() {\n    const {\n      PicBoxList,\n      Worm,\n      isImageLoaded,\n      showPopup,\n      percent,\n      gameState,\n      showDailyPopup,\n      showDonePopup,\n      currentIndex,\n      totalNum\n    } = this.state;\n\n    if (isImageLoaded) {\n      return /*#__PURE__*/React.createElement(ConsoMatchPresenter, {\n        Background: T6.t6_background,\n        Worm: Worm,\n        onWormTouchHandle: this.onWormTouchHandle,\n        frameList: PicBoxList || [T6.t6_excpic, T6.t6_excpic, T6.t6_excpic],\n        onFrameTouchHandle: this.onFrameTouchHandle,\n        showPopup: showPopup,\n        onContinueButtonHandle: this.onContinueButtonHandle,\n        onPauseButtonHandle: this.onPauseButtonHandle,\n        onRestartButtonHandle: this.onRestartButtonHandle,\n        showDailyPopup: showDailyPopup,\n        showDonePopup: showDonePopup,\n        gameState: gameState,\n        currentIndex: currentIndex,\n        totalNum: totalNum,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 17\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(LoadingComp, {\n        percent: percent,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 20\n        }\n      });\n    }\n  }\n\n}\n\nConsoMatch.propTypes = {\n  user: PropTypes.objectOf(PropTypes.any).isRequired,\n  dispatch: PropTypes.func.isRequired\n};\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user\n  };\n}\n\nexport default connect(mapStateToProps)(withRouter(ConsoMatch));","map":{"version":3,"sources":["/Users/eun/Projects/FirstPenguin/first-penguin/front/src/Routes/Therapy/T6_ConsoMatch/ConsoMatchContainer.js"],"names":["React","withRouter","ConsoMatchPresenter","PropTypes","connect","LoadingComp","T6","Characters","T_Api4","soundURL","ConsoMatch","Component","constructor","match","location","getListFilter","key","value","cure","filter","object","newRequest","console","log","user","props","s_id","student","data","ask","code","currentIndex","answer","totalImages","length","pictursPreloading","setCurrent","setState","totalNum","message","e","timeout","currentCure","currentAudio","Audio","cure_path","addEventListener","gameState","Worm","worm2_2","setTimeout","PicBoxList","cure_path2","playSound","worm2_1","play","gameDone","learning_type","showDonePopup","showDailyPopup","onFrameTouchHandle","id","state","worm3_1","cure_id","cure_word","history","replace","onWormTouchHandle","picture","timeoutPreloading","i","img","Image","src","onload","percent","numOfLoadedImage","isImageLoaded","clearTimeout","imagesPreloading","prop","onContinueButtonHandle","showPopup","onRestartButtonHandle","onPauseButtonHandle","params","Object","keys","componentDidCatch","componentDidMount","u_id","push","componentWillUnmount","pause","render","t6_background","t6_excpic","propTypes","objectOf","any","isRequired","dispatch","func","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport ConsoMatchPresenter from './ConsoMatchPresenter';\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport LoadingComp from 'Components/LoadingComp';\nimport { T6, Characters } from 'images';\nimport { T_Api4, soundURL } from 'api';\n\nclass ConsoMatch extends React.Component {\n    static propTypes = {\n        user: PropTypes.objectOf(PropTypes.any).isRequired,\n        dispatch: PropTypes.func.isRequired,\n    };\n\n    constructor({ match, location }) {\n        super();\n        this.learning_type = match.params.learning_type;\n        this.cure = null;\n        this.answer = null;\n        this.currentCure = null;\n        this.currentAudio = null;\n        this.currentIndex = 0;\n        this.numOfLoadedImage = 0;\n        this.picture = { T6, Characters };\n        this.totalImages = Object.keys(T6).length + Object.keys(Characters).length;\n\n        this.state = {\n            gameState: false,\n            PicBoxList: null,\n            Worm: Characters.worm2_2,\n            isImageLoaded: false,\n            showPopup: false,\n            showDonePopup: false,\n            showDailyPopup: false,\n            percent: 0,\n            currentIndex: 1,\n            totalNum: 0,\n        };\n\n        if (this.learning_type === 'daily') {\n            console.log(location.state.data.cure);\n            this.answer = location.state.data.answer;\n            this.cure = location.state.data.cure;\n\n            this.currentCure = this.answer[this.currentIndex];\n            console.log(soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2);\n\n            this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n            this.currentAudio.addEventListener('ended', () => {\n                this.setState({\n                    gameState: true,\n                    Worm: Characters.worm2_2,\n                })\n            })\n            this.state = {\n                ...this.state,\n                totalNum: this.cure.length,\n            }\n        }\n    }\n\n    componentDidCatch() {\n\n    }\n\n    async componentDidMount() {\n        this.imagesPreloading(this.picture);\n        const { user } = this.props;\n\n        if (!user.user.u_id) {\n            this.props.history.push('/root/signin');\n            return;\n        }\n\n        if (!user.student.s_id) {\n            this.props.history.push('/root/selectstd');\n            return;\n        }\n\n        if (this.learning_type !== 'daily') this.newRequest();\n        else {\n            this.setState({\n                PicBoxList: [\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2,\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2,\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2,\n                ]\n            })\n        }\n    }\n\n    componentWillUnmount() {\n        if (!!this.currentAudio) {\n            this.currentAudio.pause();\n            this.currentAudio = null;\n        }\n    }\n\n    getListFilter = (key, value) => {\n        return this.cure.filter((object) => { return object[key] === value })[0]\n    }\n\n    newRequest = async () => {\n        console.log('new request');\n        const { user } = this.props;\n        const s_id = user.student.s_id;\n\n        try {\n            const { data } = await T_Api4.ask(s_id);\n            console.log(data);\n\n            if (data.code === 'specified' || data.code === 1) {\n                this.currentIndex = 0;\n                this.answer = data.answer;\n                this.cure = data.cure;\n\n                this.totalImages += this.cure.length;\n                this.pictursPreloading(this.cure);\n                this.setCurrent(0);\n\n                this.setState({\n                    totalNum: this.cure.length,\n                })\n            }\n            else console.log('data message: ' + data.message);\n        } catch (e) {\n            console.log('error: ' + e);\n        }\n    }\n\n    setCurrent = (timeout) => {\n        this.currentCure = this.answer[this.currentIndex];\n\n        this.currentAudio = new Audio(soundURL + this.getListFilter('cure_tid', this.currentCure[3][0]).cure_path);\n        this.currentAudio.addEventListener('ended', () => {\n            this.setState({\n                gameState: true,\n                Worm: Characters.worm2_2,\n            })\n        })\n\n        setTimeout(() => {\n            this.setState({\n                PicBoxList: [\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[0]).cure_path2,\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[1]).cure_path2,\n                    soundURL + this.getListFilter('cure_tid', this.currentCure[2]).cure_path2,\n                ],\n                currentIndex: this.currentIndex + 1\n            })\n        }, timeout);\n    }\n\n    playSound = () => {\n        if (!!this.currentAudio) {\n            this.setState({\n                gameState: false,\n                Worm: Characters.worm2_1,\n            });\n            this.currentAudio.play();\n        }\n    }\n\n    gameDone = () => {\n        console.log('done!');\n        if (this.learning_type !== 'daily') {\n            this.setState({\n                showDonePopup: true,\n            })\n        } else {\n            this.setState({\n                showDailyPopup: true,\n            })\n        }\n    }\n\n    onFrameTouchHandle = async (id) => {\n        const { gameState } = this.state;\n        if (!gameState) return;\n        this.setState({\n            gameState: false,\n            Worm: Characters.worm3_1,\n        });\n\n        try {\n            const { user } = this.props;\n            const s_id = user.student.s_id;\n            const cure_id = [\n                this.getListFilter('cure_tid', this.currentCure[0]).cure_id,\n                this.getListFilter('cure_tid', this.currentCure[1]).cure_id,\n                this.getListFilter('cure_tid', this.currentCure[2]).cure_id,\n            ];\n            const { data } = await T_Api4.answer(\n                s_id,\n                cure_id,\n                this.getListFilter('cure_tid', this.currentCure[id]).cure_word,\n                this.getListFilter('cure_tid', this.currentCure[3][0]).cure_word,\n                this.learning_type === 'review' ? 'T' : 'F'\n            );\n            console.log(data);\n\n            switch (data.code) {\n                case 1:\n                    if (this.currentIndex < this.answer.length - 1) this.currentIndex++;\n                    else {\n                        this.gameDone();\n                        return;\n                    }\n                    this.setCurrent(2000);\n\n                    setTimeout(() => {\n                        this.playSound();\n                    }, 3000);\n                    break;\n                case 2:\n                    console.log(data.message);\n                    this.gameDone();\n                    break;\n                default:\n                    this.props.history.replace('/main/main')\n                    break;\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    onWormTouchHandle = () => {\n        if (this.state.gameState) this.playSound();\n    }\n\n    pictursPreloading = (picture) => {\n        let timeoutPreloading = setTimeout(() => {\n            this.props.history.replace('/main/main');\n        }, 10000);\n\n        try {\n            for (let i in picture) {\n                let img = new Image();\n                img.src = soundURL + picture[i].cure_path2;\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                        setTimeout(() => this.playSound(), 1000);\n                        clearTimeout(timeoutPreloading);\n                    }\n                };\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    imagesPreloading = (picture) => {\n        for (let i in picture) {\n            for (let prop in picture[i]) {\n                let img = new Image();\n                img.src = picture[i][prop];\n                img.onload = () => {\n                    this.setState({\n                        percent: (++this.numOfLoadedImage / this.totalImages) * 100\n                    });\n\n                    if (this.numOfLoadedImage === this.totalImages) {\n                        this.setState({\n                            isImageLoaded: true,\n                        })\n                        setTimeout(() => this.playSound(), 1000);\n                    }\n                };\n            }\n        }\n    }\n\n    onContinueButtonHandle = () => {\n        this.setState({\n            showPopup: false,\n        })\n    }\n\n    onRestartButtonHandle = () => {\n        this.setState({\n            showDonePopup: false,\n        })\n        this.newRequest();\n        setTimeout(() => this.playSound(), 2000);\n    }\n\n    onPauseButtonHandle = () => {\n        this.setState({\n            showPopup: true,\n        })\n    }\n\n    render() {\n        const { PicBoxList, Worm, isImageLoaded, showPopup, percent, gameState, showDailyPopup, showDonePopup,\n            currentIndex, totalNum } = this.state;\n\n        if (isImageLoaded) {\n            return (\n                <ConsoMatchPresenter\n                    Background={T6.t6_background}\n                    Worm={Worm}\n                    onWormTouchHandle={this.onWormTouchHandle}\n                    frameList={PicBoxList || [T6.t6_excpic, T6.t6_excpic, T6.t6_excpic]}\n                    onFrameTouchHandle={this.onFrameTouchHandle}\n                    showPopup={showPopup}\n                    onContinueButtonHandle={this.onContinueButtonHandle}\n                    onPauseButtonHandle={this.onPauseButtonHandle}\n                    onRestartButtonHandle={this.onRestartButtonHandle}\n                    showDailyPopup={showDailyPopup}\n                    showDonePopup={showDonePopup}\n                    gameState={gameState}\n                    currentIndex={currentIndex}\n                    totalNum={totalNum}\n                />);\n        }\n        else {\n            return <LoadingComp percent={percent} />\n        }\n    }\n}\n\nfunction mapStateToProps(state) {\n    return { user: state.user }\n}\n\nexport default connect(mapStateToProps)(withRouter(ConsoMatch));"]},"metadata":{},"sourceType":"module"}